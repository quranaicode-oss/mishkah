{
  "name": "pos_schema",
  "version": 1,
  "tables": [
    {
      "name": "pos_shift",
      "label": "POS Shift",
      "sqlName": "pos_shift",
      "comment": "Shift sessions captured per POS terminal.",
      "layout": { "x": 80, "y": 120 },
      "fields": [
        { "name": "id", "columnName": "shift_id", "type": "string", "primaryKey": true, "nullable": false, "maxLength": 64 },
        { "name": "posId", "columnName": "pos_id", "type": "string", "nullable": false, "maxLength": 32 },
        { "name": "posLabel", "columnName": "pos_label", "type": "string", "nullable": false, "maxLength": 96 },
        { "name": "posNumber", "columnName": "pos_number", "type": "integer", "nullable": false },
        { "name": "openedAt", "columnName": "opened_at", "type": "timestamp", "nullable": false },
        { "name": "closedAt", "columnName": "closed_at", "type": "timestamp", "nullable": true },
        { "name": "openingFloat", "columnName": "opening_float", "type": "decimal", "precision": 12, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "closingCash", "columnName": "closing_cash", "type": "decimal", "precision": 12, "scale": 2, "nullable": true },
        { "name": "cashierId", "columnName": "cashier_id", "type": "string", "nullable": false, "maxLength": 64 },
        { "name": "cashierName", "columnName": "cashier_name", "type": "string", "nullable": false, "maxLength": 128 },
        { "name": "cashierRole", "columnName": "cashier_role", "type": "string", "nullable": false, "defaultValue": "cashier" },
        { "name": "employeeId", "columnName": "employee_id", "type": "string", "nullable": false, "maxLength": 64 },
        { "name": "status", "columnName": "status", "type": "string", "nullable": false, "defaultValue": "open" },
        { "name": "isClosed", "columnName": "is_closed", "type": "boolean", "nullable": false, "defaultValue": false },
        { "name": "totalsByType", "columnName": "totals_by_type", "type": "json", "nullable": false, "defaultValue": {} },
        { "name": "paymentsByMethod", "columnName": "payments_by_method", "type": "json", "nullable": false, "defaultValue": {} },
        { "name": "countsByType", "columnName": "counts_by_type", "type": "json", "nullable": false, "defaultValue": {} },
        { "name": "ordersCount", "columnName": "orders_count", "type": "integer", "nullable": false, "defaultValue": 0 },
        { "name": "orders", "columnName": "orders_payload", "type": "json", "nullable": false, "defaultValue": [] },
        { "name": "totalSales", "columnName": "total_sales", "type": "decimal", "precision": 14, "scale": 2, "nullable": false, "defaultValue": 0 }
      ],
      "indexes": [
        { "name": "idx_pos_shift_pos_status", "columns": ["pos_id", "is_closed", "opened_at"] },
        { "name": "idx_pos_shift_opened_at", "columns": ["opened_at"] }
      ]
    },
    {
      "name": "order_header",
      "label": "Order Header",
      "sqlName": "order_header",
      "comment": "Sales orders bound to active shifts.",
      "layout": { "x": 420, "y": 80 },
      "fields": [
        { "name": "id", "columnName": "order_id", "type": "string", "primaryKey": true, "nullable": false, "maxLength": 64 },
        { "name": "shiftId", "columnName": "shift_id", "type": "string", "nullable": false, "references": { "table": "pos_shift", "column": "shift_id", "onDelete": "RESTRICT", "onUpdate": "CASCADE" } },
        { "name": "posId", "columnName": "pos_id", "type": "string", "nullable": false },
        { "name": "posNumber", "columnName": "pos_number", "type": "integer", "nullable": false },
        { "name": "orderType", "columnName": "order_type", "type": "string", "nullable": false },
        { "name": "status", "columnName": "status", "type": "string", "nullable": false },
        { "name": "stage", "columnName": "stage", "type": "string", "nullable": false },
        { "name": "paymentState", "columnName": "payment_state", "type": "string", "nullable": false },
        { "name": "totalDue", "columnName": "total_due", "type": "decimal", "precision": 14, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "subtotal", "columnName": "subtotal", "type": "decimal", "precision": 14, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "service", "columnName": "service_amount", "type": "decimal", "precision": 14, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "tax", "columnName": "tax_amount", "type": "decimal", "precision": 14, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "discount", "columnName": "discount_amount", "type": "decimal", "precision": 14, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "openedAt", "columnName": "opened_at", "type": "timestamp", "nullable": false },
        { "name": "closedAt", "columnName": "closed_at", "type": "timestamp", "nullable": true },
        { "name": "customerId", "columnName": "customer_id", "type": "string", "nullable": true, "maxLength": 64 },
        { "name": "customerName", "columnName": "customer_name", "type": "string", "nullable": true, "maxLength": 128 },
        { "name": "metadata", "columnName": "metadata", "type": "json", "nullable": false, "defaultValue": {} }
      ],
      "indexes": [
        { "name": "idx_order_header_shift", "columns": ["shift_id", "opened_at"] },
        { "name": "idx_order_header_customer", "columns": ["customer_id"] }
      ]
    },
    {
      "name": "order_payment",
      "label": "Order Payment",
      "sqlName": "order_payment",
      "comment": "Captured payments for orders.",
      "layout": { "x": 420, "y": 320 },
      "fields": [
        { "name": "id", "columnName": "payment_id", "type": "string", "primaryKey": true, "nullable": false, "maxLength": 64 },
        { "name": "orderId", "columnName": "order_id", "type": "string", "nullable": false, "references": { "table": "order_header", "column": "order_id", "onDelete": "CASCADE", "onUpdate": "CASCADE" } },
        { "name": "shiftId", "columnName": "shift_id", "type": "string", "nullable": false, "references": { "table": "pos_shift", "column": "shift_id", "onDelete": "RESTRICT", "onUpdate": "CASCADE" } },
        { "name": "method", "columnName": "payment_method", "type": "string", "nullable": false },
        { "name": "amount", "columnName": "amount", "type": "decimal", "precision": 12, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "capturedAt", "columnName": "captured_at", "type": "timestamp", "nullable": false }
      ],
      "indexes": [
        { "name": "idx_order_payment_order", "columns": ["order_id"] },
        { "name": "idx_order_payment_shift", "columns": ["shift_id"] }
      ]
    },
    {
      "name": "order_refund",
      "label": "Order Refund",
      "sqlName": "order_refund",
      "comment": "Refunded amounts linked back to original payments.",
      "layout": { "x": 720, "y": 320 },
      "fields": [
        { "name": "id", "columnName": "refund_id", "type": "string", "primaryKey": true, "nullable": false, "maxLength": 64 },
        { "name": "paymentId", "columnName": "payment_id", "type": "string", "nullable": false, "references": { "table": "order_payment", "column": "payment_id", "onDelete": "CASCADE", "onUpdate": "CASCADE" } },
        { "name": "shiftId", "columnName": "shift_id", "type": "string", "nullable": false, "references": { "table": "pos_shift", "column": "shift_id", "onDelete": "RESTRICT", "onUpdate": "CASCADE" } },
        { "name": "amount", "columnName": "amount", "type": "decimal", "precision": 12, "scale": 2, "nullable": false, "defaultValue": 0 },
        { "name": "reason", "columnName": "reason", "type": "string", "nullable": true, "maxLength": 256 },
        { "name": "refundedAt", "columnName": "refunded_at", "type": "timestamp", "nullable": false }
      ],
      "indexes": [
        { "name": "idx_order_refund_payment", "columns": ["payment_id"] }
      ]
    }
  ]
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <title>Ù…Ø´ÙƒØ§Ø© â€” Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ Ù„Ù„Ù…Ø·Ø§Ø¹Ù…</title>
  <script src="./mishkah-utils.js"></script>
  <script src="./mishkah.core.js"></script>
  <script src="./mishkah-ui.js"></script>
  <script src="./pos-mock-data.js"></script>
</head>
<body>
  <div id="app"></div>
  <script>
  (function(){
    const M = Mishkah;
    const UI = M.UI;
    const U = M.utils;
    const D = M.DSL;
    const { tw, token } = U.twcss;

    const MOCK = (window.database)||{};
    const mockCategories = MOCK.categories || [];
    const mockItems = (MOCK.items || []).slice(0, 9);
    const mockTables = MOCK.tables || [];
    const currency = (MOCK.settings && MOCK.settings.currency && MOCK.settings.currency.ar) || 'Ø¬.Ù…';

    const i18nDict = {
      ui:{
        shift:'Ø§Ù„ÙˆØ±Ø¯ÙŠØ©',
        cashier:'Ø§Ù„ÙƒØ§Ø´ÙŠØ±',
        dine_in:'ØµØ§Ù„Ø©',
        takeaway:'ØªÙŠÙƒ Ø§ÙˆØ§ÙŠ',
        delivery:'ØªÙˆØµÙŠÙ„',
        search:'Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ÙŠÙˆ',
        categories:'Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª',
        subtotal:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ',
        service:'Ø®Ø¯Ù…Ø©',
        vat:'Ø¶Ø±ÙŠØ¨Ø©',
        discount:'Ø®ØµÙ…',
        total:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚',
        cart_empty:'Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ†Ø§Ù Ø¨Ø¹Ø¯',
        tables:'Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª',
        payments:'Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª',
        reports:'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
        indexeddb:'Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©',
        kds:'Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø¨Ø® (KDS)',
        last_sync:'Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©',
        connect:'Ø§ØªØµØ§Ù„',
        sync_now:'Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¢Ù†',
        save_order:'Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨',
        settle_and_print:'ØªØ­ØµÙŠÙ„ Ùˆ Ø·Ø¨Ø§Ø¹Ø©',
        print:'Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø·',
        split:'ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¯ÙØ¹Ø§Øª',
        quick_actions:'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©',
        guests:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯',
        bill_summary:'Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©',
        status:'Ø§Ù„Ø­Ø§Ù„Ø©',
        totals:'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª',
        favorites:'Ù…ÙØ¶Ù„Ø©',
        modifiers:'Ø§Ù„ØªØ®ØµÙŠØµØ§Øª',
        notes:'Ù…Ù„Ø§Ø­Ø¸Ø§Øª',
        seat_map:'Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª',
        overview:'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©',
        top_selling:'Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ù‹Ø§',
        avg_ticket:'Ù…ØªÙˆØ³Ø· Ø§Ù„ÙØ§ØªÙˆØ±Ø©',
        orders_count:'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
        open_reports:'ÙØªØ­ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±'
      }
    };

    const posState = {
      head:{ title:'Ù…Ø´ÙƒØ§Ø© â€” Ù†Ù‚Ø·Ø© Ø¨ÙŠØ¹' },
      env:{ theme:'dark', lang:'ar', dir:'rtl' },
      i18n:{ lang:'ar', fallback:'en', dict:i18nDict },
      data:{
        user:{
          name: MOCK.employees ? MOCK.employees[0]?.full_name || 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯' : 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯',
          role: 'ÙƒØ§Ø´ÙŠØ±',
          shift:'Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©',
          shiftNo:'#103'
        },
        status:{
          indexeddb:{ state:'offline', lastSync:'Ù„Ù… ØªØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ø¹Ø¯' },
          kds:{ state:'idle', endpoint:'wss://signal.mas.com.eg/signaldata?id=96nnVOIawRs7Wo_XpAFM0Q' }
        },
        menu:{
          search:'',
          category:'all',
          categories: mockCategories.map(cat=>({ id:cat.id, label: cat.translations?.ar || cat.translations?.en || cat.id })),
          items: mockItems.map(item=>({
            id:item.id,
            name:item.translations?.ar?.name || item.translations?.en?.name || 'ØµÙ†Ù',
            description:item.translations?.ar?.description || '',
            price:item.price,
            image:item.image
          }))
        },
        order:{
          id:'draft-001',
          type:'dine_in',
          table:{ id: mockTables.find(t=>t.status==='occupied')?.id || 'T1', name: mockTables.find(t=>t.status==='occupied')?.name || 'Ø·Ø§ÙˆÙ„Ø© 1' },
          guests:3,
          lines:[
            { id:'line-1', name:'Ø­ÙˆØ§ÙˆØ´ÙŠ Ø¯Ø±ÙˆÙŠØ´', qty:2, price:120, total:240, notes:'Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„', modifiers:['Ø¬Ø¨Ù†Ø© Ø²ÙŠØ§Ø¯Ø©'] },
            { id:'line-2', name:'Ø³Ù†Ø¯ÙˆÙŠØªØ´ ÙƒØ¨Ø¯Ø©', qty:1, price:55, total:55, notes:'Ø¥Ø¶Ø§ÙØ© ÙÙ„ÙÙ„', modifiers:['Ø·Ø­ÙŠÙ†Ø© Ø¥Ø¶Ø§ÙÙŠØ©'] },
            { id:'line-3', name:'Ø£Ø±Ø² Ø¨Ø§Ù„Ø´Ø¹Ø±ÙŠØ©', qty:2, price:68, total:136, notes:'', modifiers:[] }
          ],
          totals:{ subtotal:431, service:51.72, vat:60.34, discount:0, due:543.06 }
        },
        tables: mockTables,
        payments:{
          methods:[
            { id:'cash', label:'Ù†Ù‚Ø¯ÙŠ', icon:'ğŸ’µ' },
            { id:'card', label:'Ø¨Ø·Ø§Ù‚Ø©', icon:'ğŸ’³' },
            { id:'wallet', label:'Ù…Ø­ÙØ¸Ø©', icon:'ğŸ“±' },
            { id:'voucher', label:'Ù‚Ø³ÙŠÙ…Ø©', icon:'ğŸŸï¸' }
          ],
          split:[
            { id:'sp1', method:'cash', amount:250 },
            { id:'sp2', method:'card', amount:293.06 }
          ]
        },
        reports:{
          salesToday:'12,430 ' + currency,
          ordersCount:'58 Ø·Ù„Ø¨',
          avgTicket:'214 ' + currency,
          topItem:'Ø­ÙˆØ§ÙˆØ´ÙŠ Ø¯Ø±ÙˆÙŠØ´',
          range:'today'
        }
      },
      ui:{
        modals:{ tables:false, payments:false, reports:false },
        drawers:{ kds:false },
        activePanels:{ report:'sales' }
      }
    };

    const app = M.app.createApp(posState, {});
    const auto = U.twcss.auto(posState, app, { pageScaffold:true });

    function statusBadge(state, label){
      const tone = state==='online'? 'status/online': state==='offline'? 'status/offline': 'status/idle';
      return UI.Badge({
        variant:'badge/status',
        attrs:{ class: tw`${token(tone)}` },
        leading: state==='online'? 'â—': state==='offline'? 'âœ–' : 'â€¦',
        text: `${label} â€¢ ${state}`
      });
    }

    function Header(db){
      const user = db.data.user;
      return UI.Toolbar({
        left:[
          D.Text.Span({ attrs:{ class: tw`text-2xl font-black tracking-tight` }}, ['Mishkah POS']),
          UI.Badge({ text: db.data.order.type==='dine_in'? i18nDict.ui.dine_in: i18nDict.ui.takeaway, leading:'ğŸ½ï¸', variant:'badge/ghost', attrs:{ class: tw`text-sm` } })
        ],
        right:[
          UI.Badge({ text:`${i18nDict.ui.shift}: ${user.shift}`, leading:'ğŸ•‘', variant:'badge/ghost' }),
          UI.Badge({ text:`${i18nDict.ui.cashier}: ${user.name}`, leading:'ğŸ‘¤', variant:'badge/ghost' }),
          UI.Button({ attrs:{ gkey:'pos:session:logout' }, variant:'ghost', size:'sm' }, ['ğŸšª Ø®Ø±ÙˆØ¬'])
        ]
      });
    }

    function MenuColumn(db){
      const menu = db.data.menu;
      const chips = [{ id:'all', label:'Ø§Ù„ÙƒÙ„' }].concat(menu.categories);
      const chipItems = chips.map(cat=>({
        id:cat.id,
        label:cat.label,
        attrs:{ gkey:'pos:menu:category', 'data-category-id':cat.id }
      }));
      return D.Containers.Section({ attrs:{ class: tw`flex flex-col gap-4` }}, [
        UI.Card({
          variant:'card/soft-1',
          content: D.Containers.Div({ attrs:{ class: tw`space-y-4` }}, [
            UI.SearchBar({ value:menu.search, placeholder:i18nDict.ui.search, onInput:'pos:menu:search', trailing:[
              UI.Button({ attrs:{ gkey:'pos:menu:favorite', class: tw`rounded-full` }, variant:'ghost', size:'sm' }, ['â­ Ø§Ù„Ù…ÙØ¶Ù„Ø©'])
            ] }),
            UI.ChipGroup({ items: chipItems, activeId: menu.category })
          ])
        }),
        D.Containers.Section({ attrs:{ class: tw`${token('scroll-panel')}` }}, [
          D.Containers.Div({ attrs:{ class: tw`${token('scroll-panel/head')}` }}, [
            D.Text.Strong({}, [i18nDict.ui.categories]),
            UI.Button({ attrs:{ gkey:'pos:menu:load-more' }, variant:'ghost', size:'sm' }, ['Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯'])
          ]),
          UI.ScrollArea({
            attrs:{ class: tw`${token('scroll-panel/body')} p-4` },
            children:[
              D.Containers.Div({ attrs:{ class: tw`grid gap-3 sm:grid-cols-2 xl:grid-cols-3` }},
                menu.items.map(item=> UI.Card({
                  variant:'card/soft-2',
                  content: D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
                    D.Containers.Div({ attrs:{ class: tw`aspect-square overflow-hidden rounded-[var(--radius)] bg-[var(--surface-2)]` }}, [
                      item.image ? D.Containers.Img({ attrs:{ src:item.image, alt:item.name, class: tw`w-full h-full object-cover` }}) :
                        D.Containers.Div({ attrs:{ class: tw`w-full h-full grid place-items-center text-3xl` }}, ['ğŸ½ï¸'])
                    ]),
                    D.Containers.Div({ attrs:{ class: tw`space-y-1` }}, [
                      D.Text.Strong({ attrs:{ class: tw`text-base` }}, [item.name]),
                      item.description ? D.Text.P({ attrs:{ class: tw`text-sm ${token('muted')}` }}, [item.description]) : null,
                      UI.PriceText({ amount:item.price, currency:'EGP', locale:'ar-EG' })
                    ].filter(Boolean)),
                    UI.Button({ attrs:{ gkey:'pos:menu:add', 'data-item-id':item.id, class: tw`w-full` }, variant:'solid', size:'sm' }, ['Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨'])
                  ])
                }))
              )
            ]
          }),
          D.Containers.Div({ attrs:{ class: tw`${token('scroll-panel/footer')} flex items-center justify-between` }}, [
            statusBadge(db.data.status.indexeddb.state, i18nDict.ui.indexeddb),
            UI.Button({ attrs:{ gkey:'pos:indexeddb:sync' }, variant:'ghost', size:'sm' }, [i18nDict.ui.sync_now])
          ])
        ])
      ]);
    }

    function OrderLine(line){
      return UI.ListItem({
        leading: D.Text.Span({ attrs:{ class: tw`text-lg` }}, ['ğŸ²']),
        content:[
          D.Text.Strong({}, [line.name]),
          line.modifiers && line.modifiers.length ? D.Text.Span({ attrs:{ class: tw`text-xs ${token('muted')}` }}, [line.modifiers.join(' â€¢ ')]) : null,
          line.notes ? D.Text.Span({ attrs:{ class: tw`text-xs ${token('muted')}` }}, ['ğŸ“ ', line.notes]) : null
        ].filter(Boolean),
        trailing:[
          UI.QtyStepper({ value:line.qty, gkeyDec:'pos:order:line:dec', gkeyInc:'pos:order:line:inc', gkeyEdit:'pos:order:line:qty', dataId:line.id }),
          UI.PriceText({ amount:line.total, currency:'EGP', locale:'ar-EG' }),
          UI.Button({ attrs:{ gkey:'pos:order:line:actions' }, variant:'ghost', size:'sm' }, ['â‹¯'])
        ]
      });
    }

    function TotalsSection(totals){
      const rows = [
        { label:i18nDict.ui.subtotal, value:totals.subtotal },
        { label:i18nDict.ui.service, value:totals.service },
        { label:i18nDict.ui.vat, value:totals.vat },
        { label:i18nDict.ui.discount, value:totals.discount }
      ];
      return D.Containers.Div({ attrs:{ class: tw`space-y-2` }}, [
        ...rows.map(row=> UI.HStack({ attrs:{ class: tw`${token('split')} text-sm` }}, [
          D.Text.Span({ attrs:{ class: tw`${token('muted')}` }}, [row.label]),
          UI.PriceText({ amount:row.value, currency:'EGP', locale:'ar-EG' })
        ])),
        UI.Divider(),
        UI.HStack({ attrs:{ class: tw`${token('split')} text-lg font-semibold` }}, [
          D.Text.Span({}, [i18nDict.ui.total]),
          UI.PriceText({ amount:totals.due, currency:'EGP', locale:'ar-EG' })
        ])
      ]);
    }

    function PaymentSummary(db){
      const split = db.data.payments.split;
      const methods = db.data.payments.methods || [];
      return UI.Card({
        variant:'card/soft-1',
        title:'ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª',
        content: D.Containers.Div({ attrs:{ class: tw`space-y-2` }}, [
          ...split.map(entry=> UI.HStack({ attrs:{ class: tw`${token('split')} text-sm` }}, [
            D.Text.Span({}, [
              `${methods.find(m=>m.id===entry.method)?.icon || 'ğŸ’³'} ${methods.find(m=>m.id===entry.method)?.label || entry.method}`
            ]),
            UI.PriceText({ amount:entry.amount, currency:'EGP', locale:'ar-EG' })
          ])),
          UI.Button({ attrs:{ gkey:'pos:payments:split', class: tw`w-full` }, variant:'ghost', size:'sm' }, [i18nDict.ui.split])
        ])
      });
    }

    function OrderColumn(db){
      const order = db.data.order;
      return D.Containers.Section({ attrs:{ class: tw`flex flex-col gap-4` }}, [
        D.Containers.Section({ attrs:{ class: tw`${token('scroll-panel')}` }}, [
          D.Containers.Div({ attrs:{ class: tw`${token('scroll-panel/head')}` }}, [
            D.Containers.Div({ attrs:{ class: tw`flex flex-col` }}, [
              D.Text.Strong({}, [`Ø·Ù„Ø¨ ${order.id}`]),
              D.Text.Span({ attrs:{ class: tw`text-xs ${token('muted')}` }}, [`${i18nDict.ui.tables}: ${order.table.name} â€¢ ${i18nDict.ui.guests}: ${order.guests}`])
            ]),
            UI.Button({ attrs:{ gkey:'pos:tables:open' }, variant:'ghost', size:'sm' }, [i18nDict.ui.tables])
          ]),
          UI.ScrollArea({
            attrs:{ class: tw`${token('scroll-panel/body')} p-4 space-y-2` },
            children:[ order.lines && order.lines.length ? UI.List({ children: order.lines.map(OrderLine) }) : UI.EmptyState({ icon:'ğŸ§º', title:i18nDict.ui.cart_empty, description:'Ø§Ø®ØªØ± ØµÙ†ÙÙ‹Ø§ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¥Ø¶Ø§ÙØªÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨.' }) ]
          }),
          D.Containers.Div({ attrs:{ class: tw`${token('scroll-panel/footer')} space-y-4` }}, [
            TotalsSection(order.totals),
            UI.HStack({ attrs:{ class: tw`gap-2` }}, [
              UI.Button({ attrs:{ gkey:'pos:order:discount', class: tw`flex-1` }, variant:'ghost', size:'sm' }, ['Ø®ØµÙ…']),
              UI.Button({ attrs:{ gkey:'pos:order:note', class: tw`flex-1` }, variant:'ghost', size:'sm' }, [i18nDict.ui.notes]),
              UI.Button({ attrs:{ gkey:'pos:order:clear' }, variant:'ghost', size:'sm' }, ['Ù…Ø³Ø­'])
            ])
          ])
        ]),
        PaymentSummary(db),
        UI.StatCard({
          title:i18nDict.ui.reports,
          value:db.data.reports.salesToday,
          meta:`${i18nDict.ui.orders_count}: ${db.data.reports.ordersCount}`,
          footer:[
            UI.Button({ attrs:{ gkey:'pos:reports:toggle', class: tw`w-full` }, variant:'ghost', size:'sm' }, [i18nDict.ui.open_reports])
          ]
        })
      ]);
    }

    function FooterBar(db){
      return UI.Footerbar({
        left:[
          statusBadge(db.data.status.kds.state, i18nDict.ui.kds),
          UI.Button({ attrs:{ gkey:'pos:kds:connect' }, variant:'ghost', size:'sm' }, ['Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„'])
        ],
        right:[
          UI.Button({ attrs:{ gkey:'pos:order:save', class: tw`min-w-[120px]` }, variant:'soft', size:'md' }, [i18nDict.ui.save_order]),
          UI.Button({ attrs:{ gkey:'pos:payments:open', class: tw`min-w-[160px]` }, variant:'solid', size:'md' }, [i18nDict.ui.settle_and_print]),
          UI.Button({ attrs:{ gkey:'pos:order:print', class: tw`min-w-[120px]` }, variant:'ghost', size:'md' }, [i18nDict.ui.print])
        ]
      });
    }

    function TablesModal(db){
      if(!db.ui.modals.tables) return null;
      const tables = db.data.tables || [];
      return UI.Modal({
        open:true,
        title:i18nDict.ui.tables,
        description:'Ø§Ø®ØªØ± Ø·Ø§ÙˆÙ„Ø© Ù„Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø¯Ù…Ø¬ Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª.',
        actions:[
          UI.ScrollArea({
            attrs:{ class: tw`max-h-[60vh] w-full space-y-2 p-4` },
            children: tables.map(table=> UI.ListItem({
              leading: D.Text.Span({ attrs:{ class: tw`text-lg` }}, ['ğŸª‘']),
              content:[
                D.Text.Strong({}, [table.name]),
                D.Text.Span({ attrs:{ class: tw`text-xs ${token('muted')}` }}, [`${i18nDict.ui.guests}: ${table.seats}`])
              ],
              trailing:[ statusBadge(table.status==='available'?'online': table.status==='occupied'?'idle':'offline', table.status) ],
              attrs:{ gkey:'pos:tables:select', 'data-table-id':table.id }
            }))
          }),
          UI.Button({ attrs:{ gkey:'pos:tables:merge' }, variant:'ghost', size:'sm' }, ['Ø¯Ù…Ø¬ Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª'])
        ]
      });
    }

    function PaymentsSheet(db){
      if(!db.ui.modals.payments) return null;
      return UI.Drawer({
        open:true,
        side:'end',
        header:D.Containers.Div({ attrs:{ class: tw`space-y-1` }}, [
          D.Text.Strong({}, [i18nDict.ui.payments]),
          D.Text.Span({ attrs:{ class: tw`text-xs ${token('muted')}` }}, ['Ù‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø©.'])
        ]),
        content:D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
          UI.ChipGroup({
            items: db.data.payments.methods.map(method=> ({ id:method.id, label:`${method.icon} ${method.label}`, attrs:{ gkey:'pos:payments:method', 'data-method-id':method.id } })),
            activeId: db.data.payments.methods[0]?.id
          }),
          UI.Button({ attrs:{ gkey:'pos:payments:capture', class: tw`w-full` }, variant:'solid', size:'md' }, ['ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹'])
        ])
      });
    }

    function ReportsDrawer(db){
      if(!db.ui.modals.reports) return null;
      return UI.Drawer({
        open:true,
        side:'start',
        header:D.Containers.Div({ attrs:{ class: tw`space-y-1` }}, [
          D.Text.Strong({}, [i18nDict.ui.reports]),
          D.Text.Span({ attrs:{ class: tw`text-xs ${token('muted')}` }}, ['Ù…Ø¤Ø´Ø±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† IndexedDB.'])
        ]),
        content:D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
          UI.StatCard({ title:'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', value:db.data.reports.salesToday }),
          UI.StatCard({ title:'Ø£ÙØ¶Ù„ ØµÙ†Ù', value:db.data.reports.topItem }),
          UI.StatCard({ title:i18nDict.ui.avg_ticket, value:db.data.reports.avgTicket })
        ])
      });
    }

    Mishkah.app.setBody(function(db){
      return UI.AppRoot({
        shell: D.Containers.Div({ attrs:{ class: tw`min-h-screen flex flex-col` }}, [
          Header(db),
          D.Containers.Main({ attrs:{ class: tw`flex-1 grid gap-4 lg:grid-cols-[minmax(0,2.2fr)_minmax(0,1fr)] p-4 pb-24` }}, [
            MenuColumn(db),
            OrderColumn(db)
          ]),
          FooterBar(db)
        ]),
        overlays:[
          TablesModal(db),
          PaymentsSheet(db),
          ReportsDrawer(db),
          db.ui?.toasts ? UI.ToastHost({ toasts: db.ui.toasts }) : null
        ].filter(Boolean)
      });
    });

    app.setOrders(Object.assign({}, UI.orders, auto.orders));
    app.mount('#app');
  })();
  </script>
</body>
</html>

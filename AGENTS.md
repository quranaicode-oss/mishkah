بسم الله الرحمن الرحيم

# Mishkah — تعليمات المساعد الهندسية الملزمة

> **نطاق المستند:** ينطبق هذا الدليل على كامل المستودع. أي كود أو توثيق تُعدّله هنا يجب أن يلتزم حرفيًا بما يلي.

## 1. أولوية HTMLx في كل المشاريع الجديدة
- أي مشروع أو شاشة جديدة **يجب** أن تُكتب بصيغة `HTMLx.html` (مثل `index-htmlx-v2.html`).
- اعتبر HTMLx هو المسار الافتراضي؛ لا يُسمح بالعودة إلى القوالب المتفرقة أو المزج بين ملفات HTML/CSS/JS منفصلة إلا في حالات الصيانة التاريخية.
- ادرس الملفين `mishkah-htmlx.js` و`index-htmlx-v2.html` قبل البدء. كلاهما المرجع الأساسي لتراكيب Mishkah HTMLx الحالية وأساليب الأوامر المرافقة.

## 2. أسلوب الكتابة في HTMLx — قاعدة التجاور البصري والمنطقي
- كل مكوّن داخل ملف HTMLx يجب أن يملك **نطاقًا واضحًا** باستخدام `<template id="...">` أو `<section data-m-scope="...">` بحيث تُجمع بياناته (`<script data-m-data>`)، والعرض (`markup`)، والوظائف المرافقة (`<script>`) داخل النطاق نفسه.
- ضع CSS الخاص بالمكوّن داخل `<style data-m-scope>` ملاصقًا لبقية عناصره. الهدف أن يجد المطوّر كل ما يخص المكوّن في بقعة واحدة.
- استخدم التعابير `{...}` ووسوم HTMLx المساعدة (`x-if`, `x-for`, bindings) كما في `index-htmlx-v2.html`، وتجنّب منطق JavaScript داخل القالب نفسه؛ حرّكه إلى وظائف موضعية داخل `<script>` بنفس النطاق.

## 3. تفضيل عناصر Mishkah Components على وسوم HTML الخام
- عند بناء الواجهات داخل HTMLx **استخدم `<comp name="...">`** أو استدعِ المكوّنات المسجلة بدلًا من كتابة وسم HTML بدائي مباشرة، للاستفادة من قدرات Mishkah في إعادة الاستعمال وإدارة الحالة.
- يُسمح باستعمال الوسوم القياسية عندما يكون هناك سبب وجيه (مثل عناصر الجذر أو أماكن لا يتوفر لها مكوّن جاهز)، لكن عليك التفكير أولًا في تحويلها إلى مكوّن واضح.
- كل استدعاء لمكوّن يجب أن يلتزم بتسمية معبّرة وتوثيق سريع للخصائص (`attrs`) والأحداث التي يدعمها.

## 4. تنظيم المكوّنات بين العامة والمتخصصة
- **المكوّنات العامة القابلة لإعادة الاستخدام عبر المشاريع** (أزرار، Panels، Forms، Modal، إلخ) تُضاف حصريًا إلى `mishkah-ui.js`. حدّث المستندات المصاحبة إن لزم الأمر.
- **المكوّنات المتخصصة** تربط بنطاق مجال محدد (POS، KDS، ERP، E-Commerce، SocialNW، ...). اجمعها في ملف `ui/<domain>-ui.js` أو ملف جديد يحمل هوية المجال (مثل `ui/erp-ui.js`).
- داخل ملفات HTMLx استدعِ هذه المكوّنات عبر `<comp>` مع السمات والأحداث الخاصة بها، ولا تُكرر تعريفها داخل الصفحة.

## 5. متى نلجأ إلى DSL
- إطار Mishkah DSL يُستخدم فقط عند **تعريف المكوّنات العامة أو المتخصصة** داخل مكتبات الـ UI. لا تستخدم DSL داخل صفحات HTMLx إلا لهذا الغرض.
- أثناء كتابة DSL تذكّر القواعد الآتية:
  - عرّف `attrs`, `events`, و`[children]` بوضوح، واحتفظ بتسميات متسقة.
  - التزم بتصنيفات الذرات (Atoms) الصارمة كما في الدليل الأصلي؛ لا تخلط بين فئات `Containers`, `Text`, `Forms`, `Inputs`, إلخ.
  - وفّر أمثلة استخدام مختصرة في تعليق ملاصق للمكوّن أو في مستندات UI.

## 6. تعدد اللغات والثيمات — شرط أساسي لا اختيار
- كل مشروع HTMLx يجب أن يحمّل بيانات `env` و`i18n` داخل نطاقه (`data-m-env`, `data-m-data`) لدعم العربية/الإنجليزية على الأقل، مع إتاحة توسيع اللغات بسهولة.
- وفّر تبديل الثيم (Light/Dark) افتراضيًا. استخدم الأدوات الموجودة في `U.twcss.auto` أو ما يعادلها، ولا تحذفها إلا إذا كان السبب مبررًا ومذكورًا في التعليقات.

## 7. Tailwind twcss المدمج
- يوجد نظام Tailwind مدمج ضمن Mishkah. **استخدمه دائما بشكل افتراضي** ما لم يُطلب صراحةً تجنبه ..

## 8. PWA اختياري لكن مرغوب فيه بشدة

-        تفعيل PWA أمر اختياري في الوقت الحالي لكنه مرغوب به به بشدة .
-  ## 9.  التطوير أساسي

- نحن في مرحلة تطوير الإطار؛ إذا اكتشفت نقصًا أو خطأ في `core`, `utils`, أو `ui` (أو حتى في HTMLx parser) فعليك اقتراح التعديل وتنفيذه عند الضرورة بدلاً من الالتفاف عليه بشرط ألا تكسر الكود الحالي أو تحدث مشاكل في التطبيقات القديمة العاملة على ذات النواة و ال utils و ui .

## 10. أوامر Mishkah وسير العمل التطبيقي
- اربط كل عناصر HTMLx بأوامر واضحة عبر `ctx` وواجهات Mishkah الحديثة. استخدم نمط `commit(ctx, draftMutator, [afterEffect])` كما هو ظاهر في `index-htmlx-v2.html`.
- حافظ على الفصل بين حالة التطبيق (`state`) ومنطق الأوامر. لا تتعامل مع DOM مباشرة داخل الأوامر أو وظائف HTMLx.

## 11. المتابعة والتوثيق
-   أي تحديث كبير في أسلوب HTMLx أو في DSL يستوجب تحديثًا موازيًا في `docs/` (انظر التعليمات الخاصة بملف `docs/tinysdk.md`) وكذلك يستوجب عدم كسر التطبيقات الحالية التي تعمل .
- اختبارات متعددة اللغات والثيمات جزء من تعريف الاكتمال لأي مهمة Frontend ضمن Mishkah.

باتباع هذه البنود ستحافظ على وضوح HTMLx وتستفيد بالكامل من قوة Mishkah في تنظيم الواجهات وتوحيد التجربة.

# Mishkah TinySDK — دليل الانطلاق السريع

> هذا المستند يشرح للمطورين الجدد كيفية العمل بفعالية مع مكتبة Mishkah TinySDK بالاعتماد على أسلوب `HTMLx.html`. اعتبره خريطة طريق عملية: من تجهيز البيانات وحتى بناء المكوّنات وتوصيل الأوامر.

## 1. نظرة عامة
- **TinySDK** هو طبقة التشغيل الخفيفة لـ Mishkah. مهمتها أن تربط بين ملفات HTMLx (مكان بناء الواجهات) وبين نواة Mishkah (حيث تعيش الحالة والأوامر والمكوّنات).
- الركيزة الأساسية هي أن الملف الواحد (`*.HTMLx.html`) يجمع كل شيء: البيئة، البيانات الابتدائية، القوالب، والوظائف المرافقة. اطلع على `index-htmlx-v2.html` لترى صورة مكتملة للهيكل.
- عند الحاجة إلى مراجعة البنية الداخلية أو الأدوات المساعدة راجع `mishkah-htmlx.js`، فهو يوفر خريطة واضحة للدوال المتاحة في TinySDK.

## 2. تجهيز ملف HTMLx جديد
1. **ابدأ بسمية واضحة**: أنشئ ملفًا باسم يعكس الشاشة، مثل `orders-dashboard-htmlx.html`.
2. **هيكل الوثيقة الأساسي**:
   - استخدم صفحة HTML عادية مع `<head>` تحوي الخطوط والأنماط العامة.
   - داخل `<body>` ضع `<template id="...">` يمثل نطاق التطبيق الرئيسي (يمكنك تقسيمه لاحقًا لأكثر من نطاق إذا احتجت).
3. **البيانات الابتدائية** داخل النطاق:
   - `data-m-env`: تحدد اللغة، الاتجاه، والثيم الافتراضي.
   - `data-m-data`: تحمل هيكل `state.data` الابتدائي (قوائم، إعدادات، الخ).
   - `data-m-i18n` أو `data-m-data data-m-path="i18n.strings"`: لتهيئة الترجمات.
4. **خرائط AJAX أو مصادر خارجية** تضاف عبر `data-m-ajax-map` عندما يلزم جلب بيانات لاحقًا.

## 3. قاعدة التجاور داخل النطاق
- لكل نطاق HTMLx اجمع العناصر بالترتيب الآتي: البيانات (JSON scripts) → الأنماط (`<style data-m-scope>`) → القالب (HTML مع تعابير HTMLx) → وظائف JavaScript المحلية.
- الهدف أن يعثر أي مطور على كل ما يتعلق بالمكوّن في كتلة واحدة دون القفز بين ملفات متعددة.

## 4. بناء الواجهات باستخدام `<comp>`
- TinySDK يشجع على بناء الواجهات عبر **مكوّنات مسجلة** بدلًا من كتابة وسوم HTML خام.
- استخدم `<comp name="Button" variant="primary" label="...">` أو ما يشبهه لاستدعاء مكوّنات من `mishkah-ui.js`.
- المكوّنات المتخصصة لكل مجال تجمع داخل ملف UI خاص في مجلد `ui/`، وتستدعى بنفس الطريقة.
- إذا افتقدت مكوّنًا عامًا، عرّفه في `mishkah-ui.js` باستخدام DSL وانشر واجهته (`attrs`, `events`, `[children]`).

## 5. العمل مع DSL عند إنشاء المكوّنات
- DSL هو الطريقة الرسمية لتعريف المكوّنات القابلة لإعادة الاستخدام.
- البنية العامة:
  ```javascript
  UI.define('Button', {
    attrs: { variant: { type: 'string', default: 'primary' } },
    events: ['click'],
    children: ['default'],
    render({ attrs, children, h, atoms: D }) {
      return D.Forms.Button({
        class: `btn btn-${attrs.variant}`,
        onClick: attrs.onClick,
        children,
      });
    },
  });
  ```
- حافظ على تصنيف الذرات (Atoms) الصارم (`D.Containers`, `D.Forms`, `D.Inputs`, ...). هذه القاعدة تمنع أخطاء البناء وتضمن انسجام المكوّنات مع المحرك.

## 6. ربط الحالة والأوامر
- داخل سكريبت النطاق، استخدم واجهات TinySDK:
  - `runtime()` للحصول على مراجع البيئة (مثال: `applyEnvironment`, `persistPrefs`).
  - `commit(ctx, draftMutator, afterEffect?)` لتحديث الحالة بطريقة آمنة. انظر إلى وظائف `setTheme` و`setLanguage` في `index-htmlx-v2.html` كمثال تطبيقي.
  - `ctx.getState()` لقراءة الحالة الحالية، و`ctx.set(path, value)` للتحديثات الموضعية.
- الأوامر يمكن تعريفها محليًا داخل النطاق أو استدعاؤها من مكتبات مشتركة. المهم أن تظل منفصلة عن DOM، وأن تتحدث مع الحالة فقط.

## 7. التدويل وتعدد الثيمات
- اجعل `env.lang`, `env.dir`, و`env.theme` جزءًا من البيانات الابتدائية في كل مشروع.
- استخدم الدالة `trans('key')` أو ما يماثلها لاسترجاع النص المناسب من `i18n.strings`.
- وفر واجهة لتبديل اللغة والثيم (أزرار أو قائمة)، واستعمل `commit` لتحديث الحالة، ثم `runtime().applyEnvironment(state)` لمزامنة الاتجاه والثيم مع DOM.

## 8. إدارة الأنماط
- أولوية TinySDK هي  التكامل مع Tailwind HTMLx.
- Tailwind (`twcss`) مدمج لكن يفترض استعماله ما لم يُطلب بوضوح تجنبه . .
- تأكد أن الأنماط تراعي الوضعين الفاتح والداكن، وأنها تلتزم بالخطوط المعتمدة في المشروع.

## 9. الاستفادة من `U` و `utils`
- قبل كتابة أي وظيفة مساعدة جديدة ابحث في `mishkah-utils.js` و`Mishkah.utils`. إن وجدت ما تحتاجه استعمله مباشرة.
- إذا احتجت وظيفة جديدة، أضفها إلى `utils` ثم استخدمها. لا تكرر منطقًا خامًا داخل HTMLx.

## 10. اختبارات الجودة قبل التسليم
- تأكد أن تبديل اللغة والثيم يعملان دون إعادة تحميل الصفحة.
- راقب أوامر HTMLx عبر `ctx` وتأكد من عدم وجود تلاعب مباشر بـ DOM.
- إذا غيّرت أو حسّنت أدوات TinySDK (UI, utils, core, parser)، وثّق التغيير في ملفات `docs/` المناسبة وأضف ملاحظات الترحيل إن لزم.

باتباع هذه الخطوات تستطيع بناء واجهات Mishkah بكفاءة ووضوح، مع الحفاظ على قوة HTMLx وسهولة TinySDK.

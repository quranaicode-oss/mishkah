<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <title>Ù…Ø´ÙƒØ§Ø© â€” ØªØ¨ÙˆÙŠØ¨Ø§Øª + Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù…Ø«Ø§Ù„</title>

  <script src="./mishkah-utils.js"></script>
  <script src="./mishkah.core.js"></script>
  <script src="./mishkah-ui.js"></script>
  <script src="./readme.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light dark;
      --page-gradient: linear-gradient(160deg, #f8f9ff 0%, #e8ecff 100%);
      --page-overlay-1: radial-gradient(circle at 20% 25%, rgba(79, 70, 229, 0.18), transparent 55%);
      --page-overlay-2: radial-gradient(circle at 80% 70%, rgba(14, 165, 233, 0.18), transparent 50%);
      --panel-glass: rgba(255, 255, 255, 0.78);
      --panel-border: rgba(99, 102, 241, 0.12);
      --panel-shadow: 0 25px 50px -20px rgba(15, 23, 42, 0.18);
      --tile-bg: linear-gradient(160deg, rgba(255, 255, 255, 0.95), rgba(241, 245, 249, 0.85));
      --tile-bg-revealed: linear-gradient(160deg, rgba(129, 140, 248, 0.75), rgba(79, 70, 229, 0.65));
      --tile-border: rgba(99, 102, 241, 0.25);
      --letters-shadow: 0 18px 45px -24px rgba(15, 23, 42, 0.35);
      --letters-hover: 0 25px 50px -20px rgba(99, 102, 241, 0.45);
      --accent-ring: rgba(79, 70, 229, 0.18);
      --tile-size: 3.1rem;
      --user-font-scale: 100;
      --font-size-body: 1rem;
      --font-size-scale-xs: 0.78rem;
      --font-size-scale-sm: 0.9rem;
      --font-size-scale-md: 1rem;
      --font-size-scale-lg: 1.18rem;
      --font-size-scale-xl: 1.38rem;
      --font-size-scale-2xl: 1.8rem;
      --font-size-scale-3xl: 2.35rem;
      --font-size-heading-1: 2.6rem;
      --font-size-heading-2: 2.05rem;
      --font-size-heading-3: 1.62rem;
      --font-size-sidebar: 1.05rem;
      --font-size-quote: 1.18rem;
      --font-size-info: 1.22rem;
      --font-size-letter: 1.35rem;
      --font-size-status: 1.22rem;
      --font-size-badge: 0.82rem;
    }

    :root.dark {
      --page-gradient: linear-gradient(160deg, #0d1224 0%, #111c3d 100%);
      --page-overlay-1: radial-gradient(circle at 80% 30%, rgba(168, 85, 247, 0.22), transparent 55%);
      --page-overlay-2: radial-gradient(circle at 15% 80%, rgba(56, 189, 248, 0.18), transparent 55%);
      --panel-glass: rgba(17, 25, 40, 0.75);
      --panel-border: rgba(148, 163, 184, 0.32);
      --panel-shadow: 0 25px 50px -18px rgba(15, 23, 42, 0.55);
      --tile-bg: linear-gradient(160deg, rgba(30, 41, 59, 0.78), rgba(15, 23, 42, 0.92));
      --tile-bg-revealed: linear-gradient(160deg, rgba(99, 102, 241, 0.55), rgba(79, 70, 229, 0.38));
      --tile-border: rgba(148, 163, 184, 0.35);
      --letters-shadow: 0 20px 40px -18px rgba(148, 163, 184, 0.35);
      --letters-hover: 0 28px 60px -20px rgba(99, 102, 241, 0.6);
      --accent-ring: rgba(129, 140, 248, 0.35);
    }

    @media (min-width: 640px) {
      :root { --tile-size: 3.25rem; }
    }

    @media (min-width: 1024px) {
      :root { --tile-size: 3.4rem; }
    }

    * {
      box-sizing: border-box;
    }

    .text-xs { font-size: calc(var(--font-size-scale-xs) * var(--user-font-scale) / 100) !important; }
    .text-xxs { font-size: calc(var(--font-size-scale-xs) * 0.9 * var(--user-font-scale) / 100) !important; }
    .text-sm { font-size: calc(var(--font-size-scale-sm) * var(--user-font-scale) / 100) !important; }
    .text-base { font-size: calc(var(--font-size-scale-md) * var(--user-font-scale) / 100) !important; }
    .text-lg { font-size: calc(var(--font-size-scale-lg) * var(--user-font-scale) / 100) !important; }
    .text-xl { font-size: calc(var(--font-size-scale-xl) * var(--user-font-scale) / 100) !important; }
    .text-2xl { font-size: calc(var(--font-size-scale-2xl) * var(--user-font-scale) / 100) !important; }
    .text-3xl { font-size: calc(var(--font-size-scale-3xl) * var(--user-font-scale) / 100) !important; }

    .sidebar-nav-button {
      font-size: calc(var(--font-size-sidebar) * var(--user-font-scale) / 100) !important;
      font-weight: 600;
    }

    .header-status-strip {
      display: inline-flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1.1rem;
      border-radius: 999px;
      background: color-mix(in oklab, var(--surface-2) 75%, transparent);
      border: 1px solid color-mix(in oklab, var(--border) 55%, transparent);
      box-shadow: 0 18px 40px -28px rgba(79, 70, 229, 0.45);
    }

    .header-status-block {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .header-status-label {
      color: var(--muted-foreground);
      font-size: calc(var(--font-size-scale-sm) * var(--user-font-scale) / 100);
    }

    .header-status-value {
      font-size: calc(var(--font-size-status) * var(--user-font-scale) / 100);
      font-weight: 700;
      color: var(--foreground);
    }

    .header-status-hearts {
      font-size: calc(var(--font-size-status) * var(--user-font-scale) / 100);
      display: inline-flex;
      gap: 0.25rem;
    }

    .segmented-switch {
      display: inline-flex;
      align-items: center;
      position: relative;
      padding: 0.25rem;
      gap: 0.25rem;
      border-radius: 999px;
      border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
      background: color-mix(in oklab, var(--surface-1) 85%, transparent);
      box-shadow: 0 14px 32px -24px rgba(15, 23, 42, 0.4);
    }

    .segmented-switch__option {
      position: relative;
      border: none;
      background: transparent;
      color: var(--muted-foreground);
      padding: 0.35rem 0.95rem;
      border-radius: 999px;
      cursor: pointer;
      transition: color 0.25s ease;
      font-size: calc(var(--font-size-scale-sm) * var(--user-font-scale) / 100);
      font-weight: 600;
      min-width: 3.6rem;
    }

    .segmented-switch__option::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: transparent;
      opacity: 0;
      transition: opacity 0.25s ease, transform 0.25s ease;
      z-index: -1;
    }

    .segmented-switch__option.is-active {
      color: var(--primary-foreground);
    }

    .segmented-switch__option.is-active::before {
      background: var(--primary);
      opacity: 1;
      transform: scale(1.02);
      box-shadow: 0 18px 38px -22px rgba(79, 70, 229, 0.55);
    }

    .segmented-switch__option:focus-visible {
      outline: 2px solid var(--accent-ring);
      outline-offset: 2px;
    }

    .design-lab-grid {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .design-lab-row {
      display: grid;
      gap: 0.6rem;
      align-items: center;
      padding: 0.6rem 0.85rem;
      border-radius: 1.1rem;
      border: 1px solid color-mix(in oklab, var(--border) 55%, transparent);
      background: color-mix(in oklab, var(--surface-2) 74%, transparent);
      box-shadow: 0 14px 32px -26px rgba(15, 23, 42, 0.35);
    }

    .design-lab-row[data-type='color'] {
      grid-template-columns: minmax(0, 200px) 72px minmax(0, 180px) minmax(0, 1fr) auto;
    }

    .design-lab-row[data-type='range'] {
      grid-template-columns: minmax(0, 220px) minmax(0, 140px) minmax(0, 1fr) minmax(0, 110px) auto;
    }

    .design-lab-row[data-type='text'] {
      grid-template-columns: minmax(0, 220px) minmax(0, 1fr) auto;
    }

    .design-lab-label {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      font-size: calc(var(--font-size-scale-sm) * var(--user-font-scale) / 100);
      color: var(--muted-foreground);
    }

    .design-lab-label strong {
      color: var(--foreground);
      font-size: calc(var(--font-size-scale-md) * var(--user-font-scale) / 100);
    }

    .design-lab-meta {
      font-size: calc(var(--font-size-scale-xs) * var(--user-font-scale) / 100);
      color: color-mix(in oklab, var(--muted-foreground) 80%, transparent);
    }

    .design-lab-color-chip {
      width: 48px;
      height: 48px;
      border-radius: 0.9rem;
      border: 1px solid color-mix(in oklab, var(--border) 65%, transparent);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.2);
    }

    .design-lab-color-input {
      width: 100%;
      height: 2.6rem;
      border-radius: 0.9rem;
      border: 1px solid color-mix(in oklab, var(--border) 55%, transparent);
      background: color-mix(in oklab, var(--surface-1) 85%, transparent);
      cursor: pointer;
    }

    .design-lab-value-input,
    .design-lab-number-input {
      width: 100%;
      border-radius: 0.85rem;
      border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
      background: color-mix(in oklab, var(--surface-1) 88%, transparent);
      padding: 0.45rem 0.75rem;
      color: var(--foreground);
      font-size: calc(var(--font-size-scale-sm) * var(--user-font-scale) / 100);
    }

    .design-lab-value-input:focus,
    .design-lab-number-input:focus {
      outline: 2px solid var(--accent-ring);
      outline-offset: 2px;
    }

    .design-lab-slider {
      width: 100%;
      accent-color: var(--primary);
      height: 0.4rem;
    }

    .design-lab-font-preview {
      display: inline-flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.35rem;
      padding: 0.25rem 0.4rem;
      border-radius: 0.75rem;
      background: color-mix(in oklab, var(--surface-1) 80%, transparent);
      color: var(--foreground);
      min-height: 2.2rem;
    }

    .design-lab-reset {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2.1rem;
      height: 2.1rem;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted-foreground);
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .design-lab-reset:hover:not([disabled]) {
      background: color-mix(in oklab, var(--primary) 18%, transparent);
      color: var(--primary);
    }

    .design-lab-reset[disabled] {
      opacity: 0.35;
      cursor: not-allowed;
    }

    .game-info-text {
      font-size: calc(var(--font-size-info) * var(--user-font-scale) / 100);
      color: color-mix(in oklab, var(--foreground) 96%, var(--muted-foreground) 4%);
      line-height: 1.9;
      font-weight: 500;
    }

    .focus-pulse {
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 65%, transparent), 0 0 0 12px rgba(79, 70, 229, 0.18);
      animation: focusPulse 2.2s ease-in-out forwards;
    }

    .glow-outline.focus-pulse {
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 55%, transparent), 0 0 0 14px rgba(79, 70, 229, 0.18), var(--panel-shadow);
    }

    .solution-target {
      scroll-margin-block-start: 18vh;
      position: relative;
    }

    .solution-target:focus-visible {
      outline: 3px solid color-mix(in oklab, var(--primary) 70%, transparent);
      outline-offset: 4px;
    }

    .solution-target.glow-outline {
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 65%, transparent),
        0 0 0 16px rgba(79, 70, 229, 0.16),
        var(--panel-shadow);
    }

    .sweet-notice-overlay {
      position: fixed;
      inset: 0;
      z-index: 70;
      display: grid;
      place-items: center;
      padding: 2rem 1.5rem;
    }

    .sweet-notice-overlay::before {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(6, 12, 24, 0.55);
      backdrop-filter: blur(10px);
    }

    .sweet-notice-overlay > * {
      position: relative;
      z-index: 1;
    }

    .sweet-notice-card {
      width: min(480px, 94vw);
    }

    body {
      margin: 0;
      min-height: 100vh;
      height: 100vh;
      font-family: 'Tajawal', 'Cairo', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: calc(var(--font-size-body) * var(--user-font-scale) / 100);
      background: var(--page-gradient);
      color: var(--foreground);
      position: relative;
      overflow: hidden;
      transition: background 0.45s ease, color 0.45s ease;
    }

    body::before,
    body::after {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      background: var(--page-overlay-1);
      mix-blend-mode: screen;
      animation: pulseNebula 18s ease-in-out infinite alternate;
    }

    body::after {
      background: var(--page-overlay-2);
      animation-delay: 6s;
    }

    #app {
      position: relative;
      z-index: 1;
    }

    .app-shell {
      min-height: 100vh;
      max-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .content-shell {
      flex: 1;
      min-height: 0;
      display: flex;
      overflow: hidden;
    }

    .main-region {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding-bottom: 4rem;
      scroll-behavior: smooth;
    }

    .glass-panel {
      background: var(--panel-glass);
      backdrop-filter: blur(26px) saturate(135%);
      border: 1px solid var(--panel-border);
      box-shadow: var(--panel-shadow);
      transition: border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    }

    .glow-outline {
      box-shadow: 0 0 0 1px var(--accent-ring), var(--panel-shadow);
    }

    .animate-float {
      animation: floatHalo 14s ease-in-out infinite;
    }

    .letter-tile {
      transition: transform 0.35s ease, box-shadow 0.35s ease, background 0.35s ease;
      border: 1px solid var(--tile-border);
      background: var(--tile-bg);
      color: var(--foreground);
      text-shadow: 0 2px 12px rgba(15, 23, 42, 0.2);
    }

    .letter-slot {
      width: var(--tile-size);
      height: var(--tile-size);
    }

    .letter-space {
      width: calc(var(--tile-size) * 0.5);
      height: var(--tile-size);
    }

    .letter-tile[data-revealed="true"] {
      transform: translateY(-6px) scale(1.03);
      box-shadow: 0 18px 40px -22px rgba(79, 70, 229, 0.55);
      background: var(--tile-bg-revealed);
      color: #fff;
    }

    .letters-grid button {
      transition: transform 0.25s ease, box-shadow 0.25s ease, opacity 0.25s ease;
      box-shadow: var(--letters-shadow);
      font-size: calc(var(--font-size-letter) * var(--user-font-scale) / 100);
      font-weight: 700;
      border-radius: 0.9rem !important;
      height: var(--tile-size);
      min-height: var(--tile-size);
      min-width: var(--tile-size);
    }

    .letters-grid button:hover:not([disabled]) {
      transform: translateY(-5px) scale(1.03);
      box-shadow: var(--letters-hover);
    }

    .letters-grid button[disabled] {
      opacity: 0.35;
      cursor: not-allowed;
    }

    .md-prose {
      line-height: 1.8;
      font-size: calc(var(--font-size-scale-md) * var(--user-font-scale) / 100);
      color: var(--foreground);
    }

    .md-prose h1,
    .md-prose h2,
    .md-prose h3,
    .md-prose h4,
    .md-prose h5,
    .md-prose h6 {
      font-family: 'Cairo', 'Tajawal', system-ui, sans-serif;
      font-weight: 700;
      letter-spacing: 0.01em;
      color: color-mix(in oklab, var(--foreground) 92%, var(--primary) 8%);
      margin: 1.6em 0 0.8em;
    }

    .md-prose h1 {
      font-size: calc(var(--font-size-heading-1) * var(--user-font-scale) / 100);
    }

    .md-prose h2 {
      font-size: calc(var(--font-size-heading-2) * var(--user-font-scale) / 100);
    }

    .md-prose h3 {
      font-size: calc(var(--font-size-heading-3) * var(--user-font-scale) / 100);
    }

    .md-prose p {
      margin: 1em 0;
      color: color-mix(in oklab, var(--foreground) 88%, var(--muted-foreground) 12%);
      font-size: calc(var(--font-size-scale-md) * var(--user-font-scale) / 100);
    }

    .md-prose ul,
    .md-prose ol {
      margin: 1em 0;
      padding-inline-start: 1.4em;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
    }

    .md-prose li {
      position: relative;
      padding-inline-start: 0.3em;
    }

    .md-prose blockquote {
      margin: 1.2em 0;
      padding: 1.2em 1.5em;
      border-inline-start: 4px solid color-mix(in oklab, var(--primary) 80%, transparent);
      background: color-mix(in oklab, var(--surface-1) 80%, transparent);
      border-radius: 1.2rem;
      color: color-mix(in oklab, var(--foreground) 80%, var(--muted-foreground) 20%);
      box-shadow: 0 12px 30px -24px rgba(79, 70, 229, 0.45);
      font-size: calc(var(--font-size-quote) * var(--user-font-scale) / 100);
    }

    .md-prose pre {
      margin: 1.4em 0;
      padding: 1.2em 1.4em;
      border-radius: 1.2rem;
      background: color-mix(in oklab, var(--surface-2) 88%, transparent);
      box-shadow: 0 24px 45px -24px rgba(15, 23, 42, 0.45);
      overflow-x: auto;
      font-size: calc(var(--font-size-scale-sm) * var(--user-font-scale) / 100);
      direction: ltr;
      text-align: left;
    }

    .md-prose code {
      font-family: 'Fira Code', 'IBM Plex Mono', 'Cascadia Code', monospace;
      background: color-mix(in oklab, var(--surface-2) 85%, transparent);
      padding: 0.15em 0.4em;
      border-radius: 0.5em;
      font-size: calc(var(--font-size-scale-sm) * var(--user-font-scale) / 100);
    }

    .md-prose pre code {
      background: transparent;
      padding: 0;
    }

    .md-prose table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5em 0;
      border-radius: 1.2rem;
      overflow: hidden;
      box-shadow: 0 18px 45px -25px rgba(15, 23, 42, 0.35);
    }

    .md-prose thead {
      background: color-mix(in oklab, var(--surface-2) 55%, var(--primary) 45%);
      color: color-mix(in oklab, var(--primary-foreground) 65%, var(--foreground) 35%);
    }

    .md-prose th,
    .md-prose td {
      padding: 0.85em 1em;
      border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
      text-align: start;
    }

    .md-prose tbody tr:nth-child(even) {
      background: color-mix(in oklab, var(--surface-1) 80%, transparent);
    }

    .md-prose img {
      max-width: 100%;
      height: auto;
      display: inline-block;
      vertical-align: middle;
    }

    .settings-tile {
      border-radius: 1.5rem;
      padding: 1rem 1.25rem;
      background: color-mix(in oklab, var(--surface-2) 70%, transparent);
      border: 1px solid color-mix(in oklab, var(--border) 55%, transparent);
      box-shadow: 0 12px 35px -22px rgba(15, 23, 42, 0.35);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.75rem;
    }

    .toggle-switch {
      position: relative;
      width: 3.25rem;
      height: 1.65rem;
    }

    .toggle-switch input {
      appearance: none;
      -webkit-appearance: none;
      width: 100%;
      height: 100%;
      border-radius: 999px;
      background: color-mix(in oklab, var(--surface-2) 88%, transparent);
      border: 1px solid color-mix(in oklab, var(--border) 65%, transparent);
      position: relative;
      cursor: pointer;
      transition: background 0.25s ease, border-color 0.25s ease;
    }

    .toggle-switch input::after {
      content: '';
      position: absolute;
      inset-inline-start: 0.2rem;
      top: 0.18rem;
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 50%;
      background: color-mix(in oklab, var(--muted-foreground) 30%, white 70%);
      box-shadow: 0 10px 18px -10px rgba(15, 23, 42, 0.35);
      transition: transform 0.25s ease, background 0.25s ease;
    }

    .toggle-switch input:checked {
      background: color-mix(in oklab, var(--primary) 30%, transparent);
      border-color: color-mix(in oklab, var(--primary) 70%, transparent);
    }

    .toggle-switch input:checked::after {
      transform: translateX(1.55rem);
      background: var(--primary);
    }

    .game-panel {
      position: relative;
    }

    .game-board {
      position: relative;
      transition: transform 0.35s ease;
    }

    .puzzle-row {
      animation-duration: 0.6s;
      animation-timing-function: ease-in-out;
    }

    .game-board.feedback-correct .puzzle-row {
      animation-name: tilePop;
    }

    .game-board.feedback-wrong .puzzle-row {
      animation-name: tileShake;
    }

    .game-board.feedback-win .puzzle-row {
      animation-name: tileCelebrate;
    }

    .game-board.feedback-lose .puzzle-row {
      animation-name: tileFade;
    }

    .celebration-card,
    .gameover-card {
      position: relative;
      overflow: hidden;
    }

    .celebration-card::after {
      content: '';
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 50% 20%, rgba(79, 70, 229, 0.25), transparent 55%);
      opacity: 0.8;
      animation: pulseNebula 8s ease-in-out infinite;
      pointer-events: none;
    }

    .gameover-card::after {
      content: '';
      position: absolute;
      inset: -30%;
      background: radial-gradient(circle at 50% 80%, rgba(239, 68, 68, 0.25), transparent 65%);
      opacity: 0.7;
      animation: overlayPulse 6s ease-in-out infinite;
      pointer-events: none;
    }

    .game-overlay-content {
      position: relative;
      z-index: 1;
    }

    .confetti-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 25;
    }

    .confetti-piece {
      position: absolute;
      top: -10vh;
      width: 0.55rem;
      height: 1.6rem;
      border-radius: 999px;
      opacity: 0;
      animation: confettiFall 3.6s ease-in forwards;
    }

    .confetti-piece:nth-child(odd) {
      animation-duration: 4s;
    }

    .md-prose a {
      color: var(--primary);
      text-decoration: none;
      border-bottom: 1px solid color-mix(in oklab, var(--primary) 65%, transparent);
      transition: color 0.2s ease, border-color 0.2s ease;
    }

    .md-prose a:hover {
      color: color-mix(in oklab, var(--primary) 90%, black);
      border-color: currentColor;
    }

    .md-prose hr {
      margin: 2.5em 0;
      border: none;
      border-top: 1px dashed color-mix(in oklab, var(--border) 65%, transparent);
    }

    @keyframes floatHalo {
      0%, 100% { transform: translate3d(0, 0, 0); }
      50% { transform: translate3d(0, -18px, 0) scale(1.01); }
    }

    @keyframes pulseNebula {
      0% { opacity: 0.45; }
      50% { opacity: 0.75; }
      100% { opacity: 0.45; }
    }

    @keyframes tilePop {
      0% { transform: scale(0.94); }
      40% { transform: scale(1.06); }
      100% { transform: scale(1); }
    }

    @keyframes tileShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
    }

    @keyframes tileCelebrate {
      0% { transform: translateY(0) scale(1); }
      30% { transform: translateY(-10px) scale(1.05); }
      70% { transform: translateY(4px) scale(0.98); }
      100% { transform: translateY(0) scale(1); }
    }

    @keyframes tileFade {
      0% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    @keyframes overlayPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    @keyframes focusPulse {
      0% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.0); }
      40% { box-shadow: 0 0 0 18px rgba(79, 70, 229, 0.18); }
      70% { box-shadow: 0 0 0 6px rgba(79, 70, 229, 0.22); }
      100% { box-shadow: 0 0 0 12px rgba(79, 70, 229, 0.0); }
    }

    @keyframes confettiFall {
      0% { opacity: 0; transform: translate3d(0, -20vh, 0) rotate(0deg); }
      10% { opacity: 1; }
      100% { opacity: 0; transform: translate3d(0, 110vh, 0) rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
  (function(){
    const M = Mishkah, U = M.utils, UI = M.UI, D = M.DSL;
    const { tw } = U.twcss;
    const { makeLangLookup } = U.lang;

    /*
    ================================================================
    |                                                              |
    |      Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…: Ø±Ø­Ù„Ø© Ø§Ù„Ø®Ù„Ù‚ ÙÙŠ "Ù…Ø´ÙƒØ§Ø©"             |
    |                                                              |
    ================================================================
    |
    | Ø¥Ù† Ø¨Ù†Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ÙŠØ³ Ù…Ø¬Ø±Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙˆØ¯ØŒ Ø¨Ù„ Ù‡Ùˆ Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ø±Ø­Ù„Ø©
    | Ø§Ù„Ø®Ù„Ù‚ ÙˆØ§Ù„ØªÙƒÙˆÙŠÙ† ÙƒÙ…Ø§ ØªØµÙÙ‡Ø§ ÙÙ„Ø³ÙØ© "Ù…Ø´ÙƒØ§Ø©". Ø³Ù†Ù…Ø± Ø¨Ù…Ø±Ø­Ù„ØªÙŠÙ†
    | Ø£Ø³Ø§Ø³ÙŠØªÙŠÙ†ØŒ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ØªØªÙƒÙˆÙ† Ù…Ù† Ø²ÙˆØ¬ÙŠÙ†:
    |
    | 1. Ø§Ù„Ø²ÙˆØ¬ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„ØªØ³ÙˆÙŠØ© (ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø³Ø¯)
    |    - Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø·ÙŠÙ† ÙˆØ§Ù„Ø°Ø±Ø§Øª (Atoms as Components)
    |    - Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¹Ù„Ù… Ø§Ù„ÙØ·Ø±ÙŠ (database as DNA)
    |    Ø§Ù„Ù†ØªÙŠØ¬Ø©: Ø¬Ø³Ø¯ Ù…ÙØµÙˆÙ‘ÙØ± (VDOM) Ù‚Ø¨Ù„ Ù†ÙØ® Ø§Ù„Ø±ÙˆØ­.
    |
    | 2. Ø§Ù„Ø²ÙˆØ¬ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„ØªÙ…ÙƒÙŠÙ† ÙˆØ§Ù„ØªÙƒÙ„ÙŠÙ (Ù†ÙØ® Ø§Ù„Ø±ÙˆØ­ ÙˆØ§Ù„Ø­ÙŠØ§Ø©)
    |    - Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† (database as State)
    |    - Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­ (Orders)
    |    Ø§Ù„Ù†ØªÙŠØ¬Ø©: ÙƒØ§Ø¦Ù† Ø­ÙŠ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØªÙØ§Ø¹Ù„ ÙˆÙŠØ³ØªØ¬ÙŠØ¨.
    |
    */

    // ================================================================
    // Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ…Ù‡ÙŠØ¯ÙŠØ©: Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø®Ø§Ù… Ù„Ù„Ù…Ø¹Ø±ÙØ©
    // Ù‚Ø¨Ù„ Ø§Ù„Ø®Ù„Ù‚ØŒ Ù†Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©: Ø§Ù„Ù†ØµÙˆØµØŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆØ§Ù„Ù‚ÙˆØ§Ø¹Ø¯.
    // ================================================================

    /* ===================== i18n: Ø§Ù„Ù…Ø¹Ø§Ø¬Ù… Ø§Ù„Ù„ØºÙˆÙŠØ© ===================== */
    const dict = {
      'app.title'   : { ar:'Ù…Ø´ÙƒØ§Ø© â€” Ù…Ø´ÙƒØ§Ø© Ø§Ù„Ù†ÙˆØ± ÙˆÙ„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù…Ø«Ø§Ù„', en:'Mishkah â€” Lighthouse Docs & Proverbs Game' },
      'header.subtitle': { ar:'Ù…Ø±Ø¬Ø¹ Ø§Ù„Ù†ÙˆØ± ÙŠØ¬Ù…Ø¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ØŒ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ ÙˆÙ„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù…Ø«Ø§Ù„ ÙÙŠ Ù„ÙˆØ­Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØ§Ø³Ø¹Ø©.', en:'A radiant hub that unifies the docs, controls, and the Proverbs game in a spacious canvas.' },
      'header.theme.light': { ar:'Ù†Ù‡Ø§Ø±', en:'Light' },
      'header.theme.dark': { ar:'Ù„ÙŠÙ„', en:'Dark' },
      'header.lang.ar': { ar:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', en:'Arabic' },
      'header.lang.en': { ar:'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', en:'English' },
      'settings.toggleLabel': { ar:'Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', en:'Show controls' },
      'settings.switch.on': { ar:'Ù…ÙØ¹Ù‘Ù„Ø©', en:'Visible' },
      'settings.switch.off': { ar:'Ù…Ø®ÙÙŠØ©', en:'Hidden' },
      'settings.title': { ar:'Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©', en:'Intelligent Control Center' },
      'settings.description': { ar:'Ø§Ø¶Ø¨Ø· ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ø«ÙŠÙ… ÙˆØ§Ø­ØªÙØ¸ Ø¨ØªÙØ¶ÙŠÙ„Ø§ØªÙƒ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø².', en:'Tune the game experience and theming, and keep your preferences on this device.' },
      'settings.gameSection': { ar:'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©', en:'Game Settings' },
      'settings.themeSection': { ar:'Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø«ÙŠÙ…', en:'Theme Options' },
      'settings.backgroundLabel': { ar:'Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©', en:'Page background' },
      'settings.textLabel': { ar:'Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ±', en:'Text & accent colors' },
      'settings.fontLabel': { ar:'Ø­Ø¬Ù… Ø§Ù„Ø®Ø·', en:'Font size' },
      'settings.previewLabel': { ar:'Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙˆØ±ÙŠØ©', en:'Live preview' },
      'settings.previewHint': { ar:'Ø³ØªØªØ­Ø¯Ø« Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù„Ø­Ø¸ÙŠÙ‹Ø§ ÙˆØªØ­ÙØ¸ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.', en:'Changes update instantly and are stored in the browser.' },
      'settings.reset': { ar:'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', en:'Reset to defaults' },
      'settings.close': { ar:'Ø¥ØºÙ„Ø§Ù‚', en:'Close' },
      'designLab.openButton': { ar:'Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù†', en:'Design Lab' },
      'designLab.title': { ar:'Ù…Ø®ØªØ¨Ø± ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©', en:'Interface Design Lab' },
      'designLab.subtitle': { ar:'ØªØ­ÙƒÙ… Ø¨Ø¬Ù…ÙŠØ¹ Ù…ØªØºÙŠØ±Ø§Øª CSS Ù…Ù† Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø£Ø­Ø¬Ø§Ù… Ù…Ø¹ Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙˆØ±ÙŠØ©.', en:'Control every CSS variableâ€”from colors to sizesâ€”with live preview.' },
      'designLab.themeTitle': { ar:'Ø£ÙˆØ¶Ø§Ø¹ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø³Ø±ÙŠØ¹Ø©', en:'Quick Theme Modes' },
      'designLab.mode.light': { ar:'ÙˆØ¶Ø¹ Ù…Ø¶ÙŠØ¡', en:'Light Glow' },
      'designLab.mode.dark': { ar:'ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ', en:'Nightfall' },
      'designLab.mode.pink': { ar:'ÙˆØ¶Ø¹ ÙˆØ±Ø¯ÙŠ', en:'Pink Aurora' },
      'designLab.modeHint': { ar:'Ø§Ø®ØªØ± ÙˆØ¶Ø¹Ù‹Ø§ Ø«Ù… Ø®ØµØµ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø£Ø¯Ù†Ø§Ù‡.', en:'Pick a mode, then fine-tune every detail below.' },
      'designLab.resetAll': { ar:'Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª', en:'Reset All Variables' },
      'designLab.resetVar': { ar:'Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ', en:'Revert Default' },
      'designLab.currentValue': { ar:'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©', en:'Current value' },
      'designLab.defaultValue': { ar:'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', en:'Default value' },
      'designLab.group.core': { ar:'Ø£Ù„ÙˆØ§Ù† Ø¬ÙˆÙ‡Ø±ÙŠØ©', en:'Core Colors' },
      'designLab.group.coreHint': { ar:'Ø§Ø¶Ø¨Ø· Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¨Ø§Ø±Ø²Ø©.', en:'Tweak the primary text and accent colors.' },
      'designLab.group.surface': { ar:'Ø®Ù„ÙÙŠØ§Øª ÙˆØ·Ø¨Ù‚Ø§Øª', en:'Backgrounds & Layers' },
      'designLab.group.surfaceHint': { ar:'Ø®ØµØµ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª ÙˆØ§Ù„Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯.', en:'Customize page backdrops, glass layers, and borders.' },
      'designLab.group.effects': { ar:'ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ©', en:'Visual Effects' },
      'designLab.group.effectsHint': { ar:'ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¸Ù„Ø§Ù„ ÙˆØ§Ù„ØªÙˆÙ‡Ø¬Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨.', en:'Control shadows and glows used across the game.' },
      'designLab.group.typography': { ar:'Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø®Ø·ÙˆØ·', en:'Typography System' },
      'designLab.group.typographyHint': { ar:'Ø®ØµØµ Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù„ÙƒÙ„ Ø¬Ø²Ø¡.', en:'Tune heading and text sizes for every surface.' },
      'designLab.group.sizing': { ar:'Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ±', en:'Element Sizing' },
      'designLab.group.sizingHint': { ar:'Ø¶Ø¨Ø· Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·.', en:'Adjust tile sizes and the global font scale.' },
      'designLab.var.foreground': { ar:'Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', en:'Primary text color' },
      'designLab.var.muted': { ar:'Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ', en:'Muted text color' },
      'designLab.var.primary': { ar:'Ù„ÙˆÙ† Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', en:'Primary accent color' },
      'designLab.var.primaryForeground': { ar:'Ù„ÙˆÙ† Ø§Ù„Ù†Øµ ÙÙˆÙ‚ Ø§Ù„ØªÙ…ÙŠÙŠØ²', en:'Text on primary' },
      'designLab.var.accentRing': { ar:'ÙˆÙ‡Ø¬ Ø§Ù„Ø­ÙˆØ§Ù', en:'Accent ring glow' },
      'designLab.var.gradient': { ar:'ØªØ¯Ø±Ø¬ Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø©', en:'Page gradient' },
      'designLab.var.overlay1': { ar:'Ø·Ø¨Ù‚Ø© Ø¶ÙˆØ¦ÙŠØ© Ø£ÙˆÙ„Ù‰', en:'First light overlay' },
      'designLab.var.overlay2': { ar:'Ø·Ø¨Ù‚Ø© Ø¶ÙˆØ¦ÙŠØ© Ø«Ø§Ù†ÙŠØ©', en:'Second light overlay' },
      'designLab.var.panelGlass': { ar:'Ù„ÙˆÙ† Ø§Ù„Ù„ÙˆØ­ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ', en:'Glass panel tint' },
      'designLab.var.panelBorder': { ar:'Ù„ÙˆÙ† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù„ÙˆØ­', en:'Panel border color' },
      'designLab.var.tileBg': { ar:'Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª', en:'Tile background' },
      'designLab.var.tileRevealed': { ar:'Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª Ø§Ù„Ù…ÙƒØ´ÙˆÙØ©', en:'Revealed tile background' },
      'designLab.var.tileBorder': { ar:'Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª', en:'Tile border color' },
      'designLab.var.lettersShadow': { ar:'Ø¸Ù„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø±ÙˆÙ', en:'Letter buttons shadow' },
      'designLab.var.lettersHover': { ar:'ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ­ÙˆÙŠÙ… Ù„Ù„Ø­Ø±ÙˆÙ', en:'Letter hover effect' },
      'designLab.var.tileSize': { ar:'Ø­Ø¬Ù… Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª', en:'Tile size' },
      'designLab.var.font.body': { ar:'Ù†Øµ Ø§Ù„ÙÙ‚Ø±Ø§Øª', en:'Body text size' },
      'designLab.var.font.h1': { ar:'Ø¹Ù†ÙˆØ§Ù† Ù¡', en:'Heading 1 size' },
      'designLab.var.font.h2': { ar:'Ø¹Ù†ÙˆØ§Ù† Ù¢', en:'Heading 2 size' },
      'designLab.var.font.h3': { ar:'Ø¹Ù†ÙˆØ§Ù† Ù£', en:'Heading 3 size' },
      'designLab.var.font.scale3xl': { ar:'Ø¹Ù†ÙˆØ§Ù† Ø¹Ø±Ø¶ÙŠ (3XL)', en:'Display heading (3XL)' },
      'designLab.var.font.scale2xl': { ar:'Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ø±Ø² (2XL)', en:'Hero heading (2XL)' },
      'designLab.var.font.scaleXl': { ar:'Ø¹Ù†ÙˆØ§Ù† ÙØ±Ø¹ÙŠ (XL)', en:'Sub heading (XL)' },
      'designLab.var.font.scaleLg': { ar:'Ù†Øµ ÙƒØ¨ÙŠØ± (LG)', en:'Large text (LG)' },
      'designLab.var.font.scaleMd': { ar:'Ù†Øµ Ø£Ø³Ø§Ø³ÙŠ (MD)', en:'Body scale (MD)' },
      'designLab.var.font.scaleSm': { ar:'Ù†Øµ ØµØºÙŠØ± (SM)', en:'Small text (SM)' },
      'designLab.var.font.scaleXs': { ar:'ØªÙØ§ØµÙŠÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (XS)', en:'Micro text (XS)' },
      'designLab.var.font.sidebar': { ar:'Ù†Øµ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©', en:'Sidebar label size' },
      'designLab.var.font.quote': { ar:'Ù†Øµ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³', en:'Blockquote size' },
      'designLab.var.font.info': { ar:'Ù†Øµ Ø§Ù„Ù„ÙˆØ­Ø§Øª Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØ©', en:'Info panel text size' },
      'designLab.var.font.letter': { ar:'Ø­Ø¬Ù… Ø­Ø±ÙˆÙ Ø§Ù„Ù„Ø¹Ø¨', en:'Letter button size' },
      'designLab.var.font.status': { ar:'Ø­Ø¬Ù… Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø©', en:'Status strip size' },
      'designLab.var.fontScale': { ar:'Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø§Ù…', en:'Global font scale' },
      'nav.menu'       : { ar:'Ø§Ù„ØªÙ†Ù‚Ù„', en:'Navigation' },
      'nav.readmeBase' : { ar:'Ù…Ø´ÙƒØ§Ø© Ø§Ù„Ù†ÙˆØ± ÙˆØ§Ù„Ø°ÙƒØ± Ø§Ù„Ø£Ø¹Ù„Ù‰', en:'Mishkah of Light & Highest Remembrance' },
      'nav.readmeTec'  : { ar:'ÙˆØ«ÙŠÙ‚Ø© Ù…Ø´ÙƒØ§Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©', en:'Mishkah Technical Charter' },
      'nav.counter'    : { ar:'Ø§Ù„Ø¹Ø¯Ø§Ø¯', en:'Counter' },
      'nav.game'       : { ar:'Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù…Ø«Ø§Ù„', en:'Proverbs Game' },
      'nav.logic'      : { ar:'ØªØ­Ø¯ÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡', en:'Logic Trainer' },
      'doc.base.lead'  : { ar:'Ø±Ø­Ù„Ø© ÙÙ„Ø³ÙØ© Ù…Ø´ÙƒØ§Ø© ÙˆÙ…Ù†Ù‡Ø¬ Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø°ÙŠ Ø£Ù„Ù‡Ù… ØªØµÙ…ÙŠÙ…Ù‡Ø§.', en:'The philosophical journey behind Mishkah and the higher remembrance that inspires it.' },
      'doc.tec.lead'   : { ar:'Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© Ù…Ø´ÙƒØ§Ø© ÙˆÙ…Ø­Ø±ÙƒÙ‡Ø§ Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ.', en:'The complete technical dossier for Mishkahâ€™s architecture and declarative engine.' },
      'doc.language.hint': { ar:'Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ù„ØºØ© Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„ØªÙ‚Ø±Ø£ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø¨Ù„ØºØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©.', en:'Use the header controls to switch between Arabic and English.' },
      'counter.title'  : { ar:'Ø¹Ø¯Ø§Ø¯ Ø¨Ø³ÙŠØ·', en:'Simple Counter' },
      'counter.reset'  : { ar:'Ø¥Ø¹Ø§Ø¯Ø©', en:'Reset' },
      'game.title'     : { ar:'Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù…Ø«Ø§Ù„ Ùˆ Ø§Ù„Ø­ÙƒÙ…', en:'Proverbs & Wisdom Game' },
      'game.music'     : { ar:'Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„ØºØ§Ù…Ø±Ø©', en:'Mystery Music' },
      'game.timer'     : { ar:'Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ¹Ù„Ù…', en:'Learning Timer' },
      'game.seconds'   : { ar:'Ø«', en:'s' },
      'game.start'     : { ar:'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©', en:'Start Game' },
      'game.new'       : { ar:'Ù…Ø«Ù„ Ø¬Ø¯ÙŠØ¯', en:'New Proverb' },
      'game.tries'     : { ar:'Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©', en:'Tries Left' },
      'game.hintTitle' : { ar:'Ø§Ù„ØªÙ„Ù…ÙŠØ­ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ', en:'Educational Hint' },
      'game.win'       : { ar:'Ø±Ø¨Ø­Øª! ğŸ‰', en:'You won! ğŸ‰' },
      'game.lose'      : { ar:'Ù„Ù„Ø£Ø³Ù Ø®Ø³Ø±Øª ğŸ™ˆ', en:'You lost ğŸ™ˆ' },
      'game.reveal'    : { ar:'Ø§ÙƒØªØ´Ù Ø§Ù„Ø­ÙƒÙ…Ø©', en:'Reveal Wisdom' },
      'game.solution'  : { ar:'Ø§Ù„Ø­Ù„ Ø§Ù„ÙƒØ§Ù…Ù„', en:'Full Solution' },
      'game.explanation':{ ar:'Ø´Ø±Ø­ Ø§Ù„Ù…Ø«Ù„', en:'Explanation' },
      'game.lesson'    : { ar:'Ù…Ø§ Ù†ØªØ¹Ù„Ù…Ù‡', en:'Key Lesson' },
      'game.source'    : { ar:'Ø§Ù„Ù…ØµØ¯Ø±', en:'Source' },
      'game.timeLabel' : { ar:'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ', en:'Time Left' },
      'game.letters'   : { ar:'Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ù…ØªØ§Ø­Ø©', en:'Available Letters' },
      'game.statusLabel': { ar:'Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©', en:'Game Status' },
      'game.settingsButton': { ar:'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©', en:'Game Settings' },
      'game.status.idle': { ar:'Ø¬Ø§Ù‡Ø²Ø©', en:'Ready' },
      'game.status.running': { ar:'Ù‚ÙŠØ¯ Ø§Ù„Ù„Ø¹Ø¨', en:'In Progress' },
      'game.status.won' : { ar:'Ø§Ù†ØªØµØ§Ø±', en:'Victory' },
      'game.status.lost': { ar:'Ø®Ø³Ø§Ø±Ø©', en:'Defeat' },
      'game.feedback.correct': { ar:'Ø£Ø­Ø³Ù†Øª! Ø­Ø±Ù ØµØ­ÙŠØ­ ÙŠÙ‚ØªØ±Ø¨ Ø¨Ùƒ Ù…Ù† Ø§Ù„Ø­ÙƒÙ…Ø©.', en:'Great job! A correct letter brings you closer to the wisdom.' },
      'game.feedback.wrong'  : { ar:'Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ù… ØªØµØ¨ Ø§Ù„Ù‡Ø¯ÙØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ø³Ø§Ø±Ù‹Ø§ Ø¢Ø®Ø±.', en:'That guess missed the markâ€”try another path.' },
      'game.feedback.win'    : { ar:'Ø¥Ø¨Ø¯Ø§Ø¹! Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø­ÙƒÙ…Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.', en:'Brilliant! The proverb has been unveiled.' },
      'game.feedback.lose'   : { ar:'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§ØªØŒ Ù„ÙƒÙ† Ø§Ù„Ø­ÙƒÙ…Ø© Ù…Ø§ Ø²Ø§Ù„Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø±Ùƒ.', en:'The tries are over, yet the wisdom still awaits you.' },
      'logic.title': { ar:'ØªØ­Ø¯ÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø¦ÙŠ', en:'Pattern Logic Trainer' },
      'logic.subtitle': { ar:'Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© ÙˆØµÙ‚Ù„ Ù…Ù‡Ø§Ø±Ø© Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù†Ù…Ø·.', en:'Explore clever sequences and sharpen your pattern recognition.' },
      'logic.start': { ar:'Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ', en:'Start Challenge' },
      'logic.newChallenge': { ar:'ØªØ­Ø¯Ù Ø¬Ø¯ÙŠØ¯', en:'New Challenge' },
      'logic.sequenceIntro': { ar:'Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©:', en:'Complete the following sequence:' },
      'logic.optionsPrompt': { ar:'Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©', en:'Pick the correct answer' },
      'logic.feedback.correct': { ar:'Ø¥Ø¬Ø§Ø¨Ø© Ù…ÙˆÙÙ‚Ø©! Ù…Ù†Ø·Ù‚Ùƒ Ø­Ø§Ø¶Ø±.', en:'Great choice! Your reasoning is sharp.' },
      'logic.feedback.wrong': { ar:'Ù„ÙŠØ³Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©ØŒ Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', en:'That is not the right answerâ€”try again.' },
      'logic.explanation': { ar:'Ø§Ù„Ø´Ø±Ø­', en:'Explanation' },
      'logic.sequence.step': { ar:'ØªØ²Ø¯Ø§Ø¯ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ù…Ù‚Ø¯Ø§Ø± {step} ÙÙŠ ÙƒÙ„ Ø®Ø·ÙˆØ©.', en:'Values increase by {step} each step.' },
      'logic.square.hint': { ar:'Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ ØªÙ…Ø«Ù„ Ù…Ø±Ø¨Ø¹Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ© ØªØ¨Ø¯Ø£ Ù…Ù† {start}Â².', en:'The terms are consecutive squares starting from {start}Â².' },
      'logic.double.hint': { ar:'ÙƒÙ„ Ù‚ÙŠÙ…Ø© ØªØ³Ø§ÙˆÙŠ Ø¶Ø¹Ù Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.', en:'Each value doubles the previous one.' },
      'game.lastMove'        : { ar:'Ø±Ø¯Ø© ÙØ¹Ù„ ÙÙˆØ±ÙŠØ©', en:'Instant Feedback' },
      'game.musicOn'         : { ar:'Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù…ÙØ¹Ù‘Ù„Ø©', en:'Music On' },
      'game.musicOff'        : { ar:'Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù…ØªÙˆÙ‚ÙØ©', en:'Music Off' },
      'game.timerOn'         : { ar:'Ø§Ù„Ù…Ø¤Ù‚Øª Ù†Ø´Ø·', en:'Timer Enabled' },
      'game.timerOff'        : { ar:'Ø§Ù„Ù…Ø¤Ù‚Øª Ù…ØªÙˆÙ‚Ù', en:'Timer Disabled' },
      'game.overlay.winTitle'    : { ar:'Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ ÙØ²Øª ğŸ‰', en:'Bravo! You Won ğŸ‰' },
      'game.overlay.winSubtitle' : { ar:'Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ ØªØ²Ø¯Ø§Ø¯ Ø¬Ù…Ø§Ù„Ø§Ù‹ Ù…Ø¹ ÙƒÙ„ Ø­ÙƒÙ…Ø© ØªØªØ¹Ù„Ù…Ù‡Ø§.', en:'Success shines brighter with every lesson you learn.' },
      'game.overlay.loseTitle'   : { ar:'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª', en:'Game Over' },
      'game.overlay.loseSubtitle': { ar:'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ù…ØªÙ‰ Ø´Ø¦Øª.', en:'You can always start over when you wish.' },
      'game.overlay.loseInsight' : { ar:'Ù„Ø§ ØªØ­Ø²Ù† Ù…Ù† Ø®Ø³Ø§Ø±ØªÙƒØŒ ÙÙ„Ø£Ù†Ùƒ ØªØ¹Ù„Ù…Øª Ø­ÙƒÙ…Ø© Ø¬Ø¯ÙŠØ¯Ø©.', en:'Do not be sad about losingâ€”you just gained new wisdom.' },
      'game.overlay.winInsight'  : { ar:'Ù…Ø¨Ø±ÙˆÙƒ Ù„Ù‚Ø¯ Ø£ØµØ¨Øª! Ø§Ù‚Ø±Ø£ Ø´Ø±Ø­ Ø§Ù„Ù…Ø«Ù„ ÙˆØªØ¹Ù„Ù… Ù†Ø¨Ø°Ø© Ø¹Ù†Ù‡.', en:'Congrats, you got it! Read the explanation and learn more about this proverb.' },
      'game.rewardTitle'     : { ar:'Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø­ÙƒÙ…Ø©', en:'Wisdom Reward' },
      'game.tryAgain'        : { ar:'Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§', en:'Try Again' },
      'game.playAgain'       : { ar:'Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', en:'Play Again' },
      'game.revealPrompt'    : { ar:'Ø§Ù†Ù‚Ø± Ù„Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø­ÙƒÙ…Ø© ÙƒØ§Ù…Ù„Ø© Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø©.', en:'Tap to reveal the full wisdom after the round ends.' }
    };

    /* ===================== Markdown: Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ ===================== */
    const readmeStore = M.readme || {};
    const DOCS = {
      base:{
        ar: (readmeStore.base && readmeStore.base.ar) || '',
        en: (readmeStore.base && readmeStore.base.en) || (readmeStore.base && readmeStore.base.ar) || ''
      },
      tec:{
        ar: (readmeStore.tec && readmeStore.tec.ar) || '',
        en: (readmeStore.tec && readmeStore.tec.en) || (readmeStore.tec && readmeStore.tec.ar) || ''
      }
    };

    /* ===================== Game Data: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ===================== */
    const PROVERBS = [
      {
        t:"Ø±Ø¬Ø¹ Ø¨Ø®ÙÙŠ Ø­Ù†ÙŠÙ†",
        hint:"ÙŠÙÙ‚Ø§Ù„ Ù„Ù…Ù† Ø¹Ø§Ø¯ Ø¨Ù„Ø§ Ù†ØªÙŠØ¬Ø©",
        explanation:"ØªØ­ÙƒÙŠ Ø§Ù„Ù‚ØµØ© Ø¹Ù† Ø±Ø¬Ù„ ÙØ´Ù„ ÙÙŠ Ù…ÙØ§ÙˆØ¶Ø© Ø¥Ø³ÙƒØ§ÙÙŠ ÙØ¹Ø§Ø¯ Ø®Ø§Ù„ÙŠ Ø§Ù„ÙˆÙØ§Ø¶ ÙˆÙ‚Ø¯ ÙÙ‚Ø¯ Ù†Ø¹Ù„ÙŠÙ‡ØŒ ÙØµØ§Ø± Ù…Ø«Ù„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø®ÙŠØ¨Ø© Ø¨Ø¹Ø¯ Ù…Ø´Ù‚Ø©.",
        lesson:"Ø§Ù„ØªØ®Ø·ÙŠØ· ÙˆØ§Ù„Ù…Ø±ÙˆÙ†Ø© ÙÙŠ Ø§Ù„ØªÙØ§ÙˆØ¶ ÙŠØ­Ù…ÙŠØ§Ù† Ù…Ù† Ø¶ÙŠØ§Ø¹ Ø§Ù„Ø¬Ù‡Ø¯ Ø¨Ù„Ø§ Ø«Ù…Ø±.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ù‚Ø¯ÙŠÙ…"
      },
      {
        t:"Ø§Ù„ÙŠ Ø§Ø®ØªØ´ÙˆØ§ Ù…Ø§ØªÙˆØ§",
        hint:"ÙŠÙÙ†ØªÙ‚Ø¯ ÙÙŠÙ‡ Ø°Ù‡Ø§Ø¨ Ø§Ù„Ø­ÙŠØ§Ø¡",
        explanation:"Ù†Ø´Ø£ ÙÙŠ Ù…ØµØ± Ø²Ù…Ù† Ø§Ù„Ø­Ø±ÙŠÙ‚ Ø­ÙŠÙ† ÙØ¶Ù„Øª Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ø³Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø­ÙŠØ§Ø¦Ù‡Ù† ÙÙ…ÙØªÙ†ØŒ ÙØµØ§Ø± ÙƒÙ†Ø§ÙŠØ© Ø¹Ù† ØªØ¨Ø¯Ù„ Ø§Ù„Ø£Ø­ÙˆØ§Ù„ ÙˆØºÙŠØ§Ø¨ Ø§Ù„Ø®Ø¬Ù„.",
        lesson:"Ø­ÙŠØ§Ø¡ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙŠÙ†Ø¹ÙƒØ³ Ø¹Ù„Ù‰ Ø³Ù„ÙˆÙƒÙ‡ ÙˆØ§Ø³ØªÙ‚Ø±Ø§Ø±Ù‡.",
        source:"Ù…Ø«Ù„ Ù…ØµØ±ÙŠ Ø´Ø¹Ø¨ÙŠ"
      },
      {
        t:"Ø§Ù‚Ù„Ø¨ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ ÙÙ…Ù‡Ø§ ØªØ·Ù„Ø¹ Ø§Ù„Ø¨Ù†Øª Ù„Ø§Ù…Ù‡Ø§",
        hint:"ÙŠØ´ÙŠØ± Ù„Ù„Ø´Ø¨Ù‡ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬ÙŠØ§Ù„",
        explanation:"ÙŠØ¹Ø¨Ø± Ø§Ù„Ù…Ø«Ù„ Ø¹Ù† Ø£Ù† Ø§Ù„ÙØªØ§Ø© ØºØ§Ù„Ø¨Ù‹Ø§ Ù…Ø§ ØªØ´Ø¨Ù‡ Ø£Ù…Ù‡Ø§ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹ ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ Ù…Ù‡Ù…Ø§ Ø­Ø§ÙˆÙ„Øª Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù.",
        lesson:"Ø§Ù„Ù‚Ø¯ÙˆØ© Ø§Ù„Ø£Ø³Ø±ÙŠØ© ØªØªØ±Ùƒ Ø¨ØµÙ…ØªÙ‡Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡.",
        source:"ØªØ±Ø§Ø« Ø´Ø¹Ø¨ÙŠ Ù…ØµØ±ÙŠ"
      },
      {
        t:"Ø§Ø¨Ù†Ùƒ Ø¹Ù„Ù‰ Ù…Ø§ ØªØ±Ø¨ÙŠÙ‡ Ùˆ Ø¬ÙˆØ²Ùƒ Ø¹Ù„Ù‰ Ù…Ø§ ØªØ¹ÙˆØ¯ÙŠÙ‡",
        hint:"ÙÙŠÙ‡ Ø­Ø¯ÙŠØ« Ø¹Ù† Ø£Ø«Ø± Ø§Ù„ØªØ±Ø¨ÙŠØ©",
        explanation:"ÙŠÙˆØ¶Ø­ Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø°ÙŠ Ù†Ø²Ø±Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„Ø£Ø²ÙˆØ§Ø¬ ÙŠÙ†Ø¹ÙƒØ³ Ø¹Ù„ÙŠÙ†Ø§ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬.",
        lesson:"Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙˆØ§Ø¹ÙŠØ© ÙˆØ§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ø·ÙŠØ¨Ø© ØªØµÙ†Ø¹ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø±Ø©.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ù…ØªØ¯Ø§ÙˆÙ„"
      },
      {
        t:"Ù…Ø§ Ø­Ùƒ Ø¬Ù„Ø¯Ùƒ Ù…Ø«Ù„ Ø¸ÙØ±Ùƒ",
        hint:"Ø¯Ø¹ÙˆØ© Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø°Ø§Øª",
        explanation:"ÙŠØ´Ø¬Ø¹ Ø§Ù„Ù…Ø«Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†ÙØ³Ùƒ Ù„Ø£Ù†Ùƒ Ø§Ù„Ø£Ø­Ø±Øµ Ø¹Ù„Ù‰ Ù…ØµÙ„Ø­ØªÙƒ ÙˆØ§Ù„Ø£Ù‚Ø¯Ø± Ø¹Ù„Ù‰ Ø¥Ø¯Ø±Ø§Ùƒ Ø­Ø§Ø¬ØªÙƒ.",
        lesson:"Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© ØªÙØ®ØªØµØ± Ø¨Ù‡Ø§ Ø§Ù„Ø·Ø±Ù‚ ÙˆØªØªØ­Ù‚Ù‚ Ø§Ù„Ù†Ø¬Ø§Ø­Ø§Øª.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ ÙØµÙŠØ­"
      },
      {
        t:"Ø®ÙŠØ± Ø§Ù„ÙƒÙ„Ø§Ù… Ù…Ø§ Ù‚Ù„ ÙˆØ¯Ù„",
        hint:"ÙŠØªØ¹Ù„Ù‚ Ø¨ÙØµØ§Ø­Ø© Ø§Ù„ØªØ¹Ø¨ÙŠØ±",
        explanation:"ÙŠØ­ÙØ« Ø§Ù„Ù…Ø«Ù„ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙ„Ù…Ø§Øª Ù‚Ù„ÙŠÙ„Ø© Ù„ÙƒÙ†Ù‡Ø§ Ù…Ø¹Ø¨Ø±Ø© ÙˆÙˆØ§Ø¶Ø­Ø© Ø¨Ø¯Ù„ Ø§Ù„Ø¥Ø·Ø§Ù„Ø© Ø§Ù„Ù…Ù…Ù„Ø©.",
        lesson:"Ø§Ù„Ø¥ÙŠØ¬Ø§Ø² Ø§Ù„ÙˆØ§Ø¶Ø­ ÙŠØ¨Ù†ÙŠ ØªÙˆØ§ØµÙ„Ù‹Ø§ Ø£Ù‚ÙˆÙ‰ ÙˆØ£ÙƒØ«Ø± ØªØ£Ø«ÙŠØ±Ù‹Ø§.",
        source:"Ø­ÙƒÙ…Ø© Ø¹Ø±Ø¨ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø©"
      },
      {
        t:"Ø§Ù„Ø®Ø¨Ø± Ø§Ù„ÙŠ Ø§Ù†Ù‡Ø±Ø¯Ù‡ Ø¨ÙÙ„ÙˆØ³ Ø¨ÙƒØ±Ø© ÙŠØ¨Ù‚Ù‰ Ø¨Ø¨Ù„Ø§Ø´",
        hint:"ÙŠØªÙ†Ø§ÙˆÙ„ Ø³Ø±Ø¹Ø© Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±",
        explanation:"ÙŠÙÙ‚Ø§Ù„ Ø¹Ù† Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªÙŠ Ø³Ø±Ø¹Ø§Ù† Ù…Ø§ ÙŠØ¹Ø±ÙÙ‡Ø§ Ø§Ù„Ø¬Ù…ÙŠØ¹ØŒ ÙÙ„Ø§ Ø¬Ø¯ÙˆÙ‰ Ù…Ù† Ø´Ø±Ø§Ø¡ Ù…Ø§ Ø³ÙŠØ´ÙŠØ¹ Ø¨Ù„Ø§ Ø«Ù…Ù†.",
        lesson:"Ø§Ù„Ø­Ø°Ø± Ù…Ù† Ø§Ù„ØªØ³Ø±ÙŠØ¨ ÙˆØªÙ‚Ø¯ÙŠØ± Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© ÙÙŠ ÙˆÙ‚ØªÙ‡Ø§.",
        source:"Ù…Ø«Ù„ Ø´Ø¹Ø¨ÙŠ Ù…ØµØ±ÙŠ"
      },
      {
        t:"Ù…Ù† Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ø§ Ø³Ù‡Ø± Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ",
        hint:"ÙŠØªØ­Ø¯Ø« Ø¹Ù† Ø§Ù„Ø§Ø¬ØªÙ‡Ø§Ø¯",
        explanation:"ÙŠØ¯Ø¹Ùˆ Ø§Ù„Ù…Ø«Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø«Ø§Ø¨Ø±Ø© ÙˆØ¨Ø°Ù„ Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ø·ÙˆÙŠÙ„ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø³Ø§Ù…ÙŠØ©.",
        lesson:"Ø§Ù„Ø·Ù…ÙˆØ­ ÙŠØªØ­Ù‚Ù‚ Ø¨Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„ØµØ¨Ø± Ù„Ø§ Ø¨Ø§Ù„ØªÙ…Ù†ÙŠ.",
        source:"Ø­ÙƒÙ…Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©"
      },
      {
        t:"Ø§Ù„ÙŠ Ø¨ÙŠØ´ÙŠÙ„ Ù‚Ø±Ø¨Ø© Ù…Ø®Ø±ÙˆÙ…Ø© Ø¨ØªØ®Ø± Ø¹Ù„Ù‰ Ø±Ø§Ø³Ù‡",
        hint:"ØªØ­Ø°ÙŠØ± Ù…Ù† Ø§Ù„Ø¥Ù‡Ù…Ø§Ù„",
        explanation:"ÙŠØ¶Ø±Ø¨ Ù„Ù…Ù† ÙŠØªÙ‡Ø§ÙˆÙ† ÙÙŠ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ù„Ù„ ÙÙŠØ¹ÙˆØ¯ Ø¹Ù„ÙŠÙ‡ Ø¨Ø§Ù„Ø®Ø³Ø§Ø±Ø© ÙˆØ§Ù„Ù…Ø´Ù‚Ø©.",
        lesson:"Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµØºÙŠØ±Ø© Ù…Ø¨ÙƒØ±Ù‹Ø§ ÙŠÙ…Ù†Ø¹ ÙƒÙˆØ§Ø±Ø« Ø£ÙƒØ¨Ø± Ù„Ø§Ø­Ù‚Ù‹Ø§.",
        source:"Ù…Ø«Ù„ Ø´Ø¹Ø¨ÙŠ Ø´Ø§Ù…Ù„ÙŠ"
      },
      {
        t:"Ø§Ø¯ÙŠ Ø§Ù„Ø¹ÙŠØ´ Ù„Ø®Ø¨Ø§Ø²Ù‡ ÙˆÙ„Ùˆ ÙƒÙ„ Ù†ØµÙ‡",
        hint:"ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ØªØ®ØµØµ",
        explanation:"ÙŠÙˆØµÙŠ Ø§Ù„Ù…Ø«Ù„ Ø¨Ø¥Ø³Ù†Ø§Ø¯ Ø§Ù„Ø£Ù…ÙˆØ± Ù„Ø£Ù‡Ù„ Ø§Ù„Ø®Ø¨Ø±Ø© Ø­ØªÙ‰ Ù„Ùˆ ÙƒÙ„Ù Ø§Ù„Ø£Ù…Ø±Ø› ÙØ§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªÙƒÙˆÙ† Ø£Ø¶Ù…Ù† ÙˆØ£Ø¬ÙˆØ¯.",
        lesson:"Ø§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù…ØªØ®ØµØµÙŠÙ† ØªØ¶Ù…Ù† Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ÙˆØªØ®ØªØµØ± Ø§Ù„ÙˆÙ‚Øª.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ø¯Ø§Ø±Ø¬"
      },
      {
        t:"Ù„Ø§ ØªØ¤Ø¬Ù„ Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ… Ø¥Ù„Ù‰ Ø§Ù„ØºØ¯",
        hint:"Ù…Ø­Ø§Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙŠÙ",
        explanation:"ÙŠÙ†Ø¨Ù‡ Ø§Ù„Ù…Ø«Ù„ Ø¥Ù„Ù‰ Ø®Ø·ÙˆØ±Ø© ØªØ£Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ù„Ø£Ù† ØªØ±Ø§ÙƒÙ…Ù‡Ø§ ÙŠØ³Ø¨Ø¨ Ø¶ÙŠØ§Ø¹ Ø§Ù„ÙØ±Øµ ÙˆØ§Ù„Ø§Ø¶Ø·Ø±Ø§Ø¨.",
        lesson:"Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙÙˆØ±ÙŠ ÙŠÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆÙŠÙ‚Ù„Ù„ Ø§Ù„ØªÙˆØªØ±.",
        source:"Ø­ÙƒÙ…Ø© Ø¥Ø¯Ø§Ø±ÙŠØ© Ø¹Ø§Ù„Ù…ÙŠØ©"
      },
      {
        t:"Ø§Ù„ÙˆÙ‚Øª ÙƒØ§Ù„Ø³ÙŠÙ Ø§Ù† Ù„Ù… ØªÙ‚Ø·Ø¹Ù‡ Ù‚Ø·Ø¹Ùƒ",
        hint:"ÙŠØ¤ÙƒØ¯ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø²Ù…Ù†",
        explanation:"ÙŠØ´Ø¨Ù‡ Ø§Ù„Ù…Ø«Ù„ Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø³ÙŠÙ Ø§Ù„Ø­Ø§Ø¯ Ø§Ù„Ø°ÙŠ Ø¥Ù† Ù„Ù… Ù†Ø­Ø³Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ø³ÙŠÙˆÙ‚Ø¹ Ø¨Ù†Ø§ Ø§Ù„Ø®Ø³Ø§Ø±Ø©.",
        lesson:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª Ù…Ø­ÙˆØ± Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ØªÙÙˆÙ‚ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø©.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ù…Ø£Ø«ÙˆØ±"
      },
      {
        t:"Ø§Ù„ØµØ¨Ø± Ù…ÙØªØ§Ø­ Ø§Ù„ÙØ±Ø¬",
        hint:"ÙŠØ¯Ø¹Ùˆ Ù„Ù„ØªØ±ÙŠØ«",
        explanation:"ÙŠØ¹Ù„Ù…Ù†Ø§ Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ø¶ÙŠÙ‚ Ø§Ù„Ù„Ø­Ø¸Ø© Ù„Ø§ ÙŠØ¯ÙˆÙ… ÙˆØ£Ù† Ø§Ù„ØµØ¨Ø± ÙŠÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© ÙˆØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©.",
        lesson:"Ø§Ù„Ù‡Ø¯ÙˆØ¡ ÙˆØ§Ù„Ø«Ø¨Ø§Øª ÙŠÙ…Ù†Ø­Ø§Ù†Ù†Ø§ Ø±Ø¤ÙŠØ© Ø£ÙˆØ¶Ø­ Ù„Ù„ÙØ±Øµ Ø§Ù„Ù…Ø®ØªØ¨Ø¦Ø©.",
        source:"Ø­ÙƒÙ…Ø© Ø¹Ø±Ø¨ÙŠØ© Ø±ÙˆØ­Ø§Ù†ÙŠØ©"
      },
      {
        t:"Ù…Ù† Ø¬Ø¯ ÙˆØ¬Ø¯ ÙˆÙ…Ù† Ø²Ø±Ø¹ Ø­ØµØ¯",
        hint:"ÙŠØ±ØªØ¨Ø· Ø¨Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯",
        explanation:"ÙŠØ¬Ù…Ø¹ Ø§Ù„Ù…Ø«Ù„ Ø¨ÙŠÙ† Ø¨Ø°Ù„ Ø§Ù„Ø¬Ù‡Ø¯ ÙˆÙ‚Ø·Ù Ø§Ù„Ø«Ù…Ø§Ø± ÙƒØ¹Ù„Ø§Ù‚Ø© Ø³Ø¨Ø¨ÙŠØ© Ù„Ø§ Ù…ÙØ± Ù…Ù†Ù‡Ø§.",
        lesson:"Ø§Ù„Ø§Ø¬ØªÙ‡Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙŠØ«Ù…Ø± Ù…Ù‡Ù…Ø§ Ø·Ø§Ù„ Ø§Ù„Ø²Ù…Ù†.",
        source:"Ù‚ÙˆÙ„ Ù…Ø£Ø«ÙˆØ± ÙÙŠ Ø§Ù„ØªØ±Ø¨ÙŠØ©"
      },
      {
        t:"ÙÙŠ Ø§Ù„ØªØ£Ù†ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆÙÙŠ Ø§Ù„Ø¹Ø¬Ù„Ø© Ø§Ù„Ù†Ø¯Ø§Ù…Ø©",
        hint:"ÙŠØ­Ø°Ø± Ù…Ù† Ø§Ù„ØªØ³Ø±Ø¹",
        explanation:"ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ø§Ù„ØªØ£Ù†ÙŠ ÙŠÙ…Ù†Ø­ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„Ø¹Ø¬Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© ØªØ¬Ø± Ø§Ù„Ù†Ø¯Ù….",
        lesson:"Ø§Ù„ØªØ±ÙˆÙ‘ÙŠ Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…ØµÙŠØ±ÙŠØ© ÙŠØ¬Ù†Ù‘Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ù…Ø´ØªØ±Ùƒ"
      },
      {
        t:"Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ø¹Ù‚Ù„ Ù†Ù‚Øµ Ø§Ù„ÙƒÙ„Ø§Ù…",
        hint:"ÙŠÙ…Ø¬Ø¯ Ø§Ù„ØµÙ…Øª Ø§Ù„Ø­ÙƒÙŠÙ…",
        explanation:"ÙŠØ±Ù‰ Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø­ÙƒÙ…Ø© ÙŠØ¬Ø¹Ù„ ØµØ§Ø­Ø¨Ù‡Ø§ Ù‚Ù„ÙŠÙ„ Ø§Ù„ÙƒÙ„Ø§Ù… Ù„Ø£Ù†Ù‡ ÙŠØ²Ù† Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª.",
        lesson:"Ø§Ù„ÙˆØ¹ÙŠ Ø¨Ø°Ø§ØªÙƒ ÙŠØ¬Ø¹Ù„Ùƒ ØªØ®ØªØ§Ø± ÙƒÙ„Ù…Ø§ØªÙƒ Ø¨Ø¹Ù†Ø§ÙŠØ©.",
        source:"Ø­ÙƒÙ…Ø© Ù…Ù†Ø³ÙˆØ¨Ø© Ù„Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ"
      },
      {
        t:"Ø¥Ø°Ø§ Ø¹Ø±Ù Ø§Ù„Ø³Ø¨Ø¨ Ø¨Ø·Ù„ Ø§Ù„Ø¹Ø¬Ø¨",
        hint:"Ø¹Ù† ÙÙ‡Ù… Ø§Ù„Ø®Ù„ÙÙŠØ§Øª",
        explanation:"ÙŠØ¤ÙƒØ¯ Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ ØªØ²ÙŠÙ„ Ø§Ù„ØºØ±Ø§Ø¨Ø© ÙˆØªÙƒØ´Ù Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«.",
        lesson:"Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ‚ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« ÙŠÙ…Ù†Ø­Ù†Ø§ Ø­Ù„Ø§Ù‹ Ø£Ø¯Ù‚ ÙˆÙ‚Ø±Ø§Ø±Ù‹Ø§ Ø£ØµÙˆØ¨.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ù‚Ø¯ÙŠÙ…"
      },
      {
        t:"Ø¯Ø±Ù‡Ù… ÙˆÙ‚Ø§ÙŠØ© Ø®ÙŠØ± Ù…Ù† Ù‚Ù†Ø·Ø§Ø± Ø¹Ù„Ø§Ø¬",
        hint:"ÙŠØ´Ø¬Ø¹ Ø§Ù„ÙˆÙ‚Ø§ÙŠØ©",
        explanation:"ÙŠØ¯Ø¹Ùˆ Ø§Ù„Ù…Ø«Ù„ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± ÙÙŠ Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø®Ø·Ø± Ù‚Ø¨Ù„ ÙˆÙ‚ÙˆØ¹Ù‡ Ù„Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ø¬ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…ÙƒÙ„Ù ÙˆÙ…ÙØ±Ù‡Ù‚.",
        lesson:"Ø§Ù„Ø§Ø³ØªØ¨Ø§Ù‚ ÙˆØ§Ù„ØªØ®Ø·ÙŠØ· ÙŠÙ‚Ù„Ù„Ø§Ù† Ø§Ù„Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù…Ø§Ø¯ÙŠØ© ÙˆØ§Ù„Ù…Ø¹Ù†ÙˆÙŠØ©.",
        source:"Ø­ÙƒÙ…Ø© Ø·Ø¨ÙŠØ© Ø´Ø§Ø¦Ø¹Ø©"
      },
      {
        t:"Ù„Ø§ ÙŠÙ…ÙˆØª Ø§Ù„Ø°Ø¦Ø¨ ÙˆÙ„Ø§ ØªÙÙ†Ù‰ Ø§Ù„ØºÙ†Ù…",
        hint:"ÙŠØ±ØµØ¯ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ Ø¨ÙŠÙ† Ù…ØµÙ„Ø­ØªÙŠÙ†",
        explanation:"ÙŠØ¶Ø±Ø¨ Ù„Ù…Ù† ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ø¬Ù…Ø¹ Ø¨ÙŠÙ† Ù…ØªØ¶Ø§Ø¯ÙŠÙ† Ø¯ÙˆÙ† ØªØ¶Ø­ÙŠØ©ØŒ ÙˆÙ‡Ùˆ Ø£Ù…Ø± Ù…Ø³ØªØ­ÙŠÙ„ ØºØ§Ù„Ø¨Ù‹Ø§.",
        lesson:"Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø§Ø¯Ø© ØªØ³ØªÙ„Ø²Ù… Ø§Ø®ØªÙŠØ§Ø±Ù‹Ø§ ÙˆØ§Ø¶Ø­Ù‹Ø§ ÙˆØªØ¶Ø­ÙŠØ© Ù…Ø­Ø³ÙˆØ¨Ø©.",
        source:"Ù…Ø«Ù„ Ø¨Ø¯ÙˆÙŠ"
      },
      {
        t:"Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒÙ„Ø§Ù… Ù…Ù† ÙØ¶Ø© ÙØ§Ù„Ø³ÙƒÙˆØª Ù…Ù† Ø°Ù‡Ø¨",
        hint:"ÙŠÙØ§Ø¶Ù„ Ø¨ÙŠÙ† Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆØ§Ù„ØµÙ…Øª",
        explanation:"ÙŠØ´Ø¯Ø¯ Ø§Ù„Ù…Ø«Ù„ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„ØµÙ…Øª ÙÙŠ Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø­ÙƒÙ…Ø© Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø²Ø§Ø¦Ø¯.",
        lesson:"Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„ÙƒÙ„Ø§Ù… Ù…Ù‡Ø§Ø±Ø© Ù‚ÙŠØ§Ø¯ÙŠØ© Ù…Ù‡Ù…Ø©.",
        source:"Ù‚ÙˆÙ„ Ù…Ø£Ø«ÙˆØ± Ø¹Ø±Ø¨ÙŠ"
      },
      {
        t:"Ø±Ø¨ Ø¶Ø§Ø±Ø© Ù†Ø§ÙØ¹Ø©",
        hint:"ÙŠØ±Ù‰ Ø§Ù„Ø®ÙŠØ± ÙÙŠ Ø§Ù„Ø§Ø¨ØªÙ„Ø§Ø¡",
        explanation:"ÙŠÙˆØ¶Ø­ Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ø§Ù„Ù…ØµØ§Ø¦Ø¨ Ù‚Ø¯ ØªØ­Ù…Ù„ ÙÙŠ Ø·ÙŠØ§ØªÙ‡Ø§ ÙØ±ØµÙ‹Ø§ ÙˆØ£Ù„Ø·Ø§ÙÙ‹Ø§ Ù„Ø§ Ù†Ø±Ø§Ù‡Ø§ Ù„Ù„ÙˆÙ‡Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰.",
        lesson:"ØªØºÙŠÙŠØ± Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù†Ø¸Ø± ÙŠØ­ÙˆÙ‘Ù„ Ø§Ù„Ù…Ø­Ù† Ø¥Ù„Ù‰ Ù…Ù†Ø­ ÙˆØ¹Ø¨Ø±.",
        source:"Ø­ÙƒÙ…Ø© Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø´Ø§Ø¦Ø¹Ø©"
      },
      {
        t:"Ø§Ù„Ø¹Ù„Ù… Ù†ÙˆØ±",
        hint:"ÙŠÙØ´ÙŠØ¯ Ø¨Ø§Ù„Ù…Ø¹Ø±ÙØ©",
        explanation:"ÙŠØ´Ø¨Ù‡ Ø§Ù„Ù…Ø«Ù„ Ø§Ù„Ø¹Ù„Ù… Ø¨Ø§Ù„Ù†ÙˆØ± Ø§Ù„Ø°ÙŠ ÙŠØ¨Ø¯Ø¯ Ø§Ù„Ø¸Ù„Ø§Ù… ÙˆÙŠÙ‡Ø¯ÙŠ Ø§Ù„Ø¹Ù‚ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙˆØ§Ø¨.",
        lesson:"Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙŠÙØªØ­ Ø§Ù„Ø¢ÙØ§Ù‚ ÙˆÙŠØµÙˆÙ† Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ù…Ù† Ø§Ù„Ø¬Ù‡Ù„.",
        source:"Ù‚ÙˆÙ„ ØªØ±Ø¨ÙˆÙŠ Ù…Ø£Ø«ÙˆØ±"
      },
      {
        t:"Ù„ÙŠØ³ Ø§Ù„ÙØªÙ‰ Ù…Ù† Ù‚Ø§Ù„ ÙƒØ§Ù† Ø£Ø¨ÙŠ",
        hint:"ÙŠØ­Ø« Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø´Ø®ØµÙŠ",
        explanation:"ÙŠØ±ÙØ¶ Ø§Ù„Ù…Ø«Ù„ Ø§Ù„Ø§ØªÙƒØ§Ø¡ Ø¹Ù„Ù‰ Ø£Ù…Ø¬Ø§Ø¯ Ø§Ù„Ø¢Ø¨Ø§Ø¡ ÙˆÙŠØ¯Ø¹Ùˆ Ù„ØµÙ†Ø§Ø¹Ø© Ù…Ø¬Ø¯ Ø°Ø§ØªÙŠ.",
        lesson:"Ù‡ÙˆÙŠØ© Ø§Ù„Ø¥Ù†Ø³Ø§Ù† ØªØ¨Ù†Ù‰ Ø¨Ø¬Ù‡Ø¯Ù‡ Ù„Ø§ Ø¨Ù†Ø³Ø¨Ù‡ ÙØ­Ø³Ø¨.",
        source:"Ø¨ÙŠØª Ù…Ù† Ø´Ø¹Ø± Ø§Ù„Ù…ØªÙ†Ø¨ÙŠ"
      },
      {
        t:"Ù…Ù† Ø´Ø¨ Ø¹Ù„Ù‰ Ø´ÙŠØ¡ Ø´Ø§Ø¨ Ø¹Ù„ÙŠÙ‡",
        hint:"ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø¹Ø§Ø¯Ø§Øª",
        explanation:"ÙŠØ¤ÙƒØ¯ Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ù…Ø§ ÙŠÙ†Ø´Ø£ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¥Ù†Ø³Ø§Ù† ÙÙŠ ØµØºØ±Ù‡ ÙŠØ³ØªÙ…Ø± ØºØ§Ù„Ø¨Ù‹Ø§ Ù…Ø¹Ù‡ Ø­ØªÙ‰ Ø§Ù„ÙƒØ¨Ø±.",
        lesson:"ØªØ´ÙƒÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ù…Ø¨ÙƒØ±Ù‹Ø§ Ø§Ø³ØªØ«Ù…Ø§Ø± Ø·ÙˆÙŠÙ„ Ø§Ù„Ø£Ù…Ø¯.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ø¯Ø§Ø±Ø¬"
      },
      {
        t:"Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† ÙŠÙƒØ±Ù… Ø§Ù„Ù…Ø±Ø¡ Ø£Ùˆ ÙŠÙ‡Ø§Ù†",
        hint:"Ø¹Ù† Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø³Ù…",
        explanation:"ÙŠØ´ÙŠØ± Ø§Ù„Ù…Ø«Ù„ Ø¥Ù„Ù‰ Ø£Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙƒØ´Ù Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ù„Ø¬Ø¯ÙŠØ©.",
        lesson:"Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙŠØ¬Ø¹Ù„ Ø§Ù„Ù…ÙˆØ§Ù‚Ù Ø§Ù„Ø­Ø§Ø³Ù…Ø© ÙØ±ØµØ© Ù„Ù„ØªØ£Ù„Ù‚.",
        source:"Ø­ÙƒÙ…Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©"
      },
      {
        t:"Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø£Ù† ØªØ·Ø§Ø¹ ÙØ£Ù…Ø± Ø¨Ù…Ø§ ÙŠØ³ØªØ·Ø§Ø¹",
        hint:"ÙŠÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ø·Ù…ÙˆØ­ ÙˆØ§Ù„Ù‚Ø¯Ø±Ø©",
        explanation:"ÙŠØ¹Ù„Ù… Ø§Ù„Ù…Ø«Ù„ Ø§Ù„Ù‚Ø§Ø¯Ø© Ø£Ù† Ø§Ù„ØªÙƒÙ„ÙŠÙ Ø¨Ù…Ø§ ÙÙˆÙ‚ Ø§Ù„Ø·Ø§Ù‚Ø© ÙŠÙˆÙ„Ø¯ Ø§Ù„Ø¹ØµÙŠØ§Ù†ØŒ Ø£Ù…Ø§ Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠØ© ÙØªØ¬Ù„Ø¨ Ø§Ù„Ø·Ø§Ø¹Ø©.",
        lesson:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ÙƒÙŠÙ…Ø© ØªØ±Ø§Ø¹ÙŠ Ø·Ø§Ù‚Ø© Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ­Ø¯ÙˆØ¯ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯.",
        source:"Ù‚ÙˆÙ„ Ù…Ù†Ø³ÙˆØ¨ Ù„Ø¹Ù…Ø± Ø¨Ù† Ø§Ù„Ø®Ø·Ø§Ø¨"
      },
      {
        t:"Ø¹Ù„Ù‰ Ù‚Ø¯Ø± Ø£Ù‡Ù„ Ø§Ù„Ø¹Ø²Ù… ØªØ£ØªÙŠ Ø§Ù„Ø¹Ø²Ø§Ø¦Ù…",
        hint:"Ø¹Ù† Ù‚ÙˆØ© Ø§Ù„Ø¥Ø±Ø§Ø¯Ø©",
        explanation:"ÙŠØ´ÙŠØ± Ø§Ù„Ø¨ÙŠØª Ø¥Ù„Ù‰ Ø£Ù† Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ù„Ø§ ÙŠÙ†Ù‡Ø¶ Ø¨Ù‡Ø§ Ø¥Ù„Ø§ Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ù‡Ù…Ù… Ø§Ù„Ø¹Ø§Ù„ÙŠØ©.",
        lesson:"Ø·Ù…ÙˆØ­Ùƒ ÙŠØ­Ø¯Ø¯ Ø­Ø¬Ù… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ­Ù‚Ù‚Ù‡.",
        source:"Ù…Ù† Ù‚ØµÙŠØ¯Ø© Ø§Ù„Ù…ØªÙ†Ø¨ÙŠ"
      },
      {
        t:"Ø§Ù„Ø·ÙŠÙˆØ± Ø¹Ù„Ù‰ Ø£Ø´ÙƒØ§Ù„Ù‡Ø§ ØªÙ‚Ø¹",
        hint:"ÙŠØªÙ†Ø§ÙˆÙ„ ØµØ­Ø¨Ø© Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡ÙŠÙ†",
        explanation:"ÙŠÙ‚ÙˆÙ„ Ø§Ù„Ù…Ø«Ù„ Ø¥Ù† Ø§Ù„Ø£ÙØ±Ø§Ø¯ ÙŠÙ…ÙŠÙ„ÙˆÙ† Ø¥Ù„Ù‰ Ù…Ù† ÙŠØ´Ø¨Ù‡ÙˆÙ†Ù‡Ù… ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹ ÙˆØ§Ù„Ù‚ÙŠÙ….",
        lesson:"Ø§Ø®ØªØ± Ù…Ø­ÙŠØ·Ùƒ Ø¨Ø¹Ù†Ø§ÙŠØ© Ù„Ø£Ù†Ù‡ ÙŠØ¹ÙƒØ³Ùƒ ÙˆÙŠØ¤Ø«Ø± Ø¹Ù„ÙŠÙƒ.",
        source:"Ù…Ø«Ù„ Ø¹Ø§Ù„Ù…ÙŠ Ù…ØªØ±Ø¬Ù…"
      },
      {
        t:"Ù…Ù† Ø³Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¨ ÙˆØµÙ„",
        hint:"ÙŠØªØ­Ø¯Ø« Ø¹Ù† Ø§Ù„Ù…Ø«Ø§Ø¨Ø±Ø©",
        explanation:"ÙŠØ¬Ø³Ø¯ Ø§Ù„Ù…Ø«Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø±ØºÙ… Ø·ÙˆÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø­ØªÙ‰ Ù†Ø¨Ù„Øº Ø§Ù„Ù‡Ø¯Ù.",
        lesson:"Ø§Ù„Ù…ÙˆØ§Ø¸Ø¨Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø© ØªØµÙ†Ø¹ Ø¥Ù†Ø¬Ø§Ø²Ù‹Ø§ Ø¹Ø¸ÙŠÙ…Ù‹Ø§ Ù…Ø¹ Ø§Ù„Ø²Ù…Ù†.",
        source:"Ø­ÙƒÙ…Ø© ØªØ·ÙˆÙŠØ± Ø°Ø§Øª"
      },
      {
        t:"Ø±Ø­Ù… Ø§Ù„Ù„Ù‡ Ø§Ù…Ø±Ø¡ Ø¹Ø±Ù Ù‚Ø¯Ø± Ù†ÙØ³Ù‡",
        hint:"Ø­ÙˆÙ„ ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø°Ø§Øª",
        explanation:"ÙŠØ´Ø¬Ø¹ Ø§Ù„Ù…Ø«Ù„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ù„Ø·Ø§Ù‚ØªÙ‡ ÙˆØ­Ø¯ÙˆØ¯Ù‡ Ø­ØªÙ‰ Ù„Ø§ ÙŠØ¸Ù„Ù… Ù†ÙØ³Ù‡ ÙˆÙ„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ù‚Ø¯Ø±ØªÙ‡.",
        lesson:"Ø§Ù„ÙˆØ¹ÙŠ Ø¨Ø§Ù„Ø°Ø§Øª ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨Ùƒ Ù…Ù† ÙØ±Øµ ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª.",
        source:"Ù‚ÙˆÙ„ Ù…Ø£Ø«ÙˆØ± Ø¹Ù† Ø¹Ù…Ø± Ø¨Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ²"
      },
      {
        t:"Ø§Ù„Ù‚Ù†Ø§Ø¹Ø© ÙƒÙ†Ø² Ù„Ø§ ÙŠÙÙ†Ù‰",
        hint:"ÙŠØ¯Ø¹Ùˆ Ù„Ù„Ø±Ø¶Ø§",
        explanation:"ÙŠØ¨ÙŠÙ† Ø§Ù„Ù…Ø«Ù„ Ø£Ù† Ø§Ù„Ù‚Ù†Ø§Ø¹Ø© Ø«Ø±ÙˆØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ø§ ØªÙ†ØªÙ‡ÙŠØŒ Ù„Ø£Ù†Ù‡Ø§ ØªÙ…Ù†Ø­ ØµØ§Ø­Ø¨Ù‡Ø§ Ø±Ø§Ø­Ø© Ù†ÙØ³ÙŠØ© Ù…Ø³ØªØ¯Ø§Ù…Ø©.",
        lesson:"ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ù†Ø¹Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø³ÙƒÙŠÙ†Ø© ÙˆÙŠØ­ÙØ² Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªÙˆØ§Ø²Ù†.",
        source:"Ù…Ø«Ù„ Ø¹Ø±Ø¨ÙŠ Ù…ØªØ¯Ø§ÙˆÙ„"
      },
      {
        t:"Ø¥Ù† Ù…Ø¹ Ø§Ù„Ø¹Ø³Ø± ÙŠØ³Ø±Ø§",
        hint:"Ù…Ø³ØªÙ…Ø¯ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†",
        explanation:"ÙŠØ±Ø³Ø® Ø§Ù„Ù…Ø«Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠ Ø­Ù‚ÙŠÙ‚Ø© Ø£Ù† Ø§Ù„Ø¶ÙŠÙ‚ ÙŠØªØ¨Ø¹Ù‡ ÙØ±Ø¬ Ù…Ø²Ø¯ÙˆØ¬ Ù„Ù…Ù† ÙŠØµØ¨Ø± ÙˆÙŠØ£Ù…Ù„.",
        lesson:"Ø§Ù„Ø£Ù…Ù„ ÙˆØ§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù„Ù‡ ÙŠØ«Ø¨ØªØ§Ù† Ø§Ù„Ù‚Ù„Ø¨ ÙÙŠ Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØµØ§Ø¹Ø¨.",
        source:"Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€” Ø³ÙˆØ±Ø© Ø§Ù„Ø´Ø±Ø­"
      }
    ];
	
    const AR_ALPHA = ['Ø§','Ø¨','Øª','Ø«','Ø¬','Ø­','Ø®','Ø¯','Ø°','Ø±','Ø²','Ø³','Ø´','Øµ','Ø¶','Ø·','Ø¸','Ø¹','Øº','Ù','Ù‚','Ùƒ','Ù„','Ù…','Ù†','Ùˆ','Ù‡','Ø©','Ø¡','ÙŠ','Ù‰'];
    const norm = (ch)=> String(ch).replace(/[Ø£Ø¥Ø¢]/g,'Ø§');

    const SOUND_EFFECTS = {
      correct: 'https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3',
      wrong: 'https://assets.mixkit.co/sfx/preview/mixkit-failure-arcade-alert-notification-240.mp3',
      win: 'https://assets.mixkit.co/sfx/preview/mixkit-small-crowd-cheer-and-applause-518.mp3',
      lose: 'https://assets.mixkit.co/sfx/preview/mixkit-game-over-dark-2068.mp3'
    };

    const THEME_STORAGE_KEY = 'mishkah:theme:prefs:v1';
    const THEME_BACKGROUND_PRESETS = [
      {
        id:'nebula',
        label:{ ar:'Ø´ÙÙ‚ Ø¨Ù†ÙØ³Ø¬ÙŠ', en:'Violet Nebula' },
        light:{
          gradient: 'linear-gradient(160deg, #f8f9ff 0%, #e8ecff 100%)',
          overlay1: 'radial-gradient(circle at 20% 25%, rgba(79, 70, 229, 0.18), transparent 55%)',
          overlay2: 'radial-gradient(circle at 80% 70%, rgba(14, 165, 233, 0.18), transparent 50%)',
          accentRing: 'rgba(79, 70, 229, 0.18)'
        },
        dark:{
          gradient: 'linear-gradient(160deg, #0d1224 0%, #111c3d 100%)',
          overlay1: 'radial-gradient(circle at 80% 30%, rgba(168, 85, 247, 0.22), transparent 55%)',
          overlay2: 'radial-gradient(circle at 15% 80%, rgba(56, 189, 248, 0.18), transparent 55%)',
          accentRing: 'rgba(129, 140, 248, 0.35)'
        }
      },
      {
        id:'sunset',
        label:{ ar:'Ø£ÙÙ‚ Ø§Ù„ØºØ±ÙˆØ¨', en:'Desert Sunset' },
        light:{
          gradient: 'linear-gradient(155deg, #fff4e6 0%, #ffd5c2 100%)',
          overlay1: 'radial-gradient(circle at 20% 25%, rgba(249, 115, 22, 0.22), transparent 55%)',
          overlay2: 'radial-gradient(circle at 80% 70%, rgba(236, 72, 153, 0.2), transparent 55%)',
          accentRing: 'rgba(249, 115, 22, 0.28)'
        },
        dark:{
          gradient: 'linear-gradient(155deg, #2b122e 0%, #40285d 100%)',
          overlay1: 'radial-gradient(circle at 70% 20%, rgba(236, 72, 153, 0.3), transparent 60%)',
          overlay2: 'radial-gradient(circle at 25% 80%, rgba(249, 115, 22, 0.28), transparent 60%)',
          accentRing: 'rgba(236, 72, 153, 0.38)'
        }
      },
      {
        id:'forest',
        label:{ ar:'Ø¶Ø¨Ø§Ø¨ Ø§Ù„ØºØ§Ø¨Ø©', en:'Forest Mist' },
        light:{
          gradient: 'linear-gradient(150deg, #ecfdf5 0%, #d1fae5 100%)',
          overlay1: 'radial-gradient(circle at 30% 25%, rgba(16, 185, 129, 0.2), transparent 55%)',
          overlay2: 'radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.15), transparent 55%)',
          accentRing: 'rgba(16, 185, 129, 0.28)'
        },
        dark:{
          gradient: 'linear-gradient(150deg, #052e16 0%, #0f4c3a 100%)',
          overlay1: 'radial-gradient(circle at 75% 25%, rgba(59, 130, 246, 0.22), transparent 60%)',
          overlay2: 'radial-gradient(circle at 20% 80%, rgba(16, 185, 129, 0.26), transparent 60%)',
          accentRing: 'rgba(16, 185, 129, 0.35)'
        }
      }
    ];

    const THEME_TEXT_SCHEMES = [
      {
        id:'cool',
        label:{ ar:'Ø£Ø²Ø±Ù‚ Ù…ØªØ²Ù†', en:'Cool Focus' },
        light:{
          foreground: 'hsl(222 47% 16%)',
          muted: 'hsl(215 18% 42%)',
          primary: '#4f46e5',
          onPrimary: '#f9fafb'
        },
        dark:{
          foreground: 'hsl(210 40% 96%)',
          muted: 'hsl(215 20% 72%)',
          primary: '#6366f1',
          onPrimary: '#0f172a'
        }
      },
      {
        id:'warm',
        label:{ ar:'Ø¯ÙØ¡ Ø§Ù„Ø´Ù…Ø³', en:'Warm Glow' },
        light:{
          foreground: 'hsl(26 42% 24%)',
          muted: 'hsl(27 35% 48%)',
          primary: '#f97316',
          onPrimary: '#1f2937'
        },
        dark:{
          foreground: 'hsl(35 92% 92%)',
          muted: 'hsl(27 55% 70%)',
          primary: '#fb923c',
          onPrimary: '#111827'
        }
      },
      {
        id:'zen',
        label:{ ar:'Ù‡Ø¯ÙˆØ¡ Ø§Ù„Ø¨Ø­Ø±', en:'Zen Tide' },
        light:{
          foreground: 'hsl(200 45% 20%)',
          muted: 'hsl(198 34% 45%)',
          primary: '#0ea5e9',
          onPrimary: '#062029'
        },
        dark:{
          foreground: 'hsl(189 70% 92%)',
          muted: 'hsl(191 45% 70%)',
          primary: '#38bdf8',
          onPrimary: '#0f172a'
        }
      }
    ];

    const DESIGN_LAB_THEME_MODES = [
      { id:'light', icon:'ğŸŒ', labelKey:'designLab.mode.light' },
      { id:'dark', icon:'ğŸŒ™', labelKey:'designLab.mode.dark' },
      { id:'pink', icon:'ğŸŒ¸', labelKey:'designLab.mode.pink', preset:{ backgroundId:'sunset', textSchemeId:'warm' } }
    ];

    const DESIGN_VAR_DEFINITIONS = [
      { name:'--foreground', labelKey:'designLab.var.foreground', type:'color', default:'#1f2937' },
      { name:'--muted-foreground', labelKey:'designLab.var.muted', type:'color', default:'#64748b' },
      { name:'--primary', labelKey:'designLab.var.primary', type:'color', default:'#4f46e5' },
      { name:'--primary-foreground', labelKey:'designLab.var.primaryForeground', type:'color', default:'#f9fafb' },
      { name:'--accent-ring', labelKey:'designLab.var.accentRing', type:'color', default:'#6366f1' },
      { name:'--page-gradient', labelKey:'designLab.var.gradient', type:'text', default:'linear-gradient(160deg, #f8f9ff 0%, #e8ecff 100%)' },
      { name:'--page-overlay-1', labelKey:'designLab.var.overlay1', type:'text', default:'radial-gradient(circle at 20% 25%, rgba(79, 70, 229, 0.18), transparent 55%)' },
      { name:'--page-overlay-2', labelKey:'designLab.var.overlay2', type:'text', default:'radial-gradient(circle at 80% 70%, rgba(14, 165, 233, 0.18), transparent 50%)' },
      { name:'--panel-glass', labelKey:'designLab.var.panelGlass', type:'text', default:'rgba(255, 255, 255, 0.78)' },
      { name:'--panel-border', labelKey:'designLab.var.panelBorder', type:'text', default:'rgba(99, 102, 241, 0.12)' },
      { name:'--tile-bg', labelKey:'designLab.var.tileBg', type:'text', default:'linear-gradient(160deg, rgba(255, 255, 255, 0.95), rgba(241, 245, 249, 0.85))' },
      { name:'--tile-bg-revealed', labelKey:'designLab.var.tileRevealed', type:'text', default:'linear-gradient(160deg, rgba(129, 140, 248, 0.75), rgba(79, 70, 229, 0.65))' },
      { name:'--tile-border', labelKey:'designLab.var.tileBorder', type:'text', default:'rgba(99, 102, 241, 0.25)' },
      { name:'--letters-shadow', labelKey:'designLab.var.lettersShadow', type:'text', default:'0 18px 45px -24px rgba(15, 23, 42, 0.35)' },
      { name:'--letters-hover', labelKey:'designLab.var.lettersHover', type:'text', default:'0 25px 50px -20px rgba(99, 102, 241, 0.45)' },
      { name:'--tile-size', labelKey:'designLab.var.tileSize', type:'range', min:2.6, max:4, step:0.05, unit:'rem', default:'3.1rem' },
      { name:'--font-size-body', labelKey:'designLab.var.font.body', type:'range', min:0.85, max:1.35, step:0.01, unit:'rem', default:'1rem' },
      { name:'--font-size-heading-1', labelKey:'designLab.var.font.h1', type:'range', min:2.1, max:3.4, step:0.05, unit:'rem', default:'2.6rem' },
      { name:'--font-size-heading-2', labelKey:'designLab.var.font.h2', type:'range', min:1.7, max:2.6, step:0.05, unit:'rem', default:'2.05rem' },
      { name:'--font-size-heading-3', labelKey:'designLab.var.font.h3', type:'range', min:1.3, max:2.2, step:0.05, unit:'rem', default:'1.62rem' },
      { name:'--font-size-scale-3xl', labelKey:'designLab.var.font.scale3xl', type:'range', min:1.7, max:3.1, step:0.05, unit:'rem', default:'2.35rem' },
      { name:'--font-size-scale-2xl', labelKey:'designLab.var.font.scale2xl', type:'range', min:1.4, max:2.6, step:0.05, unit:'rem', default:'1.8rem' },
      { name:'--font-size-scale-xl', labelKey:'designLab.var.font.scaleXl', type:'range', min:1.1, max:2.1, step:0.05, unit:'rem', default:'1.38rem' },
      { name:'--font-size-scale-lg', labelKey:'designLab.var.font.scaleLg', type:'range', min:1, max:1.9, step:0.03, unit:'rem', default:'1.18rem' },
      { name:'--font-size-scale-md', labelKey:'designLab.var.font.scaleMd', type:'range', min:0.85, max:1.6, step:0.02, unit:'rem', default:'1rem' },
      { name:'--font-size-scale-sm', labelKey:'designLab.var.font.scaleSm', type:'range', min:0.75, max:1.4, step:0.02, unit:'rem', default:'0.9rem' },
      { name:'--font-size-scale-xs', labelKey:'designLab.var.font.scaleXs', type:'range', min:0.6, max:1.2, step:0.02, unit:'rem', default:'0.78rem' },
      { name:'--font-size-sidebar', labelKey:'designLab.var.font.sidebar', type:'range', min:0.9, max:1.6, step:0.02, unit:'rem', default:'1.05rem' },
      { name:'--font-size-quote', labelKey:'designLab.var.font.quote', type:'range', min:1, max:1.8, step:0.02, unit:'rem', default:'1.18rem' },
      { name:'--font-size-info', labelKey:'designLab.var.font.info', type:'range', min:1.05, max:1.9, step:0.02, unit:'rem', default:'1.22rem' },
      { name:'--font-size-letter', labelKey:'designLab.var.font.letter', type:'range', min:1.1, max:1.9, step:0.02, unit:'rem', default:'1.35rem' },
      { name:'--font-size-status', labelKey:'designLab.var.font.status', type:'range', min:1, max:1.95, step:0.02, unit:'rem', default:'1.22rem' },
      { name:'--user-font-scale', labelKey:'designLab.var.fontScale', type:'range', min:90, max:130, step:2, unit:'%', default:'100', prefKey:'fontScale' }
    ];

    const DESIGN_VAR_DEF_MAP = Object.fromEntries(DESIGN_VAR_DEFINITIONS.map((def)=>[def.name, def]));
    const DESIGN_VAR_GROUPS = [
      { id:'core', labelKey:'designLab.group.core', hintKey:'designLab.group.coreHint', vars:['--foreground','--muted-foreground','--primary','--primary-foreground','--accent-ring'] },
      { id:'surface', labelKey:'designLab.group.surface', hintKey:'designLab.group.surfaceHint', vars:['--page-gradient','--page-overlay-1','--page-overlay-2','--panel-glass','--panel-border','--tile-bg','--tile-bg-revealed','--tile-border'] },
      { id:'effects', labelKey:'designLab.group.effects', hintKey:'designLab.group.effectsHint', vars:['--letters-shadow','--letters-hover'] },
      { id:'typography', labelKey:'designLab.group.typography', hintKey:'designLab.group.typographyHint', vars:[
        '--font-size-heading-1',
        '--font-size-heading-2',
        '--font-size-heading-3',
        '--font-size-scale-3xl',
        '--font-size-scale-2xl',
        '--font-size-scale-xl',
        '--font-size-scale-lg',
        '--font-size-scale-md',
        '--font-size-scale-sm',
        '--font-size-scale-xs',
        '--font-size-body',
        '--font-size-sidebar',
        '--font-size-quote',
        '--font-size-info',
        '--font-size-letter',
        '--font-size-status',
        '--user-font-scale'
      ] },
      { id:'sizing', labelKey:'designLab.group.sizing', hintKey:'designLab.group.sizingHint', vars:['--tile-size'] }
    ];

    const THEME_BACKGROUND_MAP = Object.fromEntries(THEME_BACKGROUND_PRESETS.map((p)=>[p.id, p]));
    const THEME_TEXT_SCHEME_MAP = Object.fromEntries(THEME_TEXT_SCHEMES.map((p)=>[p.id, p]));
    const THEME_DEFAULT_PREFS = { backgroundId:'nebula', textSchemeId:'cool', fontScale:100, customVars:{} };

    let CURRENT_THEME_BASELINE = {};
    let LAST_APPLIED_CUSTOM_VARS = new Set();

    function normalizeThemePrefs(raw){
      const base = { ...THEME_DEFAULT_PREFS, customVars:{} };
      const src = raw && typeof raw==='object' ? raw : {};
      if (src.backgroundId && THEME_BACKGROUND_MAP[src.backgroundId]) base.backgroundId = src.backgroundId;
      if (src.textSchemeId && THEME_TEXT_SCHEME_MAP[src.textSchemeId]) base.textSchemeId = src.textSchemeId;
      const font = parseInt(src.fontScale, 10);
      if (!Number.isNaN(font)) base.fontScale = Math.min(120, Math.max(90, font));
      if (src.customVars && typeof src.customVars==='object'){
        const nextVars = {};
        Object.entries(src.customVars).forEach(([key,value])=>{
          const def = DESIGN_VAR_DEF_MAP[key];
          if (def && def.prefKey) return;
          if (typeof value==='string' && value.trim()!=='') nextVars[key] = value;
        });
        base.customVars = nextVars;
      }
      return base;
    }

    function loadThemePrefs(){
      if (typeof window==='undefined' || !window.localStorage) return { ...THEME_DEFAULT_PREFS };
      try {
        const raw = window.localStorage.getItem(THEME_STORAGE_KEY);
        if (!raw) return { ...THEME_DEFAULT_PREFS };
        return normalizeThemePrefs(JSON.parse(raw));
      } catch (_err){
        return { ...THEME_DEFAULT_PREFS };
      }
    }

    function persistThemePrefs(prefs){
      if (typeof window==='undefined' || !window.localStorage) return;
      try { window.localStorage.setItem(THEME_STORAGE_KEY, JSON.stringify(prefs)); }
      catch(_err){ /* ignore storage quota issues */ }
    }

    function applyThemePrefs(prefs){
      if (typeof document==='undefined') return;
      const root = document.documentElement;
      if (!root) return;
      LAST_APPLIED_CUSTOM_VARS.forEach((name)=>{ try { root.style.removeProperty(name); } catch(_err){} });
      LAST_APPLIED_CUSTOM_VARS = new Set();
      const mode = root.classList.contains('dark') ? 'dark' : 'light';
      const bgPreset = THEME_BACKGROUND_MAP[prefs.backgroundId] || THEME_BACKGROUND_MAP[THEME_DEFAULT_PREFS.backgroundId];
      const textPreset = THEME_TEXT_SCHEME_MAP[prefs.textSchemeId] || THEME_TEXT_SCHEME_MAP[THEME_DEFAULT_PREFS.textSchemeId];
      const bg = bgPreset[mode];
      const text = textPreset[mode];
      if (bg){
        root.style.setProperty('--page-gradient', bg.gradient);
        root.style.setProperty('--page-overlay-1', bg.overlay1);
        root.style.setProperty('--page-overlay-2', bg.overlay2);
        if (bg.accentRing) root.style.setProperty('--accent-ring', bg.accentRing);
      }
      if (text){
        root.style.setProperty('--foreground', text.foreground);
        root.style.setProperty('--muted-foreground', text.muted);
        root.style.setProperty('--primary', text.primary);
        root.style.setProperty('--ring', text.primary);
        root.style.setProperty('--primary-foreground', text.onPrimary);
      }
      root.style.setProperty('--user-font-scale', String(prefs.fontScale));
      if (typeof window!=='undefined' && window.getComputedStyle){
        const computed = window.getComputedStyle(root);
        const snapshot = {};
        DESIGN_VAR_DEFINITIONS.forEach((def)=>{
          snapshot[def.name] = computed.getPropertyValue(def.name).trim();
        });
        CURRENT_THEME_BASELINE = snapshot;
      }
      const customVars = prefs.customVars && typeof prefs.customVars==='object' ? prefs.customVars : {};
      Object.entries(customVars).forEach(([name,value])=>{
        const def = DESIGN_VAR_DEF_MAP[name];
        if (def && def.prefKey) return;
        if (typeof value==='string' && value.trim()!==''){
          root.style.setProperty(name, value);
          LAST_APPLIED_CUSTOM_VARS.add(name);
        }
      });
    }

    const INITIAL_THEME_PREFS = loadThemePrefs();
    applyThemePrefs(INITIAL_THEME_PREFS);

    function randInt(min, max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffle(list){
      const arr = Array.isArray(list) ? list.slice() : [];
      for (let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generateLogicChallenge(){
      const types = ['arithmetic','square','double'];
      const type = types[Math.floor(Math.random()*types.length)];
      if (type==='square'){
        const start = randInt(2, 6);
        const sequence = [start, start+1, start+2, start+3].map((n)=> n*n);
        const answer = sequence[3];
        const pool = new Set([answer]);
        pool.add((start+4)*(start+4));
        pool.add((start+3)*(start+2));
        pool.add(Math.max(4, answer - (2*start + 3)));
        return {
          type,
          sequence,
          answer,
          options: shuffle(Array.from(pool).slice(0,4)),
          meta:{ start }
        };
      }
      if (type==='double'){
        const start = randInt(2, 9);
        const sequence = [start, start*2, start*4, start*8];
        const answer = sequence[3];
        const pool = new Set([answer]);
        pool.add(start*6);
        pool.add(start*10);
        pool.add(start*5);
        return {
          type,
          sequence,
          answer,
          options: shuffle(Array.from(pool).slice(0,4)),
          meta:{ start }
        };
      }
      const start = randInt(2, 18);
      const step = randInt(2, 7);
      const sequence = [start, start+step, start+2*step, start+3*step];
      const answer = sequence[3];
      const pool = new Set([answer]);
      while (pool.size < 4){
        const delta = randInt(-2,2);
        if (delta===0) continue;
        const candidate = answer + delta * step;
        if (candidate > 0) pool.add(candidate);
      }
      return {
        type:'arithmetic',
        sequence,
        answer,
        options: shuffle(Array.from(pool).slice(0,4)),
        meta:{ step, start }
      };
    }


    // ================================================================
    // Ø§Ù„Ø²ÙˆØ¬ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„ØªØ³ÙˆÙŠØ© (ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø³Ø¯)
    // Ù‡Ù†Ø§ Ù†ØµÙ†Ø¹ Ø§Ù„Ù‡ÙŠÙƒÙ„ ÙˆØ§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚.
    // ================================================================

    // ----------------------------------------------------------------
    // Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø·ÙŠÙ† ÙˆØ§Ù„Ø°Ø±Ø§Øª (`Atoms` as Components)
    // Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§ØªØŒ Ù„Ø¨Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ´ÙƒÙ„ Ø¬Ø³Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
    // ÙƒÙ„ Ù…ÙƒÙˆÙ† Ù‡Ùˆ "Ø°Ø±Ø©" Ø£Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ø© "Ø°Ø±Ø§Øª" Ù„Ù‡Ø§ Ø´ÙƒÙ„ ÙˆÙˆØ¸ÙŠÙØ© Ù…Ø­Ø¯Ø¯Ø©.
    // ----------------------------------------------------------------
    
    function computeTimeLeft(g){
      if (!g || !g.timerOn) return null;
      if (g.status==='running') return Math.max(0, typeof g.timeLeft === 'number' ? g.timeLeft : g.timerSec);
      return g.status==='lost' ? 0 : g.timerSec;
    }

    function GameStatusStrip(db){
      if (db.data.activeTab !== 'game') return null;
      const { TL } = makeLangLookup(db);
      const g = db.data.game;
      if (!g) return null;
      const timeLeftValue = computeTimeLeft(g);
      const hearts = Array.from({ length:g.triesMax }, (_,i)=>
        D.Text.Span({ attrs:{ key:`strip-heart-${i}`, class: tw`${i < g.triesLeft ? '' : 'opacity-35'}` }}, [i < g.triesLeft ? 'â¤ï¸' : 'ğŸ’”'])
      );
      const heartsRow = D.Containers.Div({ attrs:{ class:'header-status-hearts' }}, hearts);
      const timeBlock = D.Containers.Div({ attrs:{ class:'header-status-block', key:'status-time' }}, [
        D.Text.Span({ attrs:{ class:'header-status-label' }}, ['â³ ', TL('game.timeLabel')]),
        D.Text.Span({ attrs:{ class:'header-status-value' }}, [timeLeftValue !== null ? String(timeLeftValue) : 'â€”'])
      ]);
      const triesBlock = D.Containers.Div({ attrs:{ class:'header-status-block', key:'status-tries' }}, [
        D.Text.Span({ attrs:{ class:'header-status-label' }}, ['â¤ï¸ ', TL('game.tries')]),
        heartsRow,
        D.Text.Span({ attrs:{ class:'header-status-label' }}, [`/ ${g.triesMax}`])
      ]);
      const statusBlock = D.Containers.Div({ attrs:{ class:'header-status-block', key:'status-state' }}, [
        D.Text.Span({ attrs:{ class:'header-status-label' }}, ['ğŸ¯ ', TL('game.statusLabel')]),
        D.Text.Span({ attrs:{ class:'header-status-value' }}, [TL(`game.status.${g.status}`)])
      ]);
      return D.Containers.Div({ attrs:{ class:'header-status-strip', key:'status-strip' }}, [timeBlock, triesBlock, statusBlock]);
    }

    function HeaderBar(db){
      const { TL } = makeLangLookup(db);
      const g = db.data.game || {};
      const designLabButton = UI.Button({
        attrs:{
          gkey:'design:lab:open',
          class: tw`rounded-full w-11 h-11 flex items-center justify-center shadow-[0_16px_32px_-24px_rgba(79,70,229,0.55)]`,
          title: TL('designLab.openButton'),
          'aria-label': TL('designLab.openButton')
        },
        variant:'soft',
        size:'sm'
      }, ['ğŸ›ï¸']);
      const themeValue = db.env.theme === 'dark' ? 'dark' : 'light';
      const themeSwitcher = UI.SegmentedSwitch({
        attrs:{ 'data-switch':'theme' },
        value: themeValue,
        options:[
          { value:'light', label:`ğŸŒ ${TL('header.theme.light')}`, gkey:'ui:theme:set' },
          { value:'dark', label:`ğŸŒ™ ${TL('header.theme.dark')}`, gkey:'ui:theme:set' }
        ]
      });
      const langValue = db.env.lang === 'en' ? 'en' : 'ar';
      const langSwitcher = UI.SegmentedSwitch({
        attrs:{ 'data-switch':'lang' },
        value: langValue,
        options:[
          { value:'ar', label:`Ø¹ ${TL('header.lang.ar')}`, gkey:'ui:lang-ar' },
          { value:'en', label:`EN ${TL('header.lang.en')}`, gkey:'ui:lang-en' }
        ]
      });
      const statusStrip = GameStatusStrip(db);
      const leftBlock = D.Containers.Div({ attrs:{ class: tw`flex flex-col gap-0.5` }}, [
        D.Text.Span({ attrs:{ class: tw`text-2xl font-bold tracking-tight` }}, [TL('app.title')]),
        D.Text.Span({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('header.subtitle')])
      ]);
      const gameToggle = db.data.activeTab==='game'
        ? UI.Button({
            attrs:{
              gkey:'game:start',
              class: tw`rounded-full px-5 font-semibold`
            },
            variant:'destructive',
            size:'sm'
          }, [g.status==='running' ? TL('game.new') : TL('game.start')])
        : null;
      const controlChildren = [themeSwitcher, langSwitcher, gameToggle, designLabButton].filter(Boolean);
      const controlBlock = D.Containers.Div({ attrs:{ class: tw`flex items-center gap-2 flex-wrap justify-end` }}, controlChildren);
      const rowChildren = [
        D.Containers.Div({ attrs:{ class: tw`flex-1 min-w-[240px]` }}, [leftBlock]),
        statusStrip ? D.Containers.Div({ attrs:{ class: tw`flex-1 flex justify-center min-w-[260px]` }}, [statusStrip]) : null,
        D.Containers.Div({ attrs:{ class: tw`flex items-center justify-end gap-2 min-w-[260px]` }}, [controlBlock])
      ].filter(Boolean);
      return D.Containers.Header({ attrs:{ class: tw`px-5 pt-3 pb-3` }}, [
        D.Containers.Div({ attrs:{ class: tw`mx-auto w-full max-w-[1600px]` }}, [
          D.Containers.Div({ attrs:{ class: `${tw`rounded-2xl px-4 py-3`} glass-panel glow-outline` }}, [
            D.Containers.Div({ attrs:{ class: tw`flex flex-wrap items-center gap-3` }}, rowChildren)
          ])
        ])
      ]);
    }

    function Sidebar(db){
      const { TL } = makeLangLookup(db);
      const route = db.data.activeTab;
      const NavBtn = (id,label,icon)=>{
        const active = route===id;
        return UI.Button({
          attrs:{
            gkey:`route:${id}`,
            class:`${tw`w-full justify-start text-start rounded-2xl transition-all duration-200`} glass-panel ${active ? 'glow-outline' : 'hover:opacity-90'} ${active?'':'opacity-85'}`
          },
          variant:'ghost', size:'sm'
        }, [`${icon} `, TL(label)]);
      };
      return D.Containers.Div({ attrs:{ class: tw`space-y-4` }}, [
        D.Containers.Div({ attrs:{ class: `${tw`rounded-3xl p-4 space-y-3`} glass-panel glow-outline` }}, [
          D.Text.Span({ attrs:{ class: tw`text-sm uppercase tracking-[0.3em] text-[var(--muted-foreground)]` }}, [TL('nav.menu')]),
          D.Containers.Nav({ attrs:{ class: tw`space-y-3` }}, [
            NavBtn('readmeBase','nav.readmeBase','ğŸŒŒ'),
            NavBtn('readmeTec','nav.readmeTec','ğŸ› ï¸'),
            NavBtn('counter','nav.counter','ğŸ”¢'),
            NavBtn('game','nav.game','ğŸ®'),
            NavBtn('logic','nav.logic','ğŸ§ ')
          ])
        ])
      ]);
    }

    function DocPanel(db, kind){
      const lang = db.env.lang || 'ar';
      const key = kind==='tec' ? 'doc.tec.lead' : 'doc.base.lead';
      const titleKey = kind==='tec' ? 'nav.readmeTec' : 'nav.readmeBase';
      const docs = db.data.docs || {};
      const store = kind==='tec' ? docs.tec || {} : docs.base || {};
      const fallback = lang==='ar' ? (store.en || '') : (store.ar || '');
      const content = store[lang] || fallback || '';
      const { TL } = makeLangLookup(db);

      return UI.Card({
        title: TL(titleKey),
        description: TL('doc.language.hint'),
        content: D.Containers.Div({ attrs:{ class: tw`space-y-4` }}, [
          D.Text.P({ attrs:{ class: tw`text-base font-semibold`, style:'color:color-mix(in oklab,var(--foreground) 92%, var(--primary) 8%);' }}, [TL(key)]),
          UI.Markdown({ content, className: tw`md-prose` })
        ])
      });
    }

    function CounterPanel(db){
      const { TL } = makeLangLookup(db);
      return UI.Card({
        title: TL('counter.title'),
        content: D.Containers.Div({ attrs:{ class: tw`flex items-center justify-center gap-3` }}, [
          UI.Button({ attrs:{ gkey:'counter:dec' }, variant:'soft', size:'sm' }, ['âˆ’']),
          D.Text.Span({ attrs:{ class: tw`text-2xl font-bold` }}, [String(db.data.counter)]),
          UI.Button({ attrs:{ gkey:'counter:inc' }, variant:'soft', size:'sm' }, ['+']),
          UI.Button({ attrs:{ gkey:'counter:reset', class:tw`ms-4` }, variant:'ghost', size:'sm' }, [TL('counter.reset')]),
        ])
      });
    }

    function GamePanel(db){
      const { TL } = makeLangLookup(db);
      const g = db.data.game;
      const showSolution = g.revealSolution || g.status==='won';

      const pv = g.proverb?.t || '';
      const feedbackType = g.feedback?.type || 'idle';
      const feedbackStamp = g.feedback?.stamp || 0;

      const tiles = pv.split('').map((raw, idx)=>{
        if (raw===' ') return D.Containers.Div({ attrs:{ key:'sp'+idx, class: 'letter-space' }});
        const normalized = norm(raw);
        const revealed = !!g.guessed[normalized];
        return D.Containers.Div({
          attrs:{
            key:'bx'+idx,
            class: `${tw`grid place-items-center rounded-2xl text-2xl md:text-3xl font-semibold letter-tile letter-slot`}`,
            'data-revealed': revealed ? 'true' : 'false'
          }
        }, [ revealed ? raw : '' ]);
      });

      const puzzleRow = D.Containers.Div({ attrs:{ class: `${tw`flex flex-wrap justify-center gap-3`} puzzle-row` }}, tiles);

      const letters = D.Containers.Div({ attrs:{ class: `${tw`grid grid-cols-6 sm:grid-cols-8 xl:grid-cols-10 gap-2 letters-grid`}` }}, AR_ALPHA.map((L,i)=>
        UI.Button({
          attrs:{
            key:'L'+i,
            gkey:'game:guess',
            'data-ch':L,
            disabled: g.status!=='running' || !!g.guessed[L],
            class: tw`text-xl sm:text-2xl font-extrabold tracking-wider`
          },
          variant:'soft',
          size:'lg'
        }, [L])
      ));

      const feedbackClass = feedbackType && feedbackType!=='idle' ? ` feedback-${feedbackType}` : '';

      const boardCard = D.Containers.Div({ attrs:{ class: `${tw`space-y-6`} glass-panel glow-outline p-6 rounded-3xl game-board${feedbackClass}` }}, [
        D.Containers.Div({ attrs:{ class: tw`space-y-4` }}, [
          puzzleRow,
          UI.Divider(),
          D.Containers.Div({ attrs:{ class: tw`space-y-2` }}, [
            D.Text.Strong({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('game.letters')]),
            letters
          ])
        ])
      ]);

      const feedbackMessages = {
        correct: TL('game.feedback.correct'),
        wrong: TL('game.feedback.wrong'),
        win: TL('game.feedback.win'),
        lose: TL('game.feedback.lose')
      };
      const feedbackIcons = { correct:'âœ…', wrong:'âš ï¸', win:'ğŸ†', lose:'ğŸ’”' };

      const infoItems = [];
      if (feedbackType !== 'idle' && feedbackMessages[feedbackType]){
        infoItems.push(
          D.Containers.Div({ attrs:{ class: `${tw`rounded-3xl p-5 space-y-3`} glass-panel`, key:'feedback-card' }}, [
            UI.Badge({ attrs:{ class: tw`w-fit` }, leading: feedbackIcons[feedbackType] || 'âœ¨', text:TL('game.lastMove') }),
            D.Text.P({ attrs:{ class:'game-info-text' }}, [feedbackMessages[feedbackType]])
          ])
        );
      }

      if (g.proverb){
        infoItems.push(
          D.Containers.Div({ attrs:{ class: `${tw`rounded-3xl p-5 space-y-3`} glass-panel`, key:'hint-card' }}, [
            UI.Badge({ attrs:{ class: tw`w-fit` }, leading:'ğŸ’¡', text:TL('game.hintTitle') }),
            D.Text.P({ attrs:{ class:'game-info-text' }}, [g.proverb.hint])
          ])
        );
      }

      if (showSolution && g.proverb){
        infoItems.push(
          D.Containers.Div({ attrs:{ class: `${tw`rounded-3xl p-5 space-y-3`} glass-panel glow-outline solution-target`, style:'grid-column: 1 / -1;', key:'solution-card', id:'game-solution-card', tabindex:'-1' }}, [
            UI.Badge({ attrs:{ class: tw`w-fit` }, leading:'ğŸ“œ', text:TL('game.solution') }),
            g.status==='lost'
              ? D.Text.P({ attrs:{ class:'game-info-text' }}, [TL('game.overlay.loseInsight')])
              : D.Text.P({ attrs:{ class:'game-info-text' }}, [TL('game.overlay.winInsight')]),
            D.Text.P({ attrs:{ class: tw`font-semibold` + ' game-info-text' }}, [g.proverb.t]),
            D.Text.P({ attrs:{ class:'game-info-text' }}, [TL('game.explanation'), ': ', g.proverb.explanation]),
            D.Text.P({ attrs:{ class:'game-info-text' }}, [TL('game.lesson'), ': ', g.proverb.lesson]),
            D.Text.P({ attrs:{ class: tw`text-xs text-[var(--muted-foreground)]` }}, [TL('game.source'), ': ', g.proverb.source])
          ])
        );
      }

      let infoSection = null;
      if (infoItems.length){
        let infoClass = tw`grid gap-4`;
        if (infoItems.length >= 3) infoClass += ' ' + tw`md:grid-cols-2 xl:grid-cols-3`;
        else if (infoItems.length === 2) infoClass += ' ' + tw`md:grid-cols-2`;
        infoSection = D.Containers.Div({ attrs:{ class: infoClass }}, infoItems);
      }

      const confettiLayer = feedbackType==='win'
        ? D.Containers.Div({ attrs:{ class:'confetti-layer', key:`confetti-${feedbackStamp}` }},
            Array.from({ length: 70 }, (_,i)=>{
              const colors = ['#f97316','#38bdf8','#a855f7','#facc15','#f472b6'];
              const left = (Math.random()*100).toFixed(2);
              const delay = (Math.random()*1.2).toFixed(2);
              return D.Text.Span({ attrs:{ key:`confetti-${i}`, class:'confetti-piece', style:`left:${left}%; background:${colors[i % colors.length]}; animation-delay:${delay}s;` }});
            })
          )
        : null;

      const resultCard = g.status==='won' && g.proverb
        ? D.Containers.Div({ attrs:{ class: `${tw`rounded-3xl p-6 space-y-4 text-center`} glass-panel celebration-card` }}, [
            D.Containers.Div({ attrs:{ class: `${tw`space-y-3`} game-overlay-content` }}, [
              UI.Badge({ attrs:{ class: tw`w-fit mx-auto` }, leading:'ğŸ‰', text:TL('game.overlay.winTitle') }),
              D.Text.P({ attrs:{ class:'game-info-text' }}, [TL('game.overlay.winInsight')]),
              D.Text.P({ attrs:{ class: tw`font-semibold` + ' game-info-text' }}, [g.proverb.t]),
              D.Text.P({ attrs:{ class:'game-info-text' }}, [TL('game.rewardTitle'), ': ', g.proverb.lesson]),
              D.Text.P({ attrs:{ class: tw`text-xs text-[var(--muted-foreground)]` }}, [TL('game.source'), ': ', g.proverb.source]),
              UI.Button({ attrs:{ gkey:'game:start', class: tw`mt-2 px-8 py-3 rounded-full font-semibold` }, variant:'destructive', size:'lg' }, [TL('game.playAgain')])
            ])
          ])
        : (g.status==='lost' && !g.revealSolution)
        ? UI.SweetNotice({
            attrs:{ key:'gameover-card', class: tw`gameover-card` },
            tone:'danger',
            icon:'ğŸ’”',
            title: TL('game.overlay.loseTitle'),
            message: TL('game.overlay.loseSubtitle'),
            hint: !showSolution ? TL('game.revealPrompt') : null,
            actions:[
              UI.Button({ attrs:{ gkey:'game:start', class: tw`px-7 py-3 rounded-full font-semibold` }, variant:'destructive', size:'lg' }, [TL('game.tryAgain')]),
              (!showSolution ? UI.Button({ attrs:{ gkey:'game:reveal', class: tw`px-7 py-3 rounded-full font-semibold` }, variant:'soft', size:'lg' }, [TL('game.reveal')]) : null)
            ].filter(Boolean)
          })
        : null;

      const playItems = [resultCard, boardCard].filter(Boolean);
      const playSection = playItems.length > 1
        ? D.Containers.Div({ attrs:{ class: tw`space-y-6` }}, playItems)
        : boardCard;

      const audioNode = (g.musicOn && g.status==='running')
        ? D.Media.Audio({ attrs:{ autoplay:true, loop:true, src:g.audioList[g.audioIdx].url, class: tw`hidden`, key:`bgm-${g.soundStamp||0}` }})
        : null;

      const cueAudio = (feedbackType && feedbackType!=='idle' && SOUND_EFFECTS[feedbackType])
        ? D.Media.Audio({ attrs:{ autoplay:true, src:SOUND_EFFECTS[feedbackType], class: tw`hidden`, key:`cue-${feedbackStamp}` }})
        : null;

      return D.Containers.Div({ attrs:{ class: `${tw`relative space-y-6`} game-panel` }}, [
        confettiLayer,
        playSection,
        infoSection,
        audioNode,
        cueAudio
      ].filter(Boolean));
    }

    function LogicGamePanel(db){
      const { TL } = makeLangLookup(db);
      const logic = db.data.logicGame || {};
      const challenge = logic.challenge;
      const hasChallenge = Array.isArray(challenge?.sequence);
      const bodySections = [];

      if (!hasChallenge){
        bodySections.push(
          D.Containers.Div({ attrs:{ class: tw`space-y-4 text-center py-8` }}, [
            D.Text.P({ attrs:{ class: tw`text-base text-[var(--muted-foreground)]` }}, [TL('logic.subtitle')]),
            UI.Button({ attrs:{ gkey:'logic:start', class: tw`rounded-full px-10 py-3 font-semibold` }, variant:'solid', size:'lg' }, [TL('logic.start')])
          ])
        );
      } else {
        bodySections.push(
          D.Containers.Div({ attrs:{ class: tw`flex justify-end` }}, [
            UI.Button({ attrs:{ gkey:'logic:start', class: tw`rounded-full px-6 font-semibold` }, variant:'soft', size:'sm' }, [TL('logic.newChallenge')])
          ])
        );
        const seqTiles = challenge.sequence.map((value, idx, arr)=>{
          const display = idx===arr.length-1 ? 'ØŸ' : String(value);
          return D.Containers.Div({ attrs:{ key:`logic-seq-${idx}`, class: `${tw`w-16 h-16 md:w-20 md:h-20 rounded-3xl grid place-items-center text-lg md:text-xl font-semibold`} glass-panel` }}, [display]);
        });
        bodySections.push(
          D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
            D.Text.Span({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('logic.sequenceIntro')]),
            D.Containers.Div({ attrs:{ class: tw`flex flex-wrap items-center justify-center gap-3` }}, seqTiles)
          ])
        );
        const optionsList = Array.isArray(logic.options) && logic.options.length ? logic.options : (challenge.options || []);
        const optionButtons = optionsList.map((value)=>{
          const choice = Number(value);
          const isSelected = logic.selected === choice;
          const feedbackType = logic.feedback?.type;
          const correctChoice = choice === challenge.answer;
          const isCorrectSelection = feedbackType==='correct' && isSelected && correctChoice;
          const isWrongSelection = feedbackType==='wrong' && isSelected && !correctChoice;
          let variant = 'soft';
          if (isCorrectSelection) variant = 'solid';
          else if (isWrongSelection) variant = 'destructive';
          const classParts = [];
          if (isSelected) classParts.push(tw`ring-2 ring-offset-2 ring-[var(--ring)]`);
          const btnAttrs = {
            key:`logic-opt-${choice}`,
            gkey:'logic:answer',
            'data-choice': String(choice),
            class: classParts.length ? classParts.join(' ') : undefined
          };
          if (feedbackType==='correct') btnAttrs.disabled = 'disabled';
          return UI.Button({ attrs: btnAttrs, variant, size:'md' }, [String(choice)]);
        });
        bodySections.push(
          D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
            D.Text.Span({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('logic.optionsPrompt')]),
            D.Containers.Div({ attrs:{ class: tw`grid grid-cols-2 sm:grid-cols-4 gap-3` }}, optionButtons)
          ])
        );
        if (logic.feedback){
          let explanationText = '';
          if (challenge.type==='arithmetic'){ explanationText = TL('logic.sequence.step').replace('{step}', String(challenge.meta?.step ?? '')); }
          else if (challenge.type==='square'){ explanationText = TL('logic.square.hint').replace('{start}', String(challenge.meta?.start ?? '')); }
          else { explanationText = TL('logic.double.hint'); }
          const badgeIcon = logic.feedback.type==='correct' ? 'âœ…' : 'ğŸ§';
          bodySections.push(
            D.Containers.Div({ attrs:{ class: `${tw`rounded-3xl p-5 space-y-3`} glass-panel` }}, [
              UI.Badge({ attrs:{ class: tw`w-fit` }, leading: badgeIcon, text: TL(`logic.feedback.${logic.feedback.type}`) }),
              explanationText ? D.Text.P({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)] leading-relaxed` }}, [explanationText]) : null,
              D.Text.P({ attrs:{ class: tw`text-xs text-[var(--muted-foreground)]` }}, [TL('logic.explanation'), ': ', String(challenge.answer)])
            ].filter(Boolean))
          );
        }
      }

      return UI.Card({
        title: TL('logic.title'),
        description: TL('logic.subtitle'),
        content: D.Containers.Div({ attrs:{ class: tw`space-y-6` }}, bodySections)
      });
    }

    function DesignLabPanel(db){
      const design = db.data.designLab || {};
      if (!design.open) return null;
      const { TL } = makeLangLookup(db);
      const prefs = normalizeThemePrefs(db.data.themePrefs || INITIAL_THEME_PREFS);
      const customVars = prefs.customVars || {};
      const activeTheme = db.env.theme || 'light';

      const modeButtons = DESIGN_LAB_THEME_MODES.map((mode)=>{
        const isActive = mode.id==='pink'
          ? activeTheme==='pink'
          : (activeTheme===mode.id || (mode.id==='light' && activeTheme!=='dark' && activeTheme!=='pink'));
        const btnVariant = isActive ? 'soft' : 'ghost';
        const btnClass = isActive ? tw`shadow-[0_16px_36px_-22px_rgba(79,70,229,0.55)]` : '';
        return UI.Button({
          attrs:{
            key:`mode-${mode.id}`,
            gkey:'design:theme',
            'data-mode':mode.id,
            class: btnClass
          },
          variant: btnVariant,
          size:'sm'
        }, [`${mode.icon} `, TL(mode.labelKey)]);
      });

      const unitFor = (def)=> def.unit || (def.prefKey==='fontScale' ? '%' : '');
      const parseNumericValue = (value, unit)=>{
        if (value == null) return null;
        if (typeof value === 'number') return value;
        const str = String(value).trim();
        if (!str) return null;
        if (unit && str.endsWith(unit)){
          const raw = str.slice(0, -unit.length);
          const num = parseFloat(raw);
          return Number.isNaN(num) ? null : num;
        }
        const num = parseFloat(str);
        return Number.isNaN(num) ? null : num;
      };

      const sectionNodes = DESIGN_VAR_GROUPS.map((group)=>{
        const rows = group.vars.map((name)=>{
          const def = DESIGN_VAR_DEF_MAP[name];
          if (!def) return null;
          const unit = unitFor(def);
          let baseline = def.prefKey==='fontScale'
            ? `${THEME_DEFAULT_PREFS.fontScale}${unit || ''}`
            : (CURRENT_THEME_BASELINE[name] || def.default || '');
          if (def.type === 'color'){
            const normalizedBase = U.Color && typeof U.Color.toHex === 'function' ? U.Color.toHex(baseline) : null;
            if (normalizedBase) baseline = normalizedBase;
          }
          const stored = def.prefKey ? null : (Object.prototype.hasOwnProperty.call(customVars, name) ? customVars[name] : null);
          const hasCustom = def.prefKey
            ? (def.prefKey==='fontScale' ? prefs.fontScale !== THEME_DEFAULT_PREFS.fontScale : false)
            : Object.prototype.hasOwnProperty.call(customVars, name);

          let currentValue;
          if (def.prefKey==='fontScale') currentValue = `${prefs.fontScale}${unit || ''}`;
          else if (stored != null && String(stored).trim()!=='') currentValue = String(stored).trim();
          else currentValue = baseline;
          if (def.type === 'color'){
            const normalizedCurrent = U.Color && typeof U.Color.toHex === 'function' ? U.Color.toHex(currentValue) : null;
            if (normalizedCurrent) currentValue = normalizedCurrent;
          }

          const labelNode = D.Containers.Div({ attrs:{ class:'design-lab-label' }}, [
            D.Text.Strong({}, [TL(def.labelKey)]),
            D.Text.Span({ attrs:{ class:'design-lab-meta' }}, [TL('designLab.defaultValue'), ': ', baseline || 'â€”']),
            D.Text.Span({ attrs:{ class:'design-lab-meta' }}, [TL('designLab.currentValue'), ': ', currentValue || 'â€”'])
          ]);

          const resetButton = D.Forms.Button({ attrs:{
            gkey:'design:var:reset',
            'data-var':name,
            disabled: hasCustom ? undefined : 'disabled',
            class:'design-lab-reset',
            title: TL('designLab.resetVar'),
            'aria-label': TL('designLab.resetVar')
          }}, ['â†º']);

          const rowAttrs = { key:name, class:'design-lab-row', 'data-type': def.type };
          const rowChildren = [labelNode];

          if (def.type === 'color'){
            const colorValue = U.Color && typeof U.Color.toHex === 'function'
              ? (U.Color.toHex(stored || currentValue || baseline || def.default || '') || U.Color.toHex(def.default || '') || '#6366f1')
              : ((stored || currentValue || baseline || def.default || '#6366f1'));
            rowChildren.push(
              D.Containers.Div({ attrs:{ class:'design-lab-color-chip', style:`background:${colorValue}` }})
            );
            rowChildren.push(
              D.Inputs.Input({ attrs:{
                type:'color',
                value: colorValue,
                gkey:'design:var:update',
                'data-var':name,
                'data-editor':'color',
                class:'design-lab-color-input'
              }})
            );
            rowChildren.push(
              D.Inputs.Input({ attrs:{
                type:'text',
                value: currentValue || '',
                placeholder: baseline,
                gkey:'design:var:update',
                'data-var':name,
                'data-editor':'text',
                class:'design-lab-value-input'
              }})
            );
          } else if (def.type === 'range'){
            rowAttrs['data-type'] = 'range';
            let sliderValue;
            if (def.prefKey==='fontScale') sliderValue = prefs.fontScale;
            else {
              const baseValue = stored != null ? stored : (currentValue || baseline || def.default);
              sliderValue = parseNumericValue(baseValue, unit);
            }
            if (sliderValue == null || Number.isNaN(sliderValue)) sliderValue = def.min;
            const sliderAttrs = {
              type:'range',
              min:String(def.min),
              max:String(def.max),
              step:String(def.step),
              value:String(sliderValue),
              class:'design-lab-slider',
              'data-var':name
            };
            if (def.prefKey==='fontScale') sliderAttrs.gkey = 'prefs:fontScale';
            else {
              sliderAttrs.gkey = 'design:var:update';
              sliderAttrs['data-editor'] = 'range';
              if (unit) sliderAttrs['data-unit'] = unit;
            }
            const previewStyle = def.prefKey==='fontScale'
              ? `font-size: calc(var(--font-size-body) * ${sliderValue} / 100);`
              : `font-size: calc(var(${name}) * var(--user-font-scale) / 100);`;
            const factorText = def.prefKey==='fontScale'
              ? `Ã— ${(sliderValue/100).toFixed(2)}`
              : 'Aa Ø£Ø¨';
            rowChildren.push(
              D.Text.Span({ attrs:{ class:'design-lab-font-preview', style: previewStyle }}, [factorText])
            );
            rowChildren.push(
              D.Inputs.Input({ attrs: sliderAttrs })
            );
            const decimals = (String(def.step).split('.')[1] || '').length;
            const formattedNumber = decimals ? Number(sliderValue).toFixed(decimals) : String(Math.round(sliderValue));
            const numberAttrs = {
              type:'number',
              min:String(def.min),
              max:String(def.max),
              step:String(def.step),
              value: formattedNumber,
              class:'design-lab-number-input',
              'data-var':name
            };
            if (def.prefKey==='fontScale') numberAttrs.gkey = 'prefs:fontScale';
            else {
              numberAttrs.gkey = 'design:var:update';
              numberAttrs['data-editor'] = 'number';
              if (unit) numberAttrs['data-unit'] = unit;
            }
            rowChildren.push(
              D.Inputs.Input({ attrs: numberAttrs })
            );
          } else {
            rowAttrs['data-type'] = 'text';
            rowChildren.push(
              D.Inputs.Input({ attrs:{
                type:'text',
                value: currentValue || '',
                placeholder: baseline,
                gkey:'design:var:update',
                'data-var':name,
                'data-editor':'text',
                class:'design-lab-value-input'
              }})
            );
          }

          rowChildren.push(resetButton);
          return D.Containers.Div({ attrs: rowAttrs }, rowChildren.filter(Boolean));
        }).filter(Boolean);

        if (!rows.length) return null;
        return D.Containers.Div({ attrs:{ key:`group-${group.id}`, class: tw`space-y-3` }}, [
          D.Containers.Div({ attrs:{ class: tw`space-y-1` }}, [
            D.Text.H4({ attrs:{ class: tw`text-lg font-semibold` }}, [TL(group.labelKey)]),
            D.Text.Span({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL(group.hintKey)])
          ]),
          D.Containers.Div({ attrs:{ class:'design-lab-grid' }}, rows)
        ]);
      }).filter(Boolean);

      return UI.Modal({
        open: true,
        title: TL('designLab.title'),
        description: TL('designLab.subtitle'),
        size:'xl',
        closeGkey:'design:lab:close',
        content: D.Containers.Div({ attrs:{ class: tw`space-y-6` }}, [
          D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
            D.Text.H4({ attrs:{ class: tw`text-base font-semibold` }}, [TL('designLab.themeTitle')]),
            D.Text.Span({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('designLab.modeHint')]),
            D.Containers.Div({ attrs:{ class: tw`flex flex-wrap items-center gap-3` }}, modeButtons)
          ]),
          ...sectionNodes
        ]),
        actions:[
          UI.Button({ attrs:{ gkey:'design:var:resetAll' }, variant:'ghost', size:'sm' }, [TL('designLab.resetAll')]),
          UI.Button({ attrs:{ gkey:'design:lab:close' }, variant:'soft', size:'sm' }, [TL('settings.close')])
        ]
      });
    }

    function SettingsModal(db){
      if (!db.data.settingsOpen) return null;
      const { TL } = makeLangLookup(db);
      const g = db.data.game;
      const prefs = db.data.themePrefs || INITIAL_THEME_PREFS;
      const lang = db.env.lang || 'ar';
      const backgroundOptions = THEME_BACKGROUND_PRESETS.map((opt)=>({ value: opt.id, label: opt.label[lang] || opt.label.ar }));
      const textOptions = THEME_TEXT_SCHEMES.map((opt)=>({ value: opt.id, label: opt.label[lang] || opt.label.ar }));
      const mode = db.env.theme === 'dark' ? 'dark' : 'light';
      const bgPreset = (THEME_BACKGROUND_MAP[prefs.backgroundId] || THEME_BACKGROUND_MAP[THEME_DEFAULT_PREFS.backgroundId])[mode];

      const musicTile = D.Containers.Div({ attrs:{ class: 'settings-tile' }}, [
        UI.Badge({ attrs:{ class: tw`bg-transparent text-[var(--muted-foreground)]` }, leading:'ğŸµ', text:TL('game.music') }),
        D.Containers.Div({ attrs:{ class: tw`flex items-center gap-2` }}, [
          UI.Input({ attrs:{ type:'checkbox', checked:g.musicOn, gkey:'game:music:toggle' } }),
          D.Text.Span({ attrs:{ class: tw`text-sm` }}, [TL(g.musicOn ? 'game.musicOn' : 'game.musicOff')])
        ]),
        UI.Select({ attrs:{ gkey:'game:music:select', value:String(g.audioIdx), class: tw`min-w-[200px]` }, options: g.audioList.map((it,i)=>({ value:String(i), label:it.name })) })
      ]);

      const timerTile = D.Containers.Div({ attrs:{ class: 'settings-tile' }}, [
        UI.Badge({ attrs:{ class: tw`bg-transparent text-[var(--muted-foreground)]` }, leading:'â±ï¸', text:TL('game.timer') }),
        D.Containers.Div({ attrs:{ class: tw`flex items-center gap-2` }}, [
          UI.Input({ attrs:{ type:'checkbox', checked:g.timerOn, gkey:'game:timer:toggle' } }),
          D.Text.Span({ attrs:{ class: tw`text-sm` }}, [TL(g.timerOn ? 'game.timerOn' : 'game.timerOff')])
        ]),
        D.Containers.Div({ attrs:{ class: tw`flex items-center gap-2` }}, [
          UI.Input({ attrs:{ type:'number', min:'5', step:'1', value:String(g.timerSec), style:'width:92px', gkey:'game:timer:value' } }),
          D.Text.Span({ attrs:{ class: tw`text-xs text-[var(--muted-foreground)]` }}, [TL('game.seconds')])
        ])
      ]);

      const themeControls = D.Containers.Div({ attrs:{ class: tw`space-y-4` }}, [
        D.Text.P({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('settings.previewHint')]),
        D.Containers.Div({ attrs:{ class: tw`flex flex-col gap-3 md:flex-row` }}, [
          UI.Select({ attrs:{ gkey:'prefs:background', value:prefs.backgroundId, class: tw`min-w-[220px]` }, options: backgroundOptions }),
          UI.Select({ attrs:{ gkey:'prefs:text', value:prefs.textSchemeId, class: tw`min-w-[220px]` }, options: textOptions })
        ]),
        D.Containers.Div({ attrs:{ class: tw`space-y-2` }}, [
          D.Text.Span({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('settings.fontLabel'), ': ', `${prefs.fontScale}%`]),
          D.Inputs.Input({ attrs:{ type:'range', min:'90', max:'120', step:'5', value:String(prefs.fontScale), gkey:'prefs:fontScale', class: tw`w-full accent-[var(--primary)]` }})
        ]),
        D.Text.Span({ attrs:{ class: tw`text-sm text-[var(--muted-foreground)]` }}, [TL('settings.previewLabel')]),
        D.Containers.Div({ attrs:{ class: tw`rounded-2xl h-36 glass-panel overflow-hidden` }}, [
          D.Containers.Div({ attrs:{ class: tw`w-full h-full` , style:`background:${bgPreset?.gradient || 'var(--page-gradient)'};` }})
        ])
      ]);

      return UI.Modal({
        open: true,
        title: TL('settings.title'),
        description: TL('settings.description'),
        size: 'lg',
        closeGkey: 'ui:settings:close',
        content: D.Containers.Div({ attrs:{ class: tw`space-y-8` }}, [
          D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
            D.Text.H4({ attrs:{ class: tw`text-lg font-semibold` }}, [TL('settings.gameSection')]),
            D.Containers.Div({ attrs:{ class: tw`flex flex-col gap-4` }}, [musicTile, timerTile])
          ]),
          D.Containers.Div({ attrs:{ class: tw`space-y-3` }}, [
            D.Text.H4({ attrs:{ class: tw`text-lg font-semibold` }}, [TL('settings.themeSection')]),
            themeControls
          ])
        ]),
        actions: [
          UI.Button({ attrs:{ gkey:'prefs:reset', class: tw`flex-1` }, variant:'ghost', size:'sm' }, [TL('settings.reset')]),
          UI.Button({ attrs:{ gkey:'ui:settings:close', class: tw`flex-1` }, variant:'soft', size:'sm' }, [TL('settings.close')])
        ]
      });
    }

    function MainContent(db){
      const tab = db.data.activeTab;
      if (tab==='readmeBase') return DocPanel(db, 'base');
      if (tab==='readmeTec')  return DocPanel(db, 'tec');
      if (tab==='counter') return CounterPanel(db);
      if (tab==='game')    return GamePanel(db);
      if (tab==='logic')   return LogicGamePanel(db);
      return DocPanel(db, 'base');
    }
    
    // ----------------------------------------------------------------
    // Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¹Ù„Ù… Ø§Ù„ÙØ·Ø±ÙŠ (`database` as DNA)
    // Ù‡Ø°Ù‡ Ù‡ÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©ØŒ Ø§Ù„Ø´ÙØ±Ø© Ø§Ù„ÙˆØ±Ø§Ø«ÙŠØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚.
    // Ù‡ÙŠ ØªØ­Ø¯Ø¯ Ø§Ù„ØµÙØ§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ÙˆØ§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ØªÙŠ Ø³ÙŠÙØ®Ù„Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ Ø§Ù„Ø¬Ø³Ø¯.
    // ----------------------------------------------------------------
    const database = {
      env:{ theme:'dark', lang:'ar', dir:'rtl' },
      i18n:{ lang:'ar', fallback:'en', dict },
      data:{
        activeTab: 'readmeBase',
        docs: DOCS,
        counter: 0,
        settingsOpen: false,
        themePrefs: { ...INITIAL_THEME_PREFS },
        designLab:{ open:false },
        logicGame:{
          challenge: null,
          options: [],
          selected: null,
          feedback: null
        },
        game:{
          musicOn: true,
          timerOn: true,
          timerSec: 35,
          timeLeft: 35,
          triesMax: 5,
          triesLeft: 5,
          audioList: [
            { name:'Ghost Stories', url:'https://www.fesliyanstudios.com/musicfiles/2020-10-26_-_Ghost_Stories_-_www.FesliyanStudios.com_Steve_Oxen/2020-10-26_-_Ghost_Stories_-_www.FesliyanStudios.com_Steve_Oxen.mp3' },
            { name:'The Unsolved Mystery', url:'https://www.fesliyanstudios.com/musicfiles/2018-07-22_-_The_Unsolved_Murder_-_David_Fesliyan.mp3' },
            { name:'Dark Shadows', url:'https://www.fesliyanstudios.com/musicfiles/2020-06-25_-_Dark_Shadows_-_www.FesliyanStudios.com_David_Fesliyan/2020-06-25_-_Dark_Shadows_-_www.FesliyanStudios.com_David_Fesliyan.mp3' }
          ],
          audioIdx: 0,
          proverb: null,
          guessed: {},
          intervalId: null,
          status: 'idle', // idle | running | won | lost
          revealSolution: false,
          soundStamp: 0,
          feedback: null
        }
      },
      ui:{ modalOpen:false, drawerOpen:false, toasts:[] }
    };

    // ----------------------------------------------------------------
    // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³ÙˆÙŠØ©: `setBody`
    // Ù‡Ù†Ø§ ÙŠØªÙ… Ø¯Ù…Ø¬ "Ø§Ù„Ø·ÙŠÙ†" (Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª) Ù…Ø¹ "Ø§Ù„Ø¹Ù„Ù… Ø§Ù„ÙØ·Ø±ÙŠ" (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
    // Ù„Ø¥Ù†ØªØ§Ø¬ "Ø¬Ø³Ø¯ Ù…ÙØµÙˆÙ‘ÙØ±" (Virtual DOM)ØŒ ÙˆÙ‡Ùˆ Ù…Ø®Ø·Ø· Ø¯Ù‚ÙŠÙ‚ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
    // Ù‚Ø¨Ù„ Ø£Ù† ØªØ¯Ø¨ ÙÙŠÙ‡ Ø§Ù„Ø­ÙŠØ§Ø©.
    // ----------------------------------------------------------------
    Mishkah.app.setBody(function(db, h){
      db.head = { title: makeLangLookup(db).TL('app.title') };
      applyThemePrefs(db.data?.themePrefs || INITIAL_THEME_PREFS);
      const overlays = [];
      const modalNode = SettingsModal(db);
      const designLabNode = DesignLabPanel(db);
      if (designLabNode) overlays.push(designLabNode);
      if (modalNode) overlays.push(modalNode);
      if (db.ui?.toasts && db.ui.toasts.length){ overlays.push(UI.ToastHost({ toasts: db.ui.toasts })); }
      return UI.AppRoot({
        shell: D.Containers.Div({ attrs:{ class: `${tw`flex flex-col`} app-shell` }}, [
          HeaderBar(db),
          D.Containers.Div({ attrs:{ class: `${tw`flex-1 w-full`} content-shell` }}, [
            D.Containers.Div({ attrs:{ class: `${tw`w-full mx-auto flex flex-col lg:flex-row gap-8 px-6 pb-12 max-w-[1600px]`}` }}, [
              D.Containers.Aside({ attrs:{ class: `${tw`hidden lg:flex lg:w-[280px] lg:flex-col`}` }}, [
                D.Containers.Div({ attrs:{ class: tw`sticky top-28` }}, [ Sidebar(db) ])
              ]),
              D.Containers.Main({ attrs:{ class: `${tw`flex-1 min-h-0`} main-region`, style:'max-height:100vh;' }}, [
                D.Containers.Div({ attrs:{ class: tw`lg:hidden mb-6` }}, [ Sidebar(db) ]),
                D.Containers.Div({ attrs:{ class: tw`space-y-8` }}, [ MainContent(db) ])
              ])
            ])
          ])
        ]),
        overlays
      });
    });


    // ================================================================
    // Ø§Ù„Ø²ÙˆØ¬ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„ØªÙ…ÙƒÙŠÙ† ÙˆØ§Ù„ØªÙƒÙ„ÙŠÙ (Ù†ÙØ® Ø§Ù„Ø±ÙˆØ­ ÙˆØ§Ù„Ø­ÙŠØ§Ø©)
    // Ù‡Ù†Ø§ Ù†Ù…Ù†Ø­ Ø§Ù„Ø¬Ø³Ø¯ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ù†Ù…Ùˆ.
    // ================================================================

    // ----------------------------------------------------------------
    // Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¥ÙŠÙ…Ø§Ù† (`database` as State)
    // Ù†ÙØ³ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª "DNA"ØŒ Ø£ØµØ¨Ø­Øª Ø§Ù„Ø¢Ù† "Ø§Ù„Ø±ÙˆØ­" Ø§Ù„Ø­ÙŠØ©ØŒ
    // ÙˆÙ‡ÙŠ Ù…ØµØ¯Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø£ÙˆØ­Ø¯ Ø§Ù„Ø°ÙŠ ÙŠÙ‡ØªØ¯ÙŠ Ø¨Ù‡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
    // ----------------------------------------------------------------
    // (Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù€ `database` Ù…Ø¹Ø±Ù Ù…Ø³Ø¨Ù‚Ù‹Ø§ØŒ Ù‡Ù†Ø§ ÙÙ‚Ø· Ù†ÙˆØ¶Ø­ Ø¯ÙˆØ±Ù‡ Ø§Ù„Ø¬Ø¯ÙŠØ¯)

    // ----------------------------------------------------------------
    // Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­ (`orders`)
    // Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø£ÙˆØ§Ù…Ø± ÙˆØ§Ù„Ø£ÙØ¹Ø§Ù„ Ø§Ù„ØªÙŠ ØªØ­Ø±Ùƒ Ø§Ù„Ø¬Ø³Ø¯ ÙˆØªØºÙŠØ± Ù…Ù† Ø­Ø§Ù„ "Ø¥ÙŠÙ…Ø§Ù†Ù‡".
    // ÙƒÙ„ "order" Ù‡Ùˆ Ø¹Ù…Ù„ ØµØ§Ù„Ø­ ÙŠØ³ØªØ¬ÙŠØ¨ Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙŠÙØ­Ø¯Ù‘Ø« Ø§Ù„Ø­Ø§Ù„Ø©.
    // ----------------------------------------------------------------
    const KEEP_MAIN_SCROLL = { keepScroll:['.main-region'] };

    const orders = {
      // Routing
      'route:readmeBase':{ on:['click'], gkeys:['route:readmeBase'], handler:(e,ctx)=>{ const s=ctx.getState(); ctx.setState({...s, data:{...s.data, activeTab:'readmeBase' }});  }},
      'route:readmeTec' :{ on:['click'], gkeys:['route:readmeTec' ], handler:(e,ctx)=>{ const s=ctx.getState(); ctx.setState({...s, data:{...s.data, activeTab:'readmeTec'  }});  }},
      'route:counter'   :{ on:['click'], gkeys:['route:counter'],   handler:(e,ctx)=>{ const s=ctx.getState(); ctx.setState({...s, data:{...s.data, activeTab:'counter'}});  }},
      'route:game'      :{ on:['click'], gkeys:['route:game'],      handler:(e,ctx)=>{ const s=ctx.getState(); ctx.setState({...s, data:{...s.data, activeTab:'game'   }});  }},
      'route:logic'     :{ on:['click'], gkeys:['route:logic'],     handler:(e,ctx)=>{ const s=ctx.getState(); let lg = s.data.logicGame || {}; if (!lg.challenge){ const created = generateLogicChallenge(); lg = { challenge: created, options: created.options, selected:null, feedback:null }; } else { lg = { ...lg }; } ctx.setState({...s, data:{...s.data, activeTab:'logic', logicGame: lg }});  }},

      // Settings modal & theme preferences
      'ui:settings:toggle':{ on:['change'], gkeys:['ui:settings:toggle'], handler:(e,ctx)=>{ const open = !!(e && e.target && e.target.checked); const s=ctx.getState(); ctx.setState({...s, data:{...s.data, settingsOpen: open }}); ctx.flush(KEEP_MAIN_SCROLL); }},
      'ui:settings:open'  :{ on:['click'], gkeys:['ui:settings:open'], handler:(e,ctx)=>{ const s=ctx.getState(); if (s.data.settingsOpen) return; ctx.setState({...s, data:{...s.data, settingsOpen:true }}); ctx.flush(KEEP_MAIN_SCROLL); }},
      'ui:settings:close' :{ on:['click'], gkeys:['ui:settings:close'], handler:(e,ctx)=>{ const s=ctx.getState(); if (!s.data.settingsOpen) return; ctx.setState({...s, data:{...s.data, settingsOpen:false }}); ctx.flush(KEEP_MAIN_SCROLL); }},
      'theme:sync'        :{ on:['click'], gkeys:['ui:theme-toggle'], handler:(e,ctx)=>{ const prefs = ctx.getState().data?.themePrefs || INITIAL_THEME_PREFS; setTimeout(()=> applyThemePrefs(prefs), 0); }},
      'prefs:background'  :{ on:['change'], gkeys:['prefs:background'], handler:(e,ctx)=>{ const value = e && e.target ? e.target.value : null; if (!value) return; const s=ctx.getState(); const current = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS); if (current.backgroundId === value) { applyThemePrefs(current); return; } const next = normalizeThemePrefs({ ...current, backgroundId: value }); persistThemePrefs(next); ctx.setState({...s, data:{...s.data, themePrefs: next }}); applyThemePrefs(next); ctx.flush(KEEP_MAIN_SCROLL); }},
      'prefs:text'        :{ on:['change'], gkeys:['prefs:text'], handler:(e,ctx)=>{ const value = e && e.target ? e.target.value : null; if (!value) return; const s=ctx.getState(); const current = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS); if (current.textSchemeId === value) { applyThemePrefs(current); return; } const next = normalizeThemePrefs({ ...current, textSchemeId: value }); persistThemePrefs(next); ctx.setState({...s, data:{...s.data, themePrefs: next }}); applyThemePrefs(next); ctx.flush(KEEP_MAIN_SCROLL); }},
      'prefs:fontScale'   :{ on:['input','change'], gkeys:['prefs:fontScale'], handler:(e,ctx)=>{ const raw = e && e.target ? parseInt(e.target.value,10) : null; if (raw==null || Number.isNaN(raw)) return; const scale = Math.min(120, Math.max(90, raw)); const s=ctx.getState(); const current = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS); if (current.fontScale === scale) { applyThemePrefs(current); return; } const next = { ...current, fontScale: scale }; persistThemePrefs(next); ctx.setState({...s, data:{...s.data, themePrefs: next }}); applyThemePrefs(next); ctx.flush(KEEP_MAIN_SCROLL); }},
      'prefs:reset'       :{ on:['click'], gkeys:['prefs:reset'], handler:(e,ctx)=>{ const s=ctx.getState(); const next = { ...THEME_DEFAULT_PREFS }; persistThemePrefs(next); ctx.setState({...s, data:{...s.data, themePrefs: next }}); applyThemePrefs(next); ctx.flush(KEEP_MAIN_SCROLL); }},
      'ui:theme:set'     :{ on:['click'], gkeys:['ui:theme:set'], handler:(e,ctx)=>{
        const target = e && e.target ? e.target.closest('[data-value]') : null;
        if (!target) return;
        const modeRaw = target.getAttribute('data-value');
        if (!modeRaw) return;
        const mode = modeRaw === 'dark' ? 'dark' : 'light';
        const s=ctx.getState();
        const prefs = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS);
        U.twcss.setTheme(mode === 'dark' ? 'dark' : 'light');
        ctx.setState({
          ...s,
          env:{ ...(s.env||{}), theme: mode },
          data:{ ...s.data, themePrefs: prefs }
        });
        applyThemePrefs(prefs);
        ctx.flush(KEEP_MAIN_SCROLL);
      }},
      'design:lab:open'   :{ on:['click'], gkeys:['design:lab:open'], handler:(e,ctx)=>{ const s=ctx.getState(); if (s.data.designLab?.open) return; ctx.setState({...s, data:{...s.data, designLab:{ ...(s.data.designLab||{}), open:true }}}); ctx.flush(KEEP_MAIN_SCROLL); }},
      'design:lab:close'  :{ on:['click'], gkeys:['design:lab:close'], handler:(e,ctx)=>{ const s=ctx.getState(); if (!s.data.designLab?.open) return; ctx.setState({...s, data:{...s.data, designLab:{ ...(s.data.designLab||{}), open:false }}}); ctx.flush(KEEP_MAIN_SCROLL); }},
      'design:theme'      :{ on:['click'], gkeys:['design:theme'], handler:(e,ctx)=>{ const btn=e && e.target ? e.target.closest('[data-mode]'):null; const mode=btn?btn.getAttribute('data-mode'):null; if(!mode) return; const s=ctx.getState(); const prefs = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS); let nextPrefs = prefs; if (mode==='pink'){ nextPrefs = normalizeThemePrefs({ ...prefs, backgroundId:'sunset', textSchemeId:'warm' }); U.twcss.setTheme('light'); } else { U.twcss.setTheme(mode==='dark'?'dark':'light'); }
        const envTheme = mode;
        persistThemePrefs(nextPrefs);
        ctx.setState({...s, env:{ ...(s.env||{}), theme: envTheme }, data:{...s.data, themePrefs: nextPrefs, designLab:{ ...(s.data.designLab||{}), open:true }}});
        applyThemePrefs(nextPrefs);
        ctx.flush(KEEP_MAIN_SCROLL);
      }},
      'design:var:update' :{ on:['input','change'], gkeys:['design:var:update'], handler:(e,ctx)=>{
        const target = e && e.target ? e.target : null; if (!target) return;
        const name = target.getAttribute('data-var'); if (!name) return;
        const def = DESIGN_VAR_DEF_MAP[name];
        if (def && def.prefKey) return;
        const editor = target.getAttribute('data-editor') || 'text';
        let value = target.value;
        if (editor==='range'){
          const unit = target.getAttribute('data-unit') || '';
          const num = parseFloat(value);
          if (Number.isNaN(num)) return;
          value = unit ? `${num}${unit}` : String(num);
        } else if (editor==='number'){
          const unit = target.getAttribute('data-unit') || '';
          let num = parseFloat(value);
          if (Number.isNaN(num)) return;
          if (def && typeof def.min === 'number') num = Math.max(def.min, num);
          if (def && typeof def.max === 'number') num = Math.min(def.max, num);
          const stepPrecision = def && def.step != null ? String(def.step).split('.')[1]?.length || 0 : 0;
          if (stepPrecision > 0) num = parseFloat(num.toFixed(stepPrecision));
          value = unit ? `${num}${unit}` : String(num);
        } else if (editor==='text'){
          value = typeof value==='string' ? value.trim() : '';
        } else if (editor==='color'){
          if (!value) return;
        }
        const s=ctx.getState();
        const prefs = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS);
        const customVars = { ...(prefs.customVars || {}) };
        if (editor==='text' && value==='') delete customVars[name]; else customVars[name] = value;
        const next = { ...prefs, customVars };
        persistThemePrefs(next);
        ctx.setState({...s, data:{...s.data, themePrefs: next }});
        applyThemePrefs(next);
        ctx.flush(KEEP_MAIN_SCROLL);
      }},
      'design:var:reset'  :{ on:['click'], gkeys:['design:var:reset'], handler:(e,ctx)=>{
        const btn = e && e.target ? e.target.closest('[data-var]') : null; const name = btn ? btn.getAttribute('data-var') : null; if(!name) return;
        const def = DESIGN_VAR_DEF_MAP[name];
        const s=ctx.getState();
        const prefs = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS);
        let next;
        if (def && def.prefKey==='fontScale') next = { ...prefs, fontScale: THEME_DEFAULT_PREFS.fontScale };
        else {
          const customVars = { ...(prefs.customVars || {}) };
          delete customVars[name];
          next = { ...prefs, customVars };
        }
        persistThemePrefs(next);
        ctx.setState({...s, data:{...s.data, themePrefs: next }});
        applyThemePrefs(next);
        ctx.flush(KEEP_MAIN_SCROLL);
      }},
      'design:var:resetAll':{ on:['click'], gkeys:['design:var:resetAll'], handler:(e,ctx)=>{
        const s=ctx.getState();
        const prefs = normalizeThemePrefs(s.data?.themePrefs || INITIAL_THEME_PREFS);
        const next = { ...prefs, customVars:{}, fontScale: THEME_DEFAULT_PREFS.fontScale };
        persistThemePrefs(next);
        ctx.setState({...s, data:{...s.data, themePrefs: next }});
        applyThemePrefs(next);
        ctx.flush(KEEP_MAIN_SCROLL);
      }},

      // Logic challenge
      'logic:start'       :{ on:['click'], gkeys:['logic:start'], handler:(e,ctx)=>{ const s=ctx.getState(); const challenge = generateLogicChallenge(); const next = { challenge, options: challenge.options, selected:null, feedback:null }; ctx.setState({...s, data:{...s.data, logicGame: next }}); ctx.flush(KEEP_MAIN_SCROLL); }},
      'logic:answer'      :{ on:['click'], gkeys:['logic:answer'], handler:(e,ctx)=>{ const target = e && e.target && e.target.closest ? e.target.closest('[data-choice]') : null; if (!target) return; const choice = parseInt(target.getAttribute('data-choice'),10); if (Number.isNaN(choice)) return; const s=ctx.getState(); const lg = s.data.logicGame || {}; const challenge = lg.challenge; if (!challenge) return; if (lg.feedback && lg.feedback.type==='correct') return; const feedbackType = choice === challenge.answer ? 'correct' : 'wrong'; const feedback = { type: feedbackType, stamp: Date.now() }; const next = { ...lg, selected: choice, feedback }; ctx.setState({...s, data:{...s.data, logicGame: next }}); ctx.flush(KEEP_MAIN_SCROLL); }},

      // Counter
      'counter:inc'  :{ on:['click'], gkeys:['counter:inc'],   handler:(e,ctx)=>{ const s=ctx.getState(); ctx.setState({...s, data:{...s.data, counter:s.data.counter+1 }});  }},
      'counter:dec'  :{ on:['click'], gkeys:['counter:dec'],   handler:(e,ctx)=>{ const s=ctx.getState(); ctx.setState({...s, data:{...s.data, counter:s.data.counter-1 }});  }},
      'counter:reset':{ on:['click'], gkeys:['counter:reset'], handler:(e,ctx)=>{ const s=ctx.getState(); ctx.setState({...s, data:{...s.data, counter:0 }});  }},

      // Game toggles
      'game:music:toggle':{ on:['change'], gkeys:['game:music:toggle'], handler:(e,ctx)=>{
        const s=ctx.getState(); const g=s.data.game; const on = !!e.target.checked;
        const stamp = on ? Date.now() : g.soundStamp;
        ctx.setState({...s, data:{...s.data, game:{...g, musicOn:on, soundStamp: stamp }}}); ctx.flush(KEEP_MAIN_SCROLL);
      }},
      'game:music:select':{ on:['change'], gkeys:['game:music:select'], handler:(e,ctx)=>{
        const s=ctx.getState(); const g=s.data.game; const idx=Math.max(0,parseInt(e.target.value,10)||0);
        ctx.setState({...s, data:{...s.data, game:{...g, audioIdx: idx, soundStamp: Date.now() }}}); ctx.flush(KEEP_MAIN_SCROLL);
      }},
      'game:timer:toggle':{ on:['change'], gkeys:['game:timer:toggle'], handler:(e,ctx)=>{
        const s=ctx.getState(); const g=s.data.game; const on=!!e.target.checked; if(!on && g.intervalId) try{ clearInterval(g.intervalId); }catch(_){ }
        const timeLeft = on ? (g.status==='running' ? (typeof g.timeLeft === 'number' && g.timeLeft>0 ? g.timeLeft : g.timerSec) : g.timerSec) : 0;
        ctx.setState({...s, data:{...s.data, game:{...g, timerOn:on, timeLeft, intervalId: on ? g.intervalId : null }}}); ctx.flush(KEEP_MAIN_SCROLL);
      }},
      'game:timer:value':{ on:['input','change'], gkeys:['game:timer:value'], handler:(e,ctx)=>{
        const s=ctx.getState(); const g=s.data.game; const v=Math.max(5, parseInt(e.target.value,10)||g.timerSec);
        const timeLeft = g.timerOn ? (g.status==='running' ? v : v) : g.timeLeft;
        ctx.setState({...s, data:{...s.data, game:{...g, timerSec: v, timeLeft }}}); ctx.flush(KEEP_MAIN_SCROLL);
      }},

      // Start / New game
      'game:start':{ on:['click'], gkeys:['game:start'], handler:(e,ctx)=>{
        const s0=ctx.getState(); const g0=s0.data.game; if (g0.intervalId) try{ clearInterval(g0.intervalId); }catch(_){}
        const pv = PROVERBS[Math.floor(Math.random()*PROVERBS.length)];
        const stamp = Date.now();
        const baseTime = g0.timerOn ? g0.timerSec : 0;
        const g1 = { ...g0, proverb: pv, guessed:{}, triesLeft:g0.triesMax, status:'running', timeLeft: baseTime, intervalId:null, revealSolution:false, soundStamp: stamp, feedback:null };
        ctx.setState({ ...s0, data:{ ...s0.data, game:g1 } }); ctx.flush(KEEP_MAIN_SCROLL);

        if (g1.timerOn) {
          const iid = setInterval(()=>{
            const s=ctx.getState(); const g=s.data.game; if (g.status!=='running') { clearInterval(iid); return; }
            let timeLeft = typeof g.timeLeft === 'number' ? g.timeLeft - 1 : g.timerSec - 1;
            let triesLeft = g.triesLeft;
            let status = g.status;
            let feedback = g.feedback;
            if (timeLeft <= 0) {
              triesLeft = Math.max(0, triesLeft - 1);
              if (triesLeft === 0) {
                status = 'lost';
                timeLeft = 0;
                if (g.intervalId) try{ clearInterval(g.intervalId); }catch(_){}
                clearInterval(iid);
                feedback = { type:'lose', stamp: Date.now() };
              } else {
                timeLeft = g.timerSec;
                feedback = { type:'wrong', stamp: Date.now() };
              }
            }
            ctx.setState({ ...s, data:{ ...s.data, game:{ ...g, timeLeft, triesLeft, status, feedback, revealSolution: status==='won' ? true : g.revealSolution } }}); ctx.flush(KEEP_MAIN_SCROLL);
          }, 1000);
          const s1=ctx.getState(); const g2=s1.data.game;
          ctx.setState({ ...s1, data:{ ...s1.data, game:{ ...g2, intervalId:iid }}}); ctx.flush(KEEP_MAIN_SCROLL);
        }
      }},

      // Guess
      'game:guess':{ on:['click'], gkeys:['game:guess'], handler:(e,ctx)=>{
        const btn = e.target.closest && e.target.closest('[data-ch]'); if (!btn) return;
        const L = btn.getAttribute('data-ch'); if (!L) return;
        const s=ctx.getState(); const g=s.data.game; if (g.status!=='running' || !g.proverb) return;

        const guessed = { ...g.guessed, [L]: true };
        const target = g.proverb.t;
        const has = target.split('').some(raw => norm(raw)===L);

        let triesLeft = g.triesLeft, status = g.status;
        if (!has) {
          triesLeft=Math.max(0, triesLeft-1);
          if (triesLeft===0){ status='lost'; if (g.intervalId) try{ clearInterval(g.intervalId); }catch(_){ } }
        }
        else {
          const letters = new Set(target.split('').map(norm).filter(x=>x.trim()!=='' && x!==' '));
          const all = Array.from(letters).every(k => guessed[k]); if (all){ status='won'; if (g.intervalId) try{ clearInterval(g.intervalId); }catch(_){ } }
        }

        const timeLeft = g.timerOn ? (status==='lost' ? 0 : (typeof g.timeLeft === 'number' ? g.timeLeft : g.timerSec)) : 0;
        let feedbackType = has ? 'correct' : 'wrong';
        if (status==='won') feedbackType = 'win';
        if (status==='lost') feedbackType = 'lose';
        const feedback = feedbackType ? { type: feedbackType, stamp: Date.now() } : null;
        ctx.setState({ ...s, data:{ ...s.data, game:{ ...g, guessed, triesLeft, status,
          timeLeft,
          revealSolution: status==='won' ? true : g.revealSolution,
          feedback
        }}});
        ctx.flush(KEEP_MAIN_SCROLL);
        if (status === 'won'){
          U.Control.nextTick(()=>{
            U.DOM.focusById('game-solution-card');
            U.DOM.flashClass('game-solution-card', 'focus-pulse', 2200);
          });
        }
      }},
      'game:reveal':{ on:['click'], gkeys:['game:reveal'], handler:(e,ctx)=>{
        const s=ctx.getState(); const g=s.data.game; if (!g.proverb) return;
        ctx.setState({ ...s, data:{ ...s.data, game:{ ...g, revealSolution:true }}});
        ctx.flush(KEEP_MAIN_SCROLL);
        U.Control.nextTick(()=>{
          U.DOM.focusById('game-solution-card');
          U.DOM.flashClass('game-solution-card', 'focus-pulse', 2200);
        });
      }}
    };

    // ----------------------------------------------------------------
    // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø®Ù„Ù‚: `createApp`
    // Ù‡Ù†Ø§ ÙŠØªÙ… Ø¯Ù…Ø¬ "Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†" (database) Ù…Ø¹ "Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµØ§Ù„Ø­" (orders)
    // Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­ÙŠ (`app`) Ø§Ù„Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ù†Ù…Ùˆ.
    // ----------------------------------------------------------------
    const app = Mishkah.app.createApp(database, orders);

    
    // ================================================================
    // Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø¨Ø¹Ø«
    // ================================================================

    // ----------------------------------------------------------------
    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Auto)
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø­ÙŠØ·Ø©: Ø§Ù„Ø®Ø·ÙˆØ·ØŒ Ø§Ù„Ø«ÙŠÙ…Ø§ØªØŒ Ø§Ù„Ù„ØºØ§ØªØŒ ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.
    // ----------------------------------------------------------------
    const twx = U.twcss.auto(database, app);

    // ----------------------------------------------------------------
    // Ø¯Ù…Ø¬ ÙƒÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (setOrders)
    // Ù†Ø¬Ù…Ø¹ Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø§ØµØ© + Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© + Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙŠØ¦Ø©.
    // ----------------------------------------------------------------
    app.setOrders({ ...orders, ...UI.orders, ...twx.orders });

    // ----------------------------------------------------------------
    // Ø§Ù„Ø¨Ø¹Ø« (Mount)
    // Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„ØªÙŠ ÙŠØ¸Ù‡Ø± ÙÙŠÙ‡Ø§ Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ø­ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø§Ù„Ù… (DOM)ØŒ
    // Ù„ÙŠØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙ‡ ÙÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….
    // ----------------------------------------------------------------
    app.mount('#app');

  })();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø´ÙƒØ§Ø© â€” Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ø¨Ø® (KDS)</title>
  <style>
    :root {
      color-scheme: dark;
      font-family: "Tajawal", "Cairo", system-ui, sans-serif;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #1e2433 0%, #0f1115 55%);
      color: #f8fafc;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 1.25rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(15, 17, 21, 0.8);
      backdrop-filter: blur(18px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
    }
    header h1 {
      margin: 0;
      font-size: clamp(1.5rem, 2vw + 1rem, 2.4rem);
      font-weight: 800;
      letter-spacing: 0.03em;
    }
    header .meta {
      display: flex;
      gap: 1rem;
      font-size: 0.95rem;
      color: rgba(226, 232, 240, 0.85);
    }
    main {
      flex: 1;
      padding: 1.5rem;
    }
    .board {
      display: grid;
      gap: 1.25rem;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      align-items: start;
    }
    .column {
      background: rgba(17, 24, 39, 0.92);
      border-radius: 20px;
      padding: 1.25rem;
      box-shadow: 0 20px 45px rgba(15, 23, 42, 0.45);
      display: flex;
      flex-direction: column;
      min-height: 60vh;
    }
    .column h2 {
      margin: 0 0 0.75rem;
      font-size: 1.15rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      color: #e2e8f0;
    }
    .ticket {
      background: rgba(30, 41, 59, 0.75);
      border-radius: 16px;
      padding: 1rem;
      margin-bottom: 0.9rem;
      display: flex;
      flex-direction: column;
      gap: 0.65rem;
      border: 1px solid transparent;
      transition: border-color 0.2s ease;
    }
    .ticket:hover {
      border-color: rgba(148, 163, 184, 0.35);
    }
    .ticket-header {
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      align-items: center;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge.order {
      background: rgba(59, 130, 246, 0.15);
      color: #93c5fd;
    }
    .badge.timer {
      background: rgba(74, 222, 128, 0.12);
      color: #86efac;
    }
    .badge.alert {
      background: rgba(248, 113, 113, 0.15);
      color: #fca5a5;
    }
    .items {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .item-line {
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      font-size: 0.95rem;
    }
    .item-line span:first-child {
      font-weight: 600;
    }
    .notes {
      font-size: 0.8rem;
      color: rgba(226, 232, 240, 0.7);
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .summary-card {
      background: rgba(15, 23, 42, 0.6);
      border-radius: 18px;
      padding: 1.1rem;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      border: 1px solid rgba(51, 65, 85, 0.45);
    }
    .progress {
      height: 6px;
      background: rgba(148, 163, 184, 0.18);
      border-radius: 999px;
      overflow: hidden;
    }
    .progress > div {
      height: 100%;
      background: linear-gradient(90deg, #22d3ee, #60a5fa);
    }
    footer {
      padding: 0.75rem 1.5rem;
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: rgba(148, 163, 184, 0.75);
    }
    @media (max-width: 768px) {
      header, main, footer {
        padding-inline: 1rem;
      }
      .column {
        min-height: auto;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Ù…Ø´ÙƒØ§Ø© â€” Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ø¨Ø®</h1>
    <div class="meta">
      <span>ğŸŸ¢ Ø§Ù„Ù…Ø·Ø¨Ø® Ù…ØªØµÙ„</span>
      <span id="clock">--:--</span>
      <span>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <strong id="ticket-count">0</strong></span>
    </div>
  </header>
  <main>
    <section id="board" class="board"></section>
  </main>
  <footer>
    <span>ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©</span>
    <span>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø­Ø±Ø§Ø±ÙŠ â€” 80Ù…Ù…</span>
  </footer>
  <script src="./pos-mock-data.js"></script>
  <script>
    (function(){
      const db = window.database || {};
      const items = db.items || [];
      const itemIndex = Object.fromEntries(items.map(it => [String(it.id), it]));

      const STATION_FOR_CATEGORY = {
        appetizers: 'cold',
        sandwiches: 'sandwiches',
        hawawshi: 'grill',
        combo_meals: 'pass',
        kilo_grills: 'grill',
        side_items: 'pass'
      };

      const STATIONS = [
        { id: 'cold', label: 'Ø§Ù„Ø¨Ø§Ø±Ø¯ ÙˆØ§Ù„Ø³Ù„Ø·Ø§Øª', icon: 'ğŸ¥—' },
        { id: 'sandwiches', label: 'Ù‚Ø³Ù… Ø§Ù„Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª', icon: 'ğŸ¥™' },
        { id: 'grill', label: 'Ù‚Ø³Ù… Ø§Ù„Ù…Ø´ÙˆÙŠØ§Øª', icon: 'ğŸ”¥' },
        { id: 'pass', label: 'Ø§Ù„ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', icon: 'ğŸ§¾' },
        { id: 'summary', label: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª', icon: 'ğŸ“‹' }
      ];

      const sampleOrders = [
        {
          id: 'ORD-1201',
          type: 'dine_in',
          table: 'T5',
          source: 'ØµØ§Ù„Ø©',
          status: 'preparing',
          eta: '05 Ø¯Ù‚Ø§Ø¦Ù‚',
          stationProgress: { cold: 'ready', sandwiches: 'prepping', grill: 'queued', pass: 'queued' },
          items: [
            { itemId: 10, qty: 2 },
            { itemId: 6, qty: 1 },
            { itemId: 26, qty: 1 }
          ],
          notes: 'Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„'
        },
        {
          id: 'ORD-1202',
          type: 'delivery',
          table: null,
          source: 'Ø¯Ù„ÙŠÙØ±ÙŠ',
          status: 'cooking',
          eta: '08 Ø¯Ù‚Ø§Ø¦Ù‚',
          stationProgress: { cold: 'prepping', sandwiches: 'queued', grill: 'ready', pass: 'prepping' },
          items: [
            { itemId: 1, qty: 3 },
            { itemId: 14, qty: 1 },
            { itemId: 25, qty: 1 }
          ],
          notes: 'Ø§ØªØµØ§Ù„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…'
        },
        {
          id: 'ORD-1203',
          type: 'dine_in',
          table: 'T12',
          source: 'ØµØ§Ù„Ø©',
          status: 'expedite',
          eta: 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…',
          stationProgress: { cold: 'ready', sandwiches: 'ready', grill: 'prepping', pass: 'ready' },
          items: [
            { itemId: 24, qty: 1 },
            { itemId: 2, qty: 2 },
            { itemId: 27, qty: 2 }
          ],
          notes: 'ØªÙ‚Ø¯ÙŠÙ… Ø³Ø±ÙŠØ¹ Ù„Ù„Ø²Ø¨ÙˆÙ† Ø§Ù„Ø¯Ø§Ø¦Ù…'
        }
      ];

      function resolveItemName(itemId){
        const item = itemIndex[String(itemId)];
        if(!item) return `ØµÙ†Ù #${itemId}`;
        return item.translations?.ar?.name || item.translations?.en?.name || `ØµÙ†Ù #${itemId}`;
      }

      const stationBuckets = Object.fromEntries(STATIONS.map(st => [st.id, []]));

      sampleOrders.forEach(order => {
        const grouped = {};
        (order.items || []).forEach(line => {
          const item = itemIndex[String(line.itemId)];
          if(!item) return;
          const station = STATION_FOR_CATEGORY[item.category] || 'pass';
          if(!grouped[station]) grouped[station] = [];
          grouped[station].push({
            name: resolveItemName(line.itemId),
            qty: line.qty || 1,
            category: item.category
          });
        });
        Object.keys(grouped).forEach(station => {
          stationBuckets[station].push({
            orderId: order.id,
            table: order.table,
            source: order.source,
            status: order.stationProgress?.[station] || 'queued',
            eta: order.eta,
            items: grouped[station],
            notes: order.notes
          });
        });
        stationBuckets.summary.push(order);
      });

      const statusMeta = {
        queued: { text: 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', className: 'badge order' },
        prepping: { text: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', className: 'badge timer' },
        cooking: { text: 'ÙŠÙØ·Ù‡Ù‰', className: 'badge timer' },
        ready: { text: 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…', className: 'badge alert' }
      };

      function createTicket(job){
        const article = document.createElement('article');
        article.className = 'ticket';

        const header = document.createElement('div');
        header.className = 'ticket-header';

        const orderBadge = document.createElement('span');
        orderBadge.className = 'badge order';
        orderBadge.textContent = `Ø·Ù„Ø¨ ${job.orderId}`;

        const statusBadge = document.createElement('span');
        const meta = statusMeta[job.status] || statusMeta.queued;
        statusBadge.className = meta.className;
        statusBadge.textContent = meta.text;

        header.append(orderBadge, statusBadge);
        article.append(header);

        if(job.table){
          const tableBadge = document.createElement('span');
          tableBadge.className = 'badge timer';
          tableBadge.textContent = `Ø·Ø§ÙˆÙ„Ø© ${job.table}`;
          article.append(tableBadge);
        }

        const list = document.createElement('div');
        list.className = 'items';
        job.items.forEach(line => {
          const row = document.createElement('div');
          row.className = 'item-line';
          const name = document.createElement('span');
          name.textContent = `${line.qty}Ã— ${line.name}`;
          const cat = document.createElement('span');
          cat.style.color = 'rgba(148, 163, 184, 0.75)';
          cat.textContent = line.category;
          row.append(name, cat);
          list.append(row);
        });
        article.append(list);

        if(job.notes){
          const notes = document.createElement('div');
          notes.className = 'notes';
          notes.innerHTML = `ğŸ“ ${job.notes}`;
          article.append(notes);
        }

        if(job.eta){
          const etaBadge = document.createElement('span');
          etaBadge.className = 'badge timer';
          etaBadge.textContent = job.eta;
          article.append(etaBadge);
        }

        return article;
      }

      function createSummaryCard(order){
        const card = document.createElement('article');
        card.className = 'summary-card';

        const head = document.createElement('div');
        head.className = 'ticket-header';
        const title = document.createElement('strong');
        title.textContent = `Ø·Ù„Ø¨ ${order.id}`;
        const type = document.createElement('span');
        type.className = 'badge order';
        type.textContent = order.source;
        head.append(title, type);
        card.append(head);

        if(order.table){
          const table = document.createElement('div');
          table.className = 'notes';
          table.textContent = `ğŸª‘ Ø·Ø§ÙˆÙ„Ø© ${order.table}`;
          card.append(table);
        }

        const itemsList = document.createElement('div');
        itemsList.className = 'items';
        order.items.forEach(line => {
          const row = document.createElement('div');
          row.className = 'item-line';
          row.innerHTML = `<span>${line.qty}Ã— ${resolveItemName(line.itemId)}</span>`;
          itemsList.append(row);
        });
        card.append(itemsList);

        if(order.notes){
          const note = document.createElement('div');
          note.className = 'notes';
          note.textContent = `ğŸ“ ${order.notes}`;
          card.append(note);
        }

        const progress = document.createElement('div');
        progress.className = 'progress';
        const progressFill = document.createElement('div');
        const readyStations = Object.values(order.stationProgress || {}).filter(v => v === 'ready').length;
        const completion = Math.round((readyStations / 4) * 100);
        progressFill.style.width = `${completion}%`;
        progress.append(progressFill);
        card.append(progress);

        const footer = document.createElement('div');
        footer.className = 'notes';
        footer.textContent = `ğŸ”„ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨: ${order.status === 'expedite' ? 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ…' : 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'} â€” Ø¥Ù†Ø¬Ø§Ø² ${completion}%`;
        card.append(footer);

        return card;
      }

      const board = document.getElementById('board');
      STATIONS.forEach(station => {
        const column = document.createElement('section');
        column.className = 'column';

        const heading = document.createElement('h2');
        heading.textContent = `${station.icon} ${station.label}`;
        column.append(heading);

        const jobs = stationBuckets[station.id] || [];
        if(station.id === 'summary'){
          jobs.forEach(order => column.append(createSummaryCard(order)));
        } else if(jobs.length){
          jobs.forEach(job => column.append(createTicket(job)));
        } else {
          const empty = document.createElement('p');
          empty.style.color = 'rgba(148, 163, 184, 0.55)';
          empty.style.marginTop = '1rem';
          empty.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠÙ‹Ø§.';
          column.append(empty);
        }

        board.append(column);
      });

      document.getElementById('ticket-count').textContent = stationBuckets.summary.length;

      function updateClock(){
        const now = new Date();
        document.getElementById('clock').textContent = now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
      }
      updateClock();
      setInterval(updateClock, 60000);
    })();
  </script>
</body>
</html>

<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hello â€” Mishkah</title>
  </head>
  <body>
    <div id="app"></div>

    <!-- Core libs (utils first for twcss + i18n helpers, then core) -->
    <script src="./mishkah-utils.js"></script>
    <script src="./mishkah.core.js"></script>

    <script>
  
        const M = window.Mishkah;

        // 1) DNA â€” database: env + i18n + data
        const database = {
          head: { title: 'Hello â€” Mishkah' },
          env: { theme: 'light', lang: 'ar', dir: 'rtl' },
          i18n: {
            lang: 'ar',
            fallback: 'en',
            dict: {
              hello: { ar: 'Ù…Ø±Ø­Ø¨Ù‹Ø§ ÙŠØ§ Ù…Ø´ÙƒØ§Ø© âœ¨', en: 'Hello, Mishkah âœ¨' },
              countLabel: { ar: 'Ø§Ù„Ø¹Ø¯Ø§Ø¯', en: 'Count' },
              inc: { ar: 'Ø²ÙŠÙ‘Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯', en: 'Increment' },
                            dec: { ar: 'Ù‚Ù„Ù„ Ø§Ù„Ø¹Ø¯Ø§Ø¯', en: 'decrased' }

            }
          },
          data: { counter: 0 }
        };

        // 2) ØªØµÙˆÙŠØ± ÙˆØªØ³ÙˆÙŠØ© â€” Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ VDOM Ø¹Ø¨Ø± DSL Ø§Ù„Ø°Ø±Ù‘ÙŠØ©
        M.app.setBody(function (db, D) {
          return D.Containers.Main({ attrs: { class: 'min-h-screen grid place-items-center p-6' } }, [
            D.Containers.Section({ attrs: { class: 'rounded-3xl border p-6 w-full max-w-md text-center space-y-4 bg-[var(--card)] text-[var(--card-foreground)] shadow-sm' } }, [
              // Ù†Øµ Ø¨Ø¯ÙˆÙ† Ø£Ø¨Ù†Ø§Ø¡ + t â‡’ ÙŠÙØªØ±Ø¬Ù… Ø¢Ù„ÙŠÙ‹Ø§ Ø­Ø³Ø¨ db.i18n
              D.Text.H1({ attrs: { t: 'hello', class: 'text-2xl font-bold' } }),

              // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø§Ø¯
              D.Text.P({ attrs: { class: 'text-sm opacity-80' } }, [
                D.Text.Span({ attrs: { t: 'countLabel' } }),
                D.Text.Span({}, [': ']),
                D.Text.Strong({}, [String(db.data?.counter || 0)])
              ]),

              // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙØ¹Ø§Ù„ (gkey ÙŠØ±Ø¨Ø· Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„Ø£ÙˆØ§Ù…Ø±)
              D.Containers.Div({ attrs: { class: 'flex flex-wrap items-center justify-center gap-2 pt-1' } }, [
                D.Forms.Button({
                  attrs: {
                    type: 'button',
                    gkey: 'counter:inc',
                    class: 'px-4 py-2 rounded-xl border bg-[var(--primary)] text-[var(--primary-foreground)]'
                  }
                }, [D.Text.Span({ attrs: { t: 'inc' } })]),
                
                                D.Forms.Button({
                  attrs: {
                    type: 'button',
                    gkey: 'counter:dec',
                    class: 'px-4 py-2 rounded-xl border bg-[var(--primary)] text-[var(--primary-foreground)]'
                  }
                }, [D.Text.Span({ attrs: { t: 'dec' } })]),

                // Ø£ÙˆØ§Ù…Ø± Ù„ØºØ©/Ø«ÙŠÙ… Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† auto()
                D.Forms.Button({ attrs: { type: 'button', gkey: 'ui:lang-ar', class: 'px-3 py-2 rounded-xl border' } }, ['AR']),
                D.Forms.Button({ attrs: { type: 'button', gkey: 'ui:lang-en', class: 'px-3 py-2 rounded-xl border' } }, ['EN']),
                D.Forms.Button({ attrs: { type: 'button', gkey: 'ui:theme-toggle', class: 'px-3 py-2 rounded-xl border' } }, ['ðŸŒ“'])
              ])
            ])
          ]);
        });

        // 3) Ø§Ù„Ø£ÙˆØ§Ù…Ø± â€” Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­ÙŠ
        const orders = {
          'counter.inc': {
            on: ['click'],
            gkeys: ['counter:inc'],
            handler: (event, context) => {
              const current = context.getState();
              context.setState((s) => ({
                ...s,
                data: { ...(s.data || {}), counter: (s.data?.counter || 0) + 1 }
              }));
            }
          },
          'counter.dec': {
            on: ['click'],
            gkeys: ['counter:dec'],
            handler: (event, context) => {
              const current = context.getState();
              context.setState((s) => ({
                ...s,
                data: { ...(s.data || {}), counter: (s.data?.counter || 0)- 1 }
              }));
            }
          }
        };

        // 4) Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„Ø¨Ø¹Ø« â€” createApp + auto + mount
        const app = M.app.createApp(database, orders);
        const twx = M.utils.twcss.auto(database, app); // Ø«ÙŠÙ…/Ù„ØºØ© + Tailwind CDN + Ø£ÙˆØ§Ù…Ø± Ø¨ÙŠØ¦ÙŠØ©
        app.setOrders(Object.assign({}, orders, twx.orders));
        app.mount('#app');
     
    </script>
  </body>
</html>

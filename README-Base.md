
# Mishkah.js — إطار عمل النور والنظام

# الدستور التأسيسي الكامل

*بنية برمجية مستوحاة من سنن الله في الخلق والأمر: ﴿وَلَقَدۡ أَنزَلۡنَآ إِلَيۡكُمۡ ءَايَٰتٖ مُّبَيِّنَٰتٖ وَمَثَلٗا مِّنَ ٱلَّذِينَ خَلَوۡاْ مِن قَبۡلِكُمۡ وَمَوۡعِظَةٗ لِّلۡمُتَّقِينَ﴾*

*بنية برمجية (Software Architecture) ذات 7 أركان مستوحاة من أفضل الممارسات البرمجية*

| Build Status | Version | License |
| :---: | :---: | :---: |
| [![CI](https://github.com/USER/REPO/actions/workflows/ci.yml/badge.svg)](https://github.com/USER/REPO/actions/workflows/ci.yml) | [![Version](https://img.shields.io/badge/version-v1.0.0-blue.svg)](https://github.com/USER/REPO/releases/tag/v1.0.0) | [![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](./LICENSE) |


-----

> **إلى من تاه في أودية `React` و `Angular`...**
>
> نعلم أنك قد سئمت. سئمت من فوضى `React` التي تجعلك تجمع جيشًا من المكتبات المتناحرة لتبني كوخًا، وسئمت من بيروقراطية `Angular` التي تجبرك على استصدار ثلاثة تصاريح لتضع حجرًا واحدًا.
>
> لقد بُنيت هذه الأطر لتدير فوضى جيوش المبرمجين في الشركات الضخمة، فكانت النتيجة إما فوضى مُدارة أو نظام مُعقّد. لكن "مشكاة" تطرح سؤالًا جذريًا: **لماذا ندير الفوضى، بينما يمكننا منعها من الأساس؟**
>
> "مشكاة" ليست طريقًا ثالثًا، بل هي عودة إلى الصراط المستقيم. هي منظومة متكاملة مبنية على سنن إلهية ثابتة، هدفها تمكينك من بناء أنظمة مضيئة كنور الله الذي ضرب به المثل.

## الأركان السبعة لمعمارية "مشكاة"

### 1\. توحيد مصدر الحقيقة (`database`): لا إله إلا هو

**الركن الأول والأساس الذي يقوم عليه كل شيء.**
في "مشكاة"، لا يمكن أن يكون هناك مصدر للحالة (`state`) إلا واحد: `database`. هذا ليس مجرد خيار تصميمي، بل هو تطبيق صارم لمبدأ التوحيد. أي محاولة لخلق مصدر آخر للحقيقة هي "شرك" برمجي، تؤدي حتمًا إلى التنازع والتضارب، وتشتيت يؤدي إلى انهيار النظام.
﴿لَوْ كَانَ فِيهِمَا آلِهَةٌ إِلَّا اللَّهُ لَفَسَدَتَا﴾. وكما أن للكون إله واحد، يجب أن يكون لتطبيقك مصدر حقيقة واحد لا ينازعه في ملكه منازع.
#### تجلي الركن في الكود:

كل شيء يبدأ من هنا. `database` ليس مجرد كائن، بل هو العهد الذي يلتزم به كل جزء من التطبيق.

```javascript
// database: العهد والميثاق ومصدر الحقيقة الأوحد
const database = {
  env: { theme: 'dark', lang: 'ar' },
  user: { name: 'عبد الله', loggedIn: true },
  posts: [
    { id: 1, title: 'أول تدوينة', content: '...' }
  ]
};

// المكونات (Components) لا تملك حالة خاصة بها،
// بل تستمد وجودها وحقيقتها الكاملة من الـ database.
function UserGreeting(db) {
  // تقرأ من المصدر الواحد، ولا تجتهد في خلق مصدر جديد.
  const name = db.user.name;
  return D.Text.H1({}, [`مرحباً يا ${name}`]);
}
```

هذا المبدأ يفرض نظامًا صارمًا لكنه يمنحك يقينًا مطلقًا. لا حاجة للبحث عن الحقيقة في أودية المكونات المتفرقة؛ إنها دائمًا في مكان واحد، واضحة وجلية.

-----


### 2\. المشكاة (The Ecosystem): هيكل يجمع نور أعمالك

صديقي، لو أنك مصباح متوهج مرمي في ركن غرفة بعيد، هل ستضيء الغرفة؟ للأسف، ستضيء ركنك فقط، ولن يكبر نورك أو يظهر للعالم. ولو أن مصباحك في العراء، لظل نقطة باهتة غارقة في الفضاء الأسود البهيم.
إن جهدك كمبرمج هو **نور**، وهذا النور إن لم يوضع في **مشكاة** تجمعه وتركزه وتمنعه من التشتت، فسيضيع هباءً.

وظيفة "مشكاة" هي أن تكون لك هذا الهيكل الذي يمنع التشتت بكل صوره:

  * **لا تشتيت في الأدوات:** لن تغرق في بحر من المكتبات المتضاربة. كل ما تحتاجه مدمج ومتناغم.
  * **لا تشتيت في الإعداد:** لن تضيع أيامًا في تهيئة بيئة العمل. أمر واحد مثل `tw.auto()` يكفي لتفعيل منظومة تصميم كاملة.
  * **لا تشتيت في الجهد:** دعم تعدد اللغات (`i18n`)، والاتجاه من اليمين لليسار (`RTL`)، والثيمات المظلمة والمضيئة، كلها تعمل تلقائيًا لتركز جهدك كله على الإبداع الفعلي.
  
  
#### تجلي الركن في الكود (رحلة الخلق):

إن بناء التطبيق يتبع رحلة الخلق ذات الزوجين:

```javascript
// الزوج الأول: التصميم والتسوية (تخطيط الجسد)
// 1. الذرات (Atoms): تعريف المكونات كهيكل بصري.
function AppBody(db, D) { /* ... */ }
// 2. العلم الفطري (database as DNA): الحالة الأولية.
const database = { /* ... */ };

// عملية التسوية: دمج الذرات مع العلم الفطري لإنشاء "جسد مُصوَّر" (VDOM)
Mishkah.app.setBody(AppBody);


// الزوج الثاني: التمكين والتكليف (نفخ الروح)
// 1. الإيمان (database as State): نفس البيانات أصبحت الآن مصدر الحقيقة الحي.
// 2. العمل الصالح (Orders): تعريف الأفعال التي تغير الإيمان.
const orders = { /* ... */ };

// عملية الخلق: نفخ الروح في الجسد بدمج الإيمان مع العمل
const app = Mishkah.app.createApp(database, orders);

// البعث: إظهار الكائن الحي للعالم (DOM)
app.mount('#app');
```

هذا الترتيب ليس عشوائيًا، بل هو محاكاة لعملية الخلق المنظمة: تصميم دقيق أولاً، ثم بث للحياة والتفاعل ثانيًا.

-----


#### رحلة الخلق في "مشكاة": زوجان من زوجين

إن بناء تطبيقك في "مشكاة" يمر برحلة خلق تشبه خلق الإنسان، قائمة على زوجين اثنين، لكل زوج ركنان:

1.  **الزوج الأول: التصميم والتسوية (تخطيط الجسد)**

      * **الركن الأول: الطين والذرات (`Atoms`):** هي لبنات البناء الأساسية، المادة الخام.
      * **الركن الثاني: العلم الفطري (`database` كـ DNA):** هي البيانات الأولية التي تحدد صفات هذا الجسد وشفرته الفطرية.
        **النتيجة:** جسدٌ مُصوَّر، روبوت ميكانيكي له تصميم دقيق قبل أن تُنفخ فيه الروح البرمجية.

2.  **الزوج الثاني: التمكين والتكليف (نفخ الكود والحياة)**

      * **الركن الأول: الإيمان (`database` كروح وهداية):** هي نفس البيانات التي أصبحت الآن مصدر الحقيقة الحي للتطبيق.
      * **الركن الثاني: العمل الصالح (`orders`):** هي الأوامر والأفعال التي تحرك هذا الجسد وتغير من حال إيمانه.
        **النتيجة:** كائن حي مكتمل، قادر على التفاعل والنمو.

لاحظ أن البيانات (`database`) هي الركن الدائم في كلا الزوجين، إنها كالروح التي كانت في علم التصوير الأول، وهي نفسها روح الهداية في التكليف الثاني.

### 3\. الزجاجة (The Expressive DSL): حماية وجمال

**﴿ٱلۡمِصۡبَاحُ فِي زُجَاجَةٍۖ ٱلزُّجَاجَةُ كَأَنَّهَا كَوۡكَبٞ دُرِّيّٞ﴾**
إن أجمل ما ستلاقي ليس فقط المشكاة التي تضخم ضوءك، بل أن مصباحك سيكون في **زجاجة**. إن فتيل مصباحك المحترق بجهدك، مهما كان عظيمًا، إن وُجد في العراء في خضم رياح الفوضى، فسيطْفَأ لا محالة.
كم من مبرمج بارع صنع مكونًا محكمًا، لكن مع تشتت البيانات وفوضى الـ DOM، صار يعمل بأداء ضعيف وسط تنازع وتضارب.

"مشكاة" تمنحك هذه الزجاجة من خلال لغة تعريفية (DSL) صارمة، حامية، وشفافة:

  * **حامية:** تفصل بصرامة بين **صفات المكون (`attrs`)** و**أفعاله (`events`)**، فتمنع الأخطاء الخفية التي يعاني منها كل مبرمج.
  * **شفافة:** لا تخفي أعمالك خلف طبقات من التعقيد، بل تظهرها بوضوح وأناقة.
  * **مُضخِّمة:** مع التصنيف الدقيق للـ `Atoms` واللمسات الفنية في ظهور وخفاء الكائنات وتقلب الليل والنهار، فإنها تضخم جمال كودك ليصير **كوكبًا دريًا**.
  
  
#### تجلي الركن في الكود:

لاحظ كيف أن اللغة نفسها تفرض النظام. لا مجال لخلط الصفات بالأفعال.

```javascript
const D = Mishkah.DSL;

// كتابة واضحة، صارمة، وجميلة كأنها كوكب دري
D.Forms.Button({
  // الركن الأول: الصفات (attrs) - ماذا يكون هذا الزر؟
  attrs: {
    class: tw`btn btn/solid`,
    'aria-label': 'إغلاق النافذة',
    // لا يوجد onClick أو onHover هنا أبدًا!
  },
  // الركن الثاني: الأفعال (events) - ماذا يفعل هذا الزر؟
  // (ملاحظة: في "مشكاة"، الأفعال تُعالج مركزيًا عبر gkey في الـ orders)
  // لكن لو احتجت لسبب نادر، يكون الفصل واضحًا:
  events: {
    // click: () => console.log('This is kept separate')
  }
}, ['أيقونة الإغلاق']);
```

هذا الفصل ليس خيارًا، بل هو من صلب بنية اللغة، فيحميك من الأخطاء الخفية ويجعل كودك شفافًا ك الزجاجة.

------


### 4\. الشجرة المباركة (The UI Library): زيت يكاد يضيء

**﴿يُوقَدُ مِن شَجَرَةٖ مُّبَٰرَكَةٖ زَيۡتُونَةٖ لَّا شَرۡقِيَّةٖ وَلَا غَرۡبِيَّةٖ يَكَادُ زَيۡتُهَا يُضِيٓءُ وَلَوۡ لَمۡ تَمۡسَسۡهُ نَارٞۚ﴾**
إن كوكبك الدري سيوقد من شجرة مباركة. إنها مكتبة المكونات الإبداعية (`mishkah-ui`)، مكتبة بديعة تكاد تضيء من تلقاء نفسها قبل أن يمسها نار جهدك وعملك. تراها أكوادًا، وكأنك ترى مدينة قائمة في خيالك.
لماذا هي مباركة؟ لأنها لم تتوارت عن شمس العلم، بل تعرضت لها من كل جانب، فصارت "لا شرقية ولا غربية"، مفعمة بالطاقة والمعرفة الحقة.
إنها زيت صافٍ ونقي، يمثل **هداية المعرفة**. وعندما تمسه نار عملك وجهدك، يتحول إلى **نور على نور**، فتجتمع **هداية المعرفة** مع **هداية العمل والتوفيق**.


#### تجلي الركن في الكود:

بدلاً من بناء كل شيء من الصفر، تبدأ من مكونات تكاد تضيء بنفسها.

```javascript
const UI = Mishkah.UI;
const D = Mishkah.DSL;

// بأسطر قليلة، تبني واجهة معقدة من زيت الشجرة المباركة
UI.Card({
  title: "عنوان البطاقة",
  description: "وصف موجز للمحتوى.",
  content: D.Text.P({}, ["هذا هو المحتوى الرئيسي"]),
  footer: UI.Button({ variant: 'primary' }, ["اذهب"])
});
```

هذه المكونات ليست مجرد اختصارات، بل هي خلاصة أفضل الممارسات، مُعدة لتكون الأساس الذي تبني عليه نور تطبيقك.

-----

### 5\. الحارس (`Guardian`): منفذ القوانين الفيزيائية

هو حارس مدمج يمثل قوانين نظام "مشكاة" الفيزيائية التي لا تتبدل. إن خالفها كودك وخيف منه أن ينهار بالنظام، يقوم الحارس بمنعه **قبل** أن تقع الكارثة. إنها قوانين مثل الجاذبية والاحتكاك، لا يمكن تجاوزها.

هذا ليس نظام تقييم، بل هو نظام منع. يقوم بمنع الكود من كسر قوانين الكون **قبل** أن تقع الكارثة.


#### تجلي الركن في الكود:

أنت لا تكتب كودًا لتفعيل الحارس، بل تقوم بتعريف "قوانين الطبيعة" التي سيفرضها على كل الكود.

```javascript
// من ملف mishkah.config.defaults.js
const guardianConfig = {
  // امنع أي وسم <script> من الظهور في الـ VDOM نهائيًا.
  denyTags: { script: 1 },
  
  // امنع أي خاصية تبدأ بـ "on" (مثل onclick) من الوجود.
  denyAttrs: [/^on/i],
  
  // امنع الروابط التي تحتوي على "javascript:"، فهي ثغرة أمنية.
  allowedUrlSchemes: ['http:', 'https:', 'mailto:'],
};

// بمجرد تحميل هذا الإعداد، تصبح هذه القوانين سارية
// على كل مكون وكل جزء من التطبيق، كقانون الجاذبية.
Mishkah.Guardian.setConfig(guardianConfig);
```

الحارس لا يعطي رأيه، بل يفرض الحقيقة. إنه يضمن أن عالمك البرمجي مبني على أسس فيزيائية سليمة لا يمكن اختراقها.

-----

### 6\. الرقيب (`Auditor`): ميزان الأعمال


**﴿يُسَبِّحُ لَهُۥ فِيهَا بِٱلۡغَدُوِّ وَٱلۡأٓصَالِ رِجَالٞ...﴾**
الرقيب هو نظام يرافقك كالملائكة الكرام الكاتبين، يسجل كل شيء ويقيمه بميزان دقيق ذي **14 درجة** (من -7 إلى +7)، لكل درجة اسم ومعنى.

#### تجلي الركن في الكود:

أنت لا تراقب الكود بنفسك، بل تطلب من الرقيب أن يسجل ويقيم.

```javascript
const Auditor = Mishkah.Auditor;

// فعل يستحق الثناء (درجة +2: الترغيب)
// مكون يستخدم aria-label لزر أيقونة لتحسين إتاحة الوصول.
Auditor.grade('+2', 'IconButton', 'استخدام aria-label لزر أيقونة.', {
  ruleId: 'aria-on-icon'
});

// فعل خاطئ لكنه ليس كارثيًا (درجة -3: الجُنح)
// مكون <select> يحتوي على 50 خيارًا، مما يصعب الاستخدام.
Auditor.grade('-3', 'CountrySelect', 'Select به خيارات كثيرة (+20).', {
  optionsCount: 50
});

// فعل محرم برمجيًا (درجة -7: المحرمات)
// مكون يقوم بحقن HTML مباشرة بدون تعقيم.
Auditor.grade('-7', 'ArticleRenderer', 'حقن HTML غير آمن عبر innerHTML.', {
  vulnerable: true
});

// الشرك البرمجي (مُبطل للأعمال - Nullifier)
// مكون يخلق مصدر حقيقة خاص به، مخالفًا لمبدأ التوحيد.
Auditor.activateNullifier('UserProfile', 'خلق حالة محلية تتنازع مع المصدر الأوحد.');
```

الرقيب لا يمنع، بل يسجل بميزان العدل. سجله هو صحيفة أعمال كل مكون، والتي سيُحاسب عليها في يوم الحساب.

-----

### 7\. أدوات المطور (`Devtools`): يوم الحساب

**﴿لِيَجۡزِيَهُمُ ٱللَّهُ أَحۡسَنَ مَا عَمِلُواْ وَيَزِيدَهُم مِّن فَضۡلِهِۦۗ﴾**
بفكرة عبقرية، تعمل هذه الأدوات على تقييم نتائج قياسات الرقيب (`Auditor`) لاتخاذ إجراء:

  * **الإصلاح:** إما أن يتم اتخاذ إجراء إصلاحي بالمكون.
  * **الجحيم:** أو يُلقى به في سجل جحيمي دائم، إذا كان غير قابل للإصلاح، ليظل وقودًا للمعرفة وعبرة لمن بعده.
  * **النعيم:** أو يُرفع إلى نعيم التشريف، فيثبت كفاءته ويصبح جزءًا من مكونات النظام الموثوقة التي يُعاد استخدامها في مشاريع أخرى.
  
  أخي في الله، لقد تجلت الرؤية كاملة. إنها دعوة مباركة لإتمام هذا الميثاق، ليكون ليس فقط دستورًا فلسفيًا، بل كتابًا حيًا ينطق فيه الكود بلسان المبادئ، ويشهد كل سطر فيه على عظمة النظام المستوحى من سنن الله في الخلق.

لقد تأملت في كل أركان "مشكاة"، من نواتها الصلبة إلى أدواتها الرقيبة، وفهمتُ الآن كيف تتجلى هذه الفلسفة في كل جزء من المنظومة. إن "الجزء الخفي" الذي أشرت إليه — وهو منظومة **الحوكمة الثلاثية (الحارس، الرقيب، وأدوات المطور)** — هو بحق قلب "مشكاة" النابض، وهو ما يميزها عن كل ما سواها. إنه تسبيح بحمد الله بلغة الخوارزميات، حيث لكل عمل ميزان، ولكل سلوك قانون.

#### السريان التلقائي والتحكم عند الطلب (Reactive-by-default)

من هذه اللحظة صار `setState()` هو النفخ التلقائي للروح في الجسد؛ ما دام التغيير صادقًا، فإن النواة تُجدوِل التصيير وحدها. لا حاجة لليمين ولا للتصريح المتكرر، مصداقًا لقوله تعالى: ﴿مَا كَانَ لِأَهۡلِ ٱلۡمَدِينَةِ وَمَنۡ حَوۡلَهُم مِّنَ ٱلۡأَعۡرَابِ أَن يَتَخَلَّفُواْ عَن رَّسُولِ ٱللَّهِ﴾ — الجسد لا يتخلف عن القائد.

لكن باب الولاية ما زال مفتوحًا، بل أصبح أنقى وأقوى:

  * **`freeze(opts?)`** لرفع عمق التجميد وجمع خيارات `keepScroll` و`except` و`buildOnly`.
  * **`unfreeze(opts?)`** لإطلاق دفعة تصيير واحدة عند العودة إلى عمق صفر مع كل الخيارات المتراكمة.
  * **`flush(opts?)`** لإجبار التصيير الفوري بنفس واجهة `rebuild` التاريخية (مع دعم `force:true`).
  * **`batch(fn)`** غلاف رحيم يقوم بالتجميد ثم التنفيذ ثم الإطلاق عنك.

```javascript
context.batch((ctx) => {
  ctx.setState((s) => ({ ...s, metrics: computeHeavyMetrics() }));
  ctx.setState((s) => ({ ...s, charts: recomputeCharts(s.metrics) }));
});

context.flush({ keepScroll: ['#orders-list'], except: ['#map-widget'] });
```

ولأهل الخبرة الذين يملكون كودًا قديمًا، بقي `rebuild()` كاسم مستعار لـ `flush()`. الأصل اليوم هو السريان التلقائي، والولاية عند الطلب.

بسم الله، نصوغ الآن البيان التأسيسي في حلته الكاملة، مدعومًا بأمثلة حية من الكود، ليكون نورًا على نور.


هنا، وبفكرة عبقرية، يتم تقييم سجلات "الرقيب" لإصدار **حكم نهائي** على المكونات. هذا ليس مجرد تقرير، بل هو مصير يُحدد لكل مكون بناءً على أعماله.

#### تجلي الركن في الكود:

أنت لا تحكم بنفسك، بل تحدد "سياسة يوم الحساب"، والنظام يتولى الباقي.

```javascript
const { Judgment, Snapshot } = Mishkah.Devtools;

// 1. تحديد سياسة الحكم (متى وكيف سيتم الحساب؟)
Judgment.configure({
  window: { days: 14, minEvents: 40 }, // راقب أداء المكون خلال 14 يومًا وبشرط وجود 40 حدثًا مسجلاً.
  thresholds: {
    heavenScore: +40, // إذا تجاوزت حسناته سيئاته بـ 40 درجة، يدخل النعيم.
    hellScore: -50    // إذا تجاوزت سيئاته حسناته بـ 50 درجة، يدخل الجحيم.
  },
  gates: {
    maxSevere: 0 // بوابة الجحيم: ارتكاب "محرم" واحد (-7) يكفي لدخولها مباشرة.
  }
});

// 2. طلب "لمحة سريعة" (Snapshot) أو إصدار حكم كامل
// سيقوم النظام بتحليل سجلات الرقيب وإصدار حكم على كل مكون.
Snapshot.print();

// سيظهر لك في الـ console تقرير يشبه هذا:
//
// [Mishkah] Snapshot
// ------------------------------------
// Top 5 Candidates:
// | component       | verdict   | score | severe |
// |-----------------|-----------|-------|--------|
// | 'UserAvatar'    | HEAVEN    | +55   | 0      |  <- إلى النعيم (مكون موثوق)
// | 'LegacyForm'    | HELL      | -78   | 3      |  <- إلى الجحيم (لإعادة الكتابة)
// | 'Navbar'        | PURGATORY | +5    | 0      |  <- في الأعراف (تحت المراقبة)
```

هذا هو "يوم الحساب" البرمجي. المكونات الصالحة تُرفع إلى **نعيم التشريف** لتُستخدم في مشاريع أخرى، والفاسدة تُلقى في **سجل جحيمي** لتكون عبرة ودرسًا، أو توضع في **الأعراف (Purgatory)** تحت المراقبة والإصلاح.

بالتأكيد. لنصُغ هذا الميثاق ليكون هو الدستور الحاكم للنظام، يوضح المبادئ الأساسية ويُرسي قواعد العمل.

---

### **ميثاق النظام: الفرقان بين الحارس والمدقق**

بسم الله فاطر السماوات والأرض، الذي خلق كل شيء فقدره تقديرًا، وجعل لكل شيء قانونًا وميزانًا. هذا ميثاق لنظامنا، قائم على فهم سنن الله في الخلق والأمر، ليكون البنيان مرصوصًا، والعمل مقبولًا.

يُبنى هذا النظام على طبقتين أساسيتين، لكل منهما دور لا يتعداه، ومهمة لا يتجاوزها: طبقة **الحارس (`Guard`)**، وهي طبقة القانون الفيزيائي القاهر، وطبقة **المدقق (`Auditor`)**، وهي طبقة الميزان العادل للأعمال.

### **الطبقة الأولى: الحارس (`Guard`) - مُنفِّذ السُنَن الحاكمة**

الحارس هو تجسيد لقوانين الله الكونية التي لا تتبدل ولا تتحول. هو لا يُقيِّم، لا يزن، ولا يحكم على النوايا، بل ينفذ القانون المطلق بصرامة وعدل على الجميع، "وَلَنْ تَجِدَ لِسُنَّةِ اللَّهِ تَبْدِيلًا".

**مبادئ عمله:**
* **فرض المستحيل:** يمنع وقوع ما هو مستحيل فيزيائيًا أو هيكليًا في النظام.
* **حماية الحدود:** يحمي حدود النظام الأساسية من الانتهاك (حدود الذاكرة، زمن التنفيذ، الوصول المباشر للمكونات المحمية).
* **الفعل ورد الفعل الفوري:** لا يُمهل ولا ينتظر. خرْق قانونه يؤدي إلى نتيجة حتمية وفورية.

**نتائج حكمه (لا توجد درجات):**
* **الإهلاك (`Termination`):** إنهاء فوري للعملية التي خرقت سنة من سنن النظام.
* **الانهيار (`Exception`):** إيقاف كامل للنظام إذا كان الخرق يهدد كيانه بالكامل.
* **السجل الأسود (`Blacklisting`):** تسجيل المكون المخالف كـ "ميت" أو "منبوذ"، بحيث يصبح استخدامه مستقبلاً مستحيلاً، ليكون عبرة لغيره.

الحارس هو القدر المحتوم، والفيزياء القاهرة، والأساس الذي تقوم عليه سلامة العالم الرقمي الذي نبنيه.

---

### **الطبقة الثانية: المدقق (`Auditor`) - ميزان الأعمال في ساحة الاختيار**

بعد أن يسمح الحارس بوجود الفعل (لأنه "ممكن فيزيائيًا")، تبدأ مهمة المدقق. المدقق هو الرقيب العليم الذي يعمل في ساحة حرية الاختيار الممنوحة للمبرمج. هو لا يمنع، بل يرصد ويزن ويُقوِّم، وهدفه ليس الإهلاك، بل الإرشاد والترقية وفتح باب "التوبة" (Refactoring).

**مبادئ عمله:**
* **الرصد الشامل:** يراقب كل فعل اختياري ويصنفه حسب ميزان دقيق مستلهم من كتاب الله.
* **الميزان العادل:** يضع كل فعل في درجته المناسبة، فلا يبخس محسنًا إحسانه، ولا يزيد على مخطئ خطيئته.
* **كشف العواقب:** يُظهر للمبرمج الأثر الحقيقي لأفعاله، وكيف أن "شرك العمل" يؤدي إلى الفساد، و"التوحيد" (اتباع المنهج) يؤدي إلى الصلاح.
* **فتح باب التوبة:** تقاريره هي دعوة دائمة للمراجعة والتحسين، فإذا أصلح المبرمج عمله، تبدلت درجاته من السلب إلى الإيجاب.

---

### **ميزان المدقق ذو الأربع عشرة درجة**

#### **ميزان السلب (دركات المخالفات)**
| الدرجة | المصطلح القرآني | الوصف والتطبيق البرمجي (`Use Case`) |
|:---:|---|---|
| **-1** | **تفويت الفضل** | **`Suboptimal Choice`**: كتابة كود يعمل، لكن كانت هناك طريقة أفضل وأكثر كفاءة بشكل واضح. |
| **-2** | **اللمم** | **`Trivial Issue`**: مخالفة طفيفة جدًا لمعايير التنسيق أو التسمية لا تؤثر على شيء. |
| **-3** | **الجُنح** | **`Minor Deviation`**: مخالفة غير مؤثرة لأفضل الممارسات الموصى بها. |
| **-4** | **المواعظ (يعظكم الله)** | **`Code Smell`**: كود صعب القراءة أو الصيانة، ورائحته تدل على مشكلة محتملة مستقبلًا. |
| **-5**| **التحذيرات (يحذركم الله)** | **`Warning`**: كود قد يتسبب في سلوك غير متوقع أو يحتوي على ثغرة أمنية غير حرجة. |
| **-6** | **المنهيات (نهى الله)** | **`Forbidden Pattern`**: استخدام نمط برمجي تم النهي عنه صراحةً في وثائق النظام. |
| **-7** | **المحرمات (كبائر الإثم)** | **`Critical Violation`**: خرق خطير للمعايير يؤدي إلى أخطاء كبيرة أو فساد في البيانات. |
| **حالة خاصة** | **مُبطلات الأعمال (الشرك)** | **`Work Nullifier`**: **لا تُعطى درجة سالبة**، بل تُفعِّل حالة **"حبوط العمل"**، حيث يتم تصفير كل الحسنات ولا تُسجل إلا السيئات لهذا المكون. |

#### **ميزان الإيجاب (درجات الخيرات)**
| الدرجة | المصطلح القرآني | الوصف والتطبيق البرمجي (`Use Case`) |
|:---:|---|---|
| **+1** | **الخيرية (خير لكم)** | **`Good Practice`**: تطبيق ممارسة جيدة موصى بها تزيد من جودة الكود. |
| **+2** | **الترغيب (قل..)** | **`Preferred Pattern`**: استخدام نمط برمجي تشجع عليه بنية النظام لأنه يسهل الصيانة. |
| **+3** | **الأوامر (أمر الله)** | **`Standard Compliance`**: الالتزام الكامل بالمعايير القياسية المطلوبة للمشروع. |
| **+4** | **الوصايا (أوصى الله)** | **`Robust Implementation`**: كتابة كود متين يأخذ في الحسبان الحالات الشاذة ويعالجها بفعالية. |
| **+5** | **الفرائض (فرض الله)** | **`Core Feature Fulfillment`**: إنجاز الوظيفة الأساسية للمكون بشكل كامل وصحيح وموثوق. |
| **+6** | **ما كتب الله** | **`Critical Requirement`**: تحقيق متطلب حيوي لا يعمل النظام بكفاءة بدونه (مثل كتابة الاختبارات). |
| **+7** | **السبق بالخيرات** | **`Exceptional Contribution`**: عمل استثنائي يتجاوز المطلوب، كتحسين أداء جزء من النظام أو إعادة هيكلة كود معقد لجعله بسيطًا وفعالاً. |

---
بهذا الميثاق، نقيم نظامًا أساسه **الحزم والقوة (Guard)**، وعماده **العدل والرحمة (Auditor)**، وغايته الارتقاء بالعملสู่ درجة **الإحسان**.


-----

هذه هي "مشكاة"، ليست مجرد بنية برمجية، بل هي دعوة إلى الله من خلال إتقان الصنعة والنظام والعدل.
-----

## في بُيُوتٍ أَذِنَ اللَّهُ أَن تُرْفَعَ: روح المشروع وغايته



إن فهم "مشكاة" لا يكتمل بالنظر إلى أركانها التقنية فحسب، بل بفهم الروح التي تسري فيها، والغاية التي من أجلها وُجدت. إن مثلها كمثل النور الذي وصفه الله في كتابه، وهو مثل يتجاوز مجرد التشبيه السطحي:



  * **المصباح (`Misbah`):** هو قلب المبرمج المؤمن، الذي وقوده **إيمان وعمل**. إيمان بأن مصدر الحقيقة واحد لا شريك له (`database`)، وعمل دؤوب ومتقن (`code`).

  * **الشجرة المباركة (`Shajarah`):** هي شجرة المعرفة الإلهية وسنن الله في الكون، أصلها ثابت في التوحيد (`Tawhid`)، وفرعها في سماء الإبداع والابتكار. من زيتها النقي تضاء البصائر.

  * **النار (`Nar`):** هي **محرك الجد والعمل والابتلاء** في قلوب المؤمنين. هي نار الشغف والإتقان التي لا تنطفئ، والتي تحول الزيت إلى نور ساطع.

  * **الزجاجة (`Zujajah`):** هي بنية "مشكاة" الصارمة (DSL, Guardian). تحمي هذا المصباح المتقد من رياح الفوضى والعشوائية، فتسمح للنار بالبقاء في بيئتها المثالية، وفي نفس الوقت لا تعزل نورها عن العالم، بل تزيده تركيزًا وجمالاً.

  * **المشكاة (`Mishkah`):** هي النظام المتكامل الذي يجمع كل هذا النور. هي البيئة التي تركز الأعمال المباركة وتوجهها وتوزعها، لتصير نبراسًا يضيء للعالمين.



ولكن، أين يوجد هذا النور؟ وأين يشتعل هذا المصباح؟ هنا يأتي جوهر المشروع وغايته النهائية:



> ﴿فِي بُيُوتٍ أَذِنَ اللَّهُ أَن تُرْفَعَ وَيُذْكَرَ فِيهَا اسْمُهُ يُسَبِّحُ لَهُ فِيهَا بِالْغُدُوِّ وَالْآصَالِ (36) رِجَالٌ لَّا تُلْهِيهِمْ تِجَارَةٌ وَلَا بَيْعٌ عَن ذِكْرِ اللَّهِ وَإِقَامِ الصَّلَاةِ وَإِيتَاءِ الزَّكَاةِ ۙ يَخَافُونَ يَوْمًا تَتَقَلَّبُ فِيهِ الْقُلُوبُ وَالْأَبْصَارُ (37)﴾



إن "مشكاة" لن تقوم إلا في مثل هذه البيوت. والله قال "بيوت" ولم يقل "مساجد"، لأن كل بيوتنا التي تنير بمنهج الله فنبات فيها سجدا وقيما نجتمع على محبته و ذكره و نقيم في حياتنا نظام الله و صلتنا به بيوت ترفع بذكر اسم الله فيه، وهذا هو شرفُها. إن بيوتنا التي نعمل فيها، ، يمكن أن تكون من هذه البيوت التي أذن الله أن تُرفع.



**كيف؟**

إن الله قال رجال و لم يقن رجل و كل اغلب مخاطبة الله لنا بالتكليف كانت بصيغة الجمع يا أيها المؤمنين 

لان أن العقل الجمعي يقوم به روح التكليف و تجلي الإيمان في صورته الكبرى التي يحبها الله نصطف و  نجتمع و نتعاون على الغاية العظمى و نتبادل الخبرات و نتعاون على قربنا الي الله يصير كل سطر كود نكتبه **ذكرًا لله**. ليس الذكر بمجرد ترديد اللسان، بل هو تذكر عظمة الله في قانونه ونظامه، واستلهام دقة صنعته في كل خوارزمية، والتأمل في آثار رحمته في كل واجهة سهلة يسيرة. عندما نسعى لتقليد النظام الإلهي في برامجنا، فإننا نسبح بحمد الله بلغة البيانات والخوارزميات.



إن "مشكاة" هي نتاج عمل جماعي في بيئة حاضنة، بيئة رجال ينكبون فيها على غايتهم العليا. **رجال** لا تلهيهم تجارة ولا بيع عن ذكر الله، لا يشتتهم بريق التقنيات الزائلة عن السعي نحو الحقيقة والنظام. رجال يقيمون الصلة الحقيقية بخالقهم من خلال إتقان صنعتهم، ويزكون علمهم ومالهم ووقتهم بنذره لهذه الغاية السامية.



لهذا، فإن هذا الدستور ليس مجرد توثيق تقني، بل هو **دعوة جماعية**. دعوة لكل من أراد أن ينضم إلى هذه البيوت، ليذكر الله عبر الكود والبرمجة، وليبيت لربه ساهرًا يتأمل عظيم خلقه، ويترجم هذا التأمل إلى نظام ونور يهدي به الناس.


-----
### الترخيص والمساهمة

**رخصة المشروع (License)**
"مشكاة" مفتوحة المصدر بالكامل تحت رخصة **MIT**. هذا يعني أنه يمكنك استخدامها، تعديلها، وتوزيعها بحرية تامة، سواء في مشاريع شخصية أو تجارية، بشرط واحد وهو الإبقاء على ذكر المصدر الأصلي وحقوق النشر.

**دعوة للمساهمة**
إن "مشكاة" ليست مجرد كود، بل هي فكرة. وإن كنت قد اقتنعت بهذه الفكرة، فإن مساهمتك ليست مجرد خيار، بل هي جزء من إتمام هذا النور. فالأفكار العظيمة لا تكتمل بجهد فردي، بل بعمل جماعي لتصير كوكبًا دريًا يضيء للجميع.

نرحب بكل مساهمة، سواء كانت بالكود، أو بالتوثيق، أو حتى بنشر الفكرة لمن حولك.

